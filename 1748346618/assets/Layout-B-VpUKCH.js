const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CD9hqDE7.js","assets/index-wwEj6H2r.js","assets/index-CsSXPTiX.js","assets/index-BpkY95s5.js","assets/textImage-DGNRAgF_.js"])))=>i.map(i=>d[i]);
import{h as j}from"./index-wwEj6H2r.js";import{r as S,j as t}from"./index-BpkY95s5.js";import{o as L,d as x}from"./index-CsSXPTiX.js";import{c as P}from"./textImage-DGNRAgF_.js";import{e as T,f as b,g as B}from"./uploadUtil-DMy6Z8cC.js";function w(n,u){var h=u;return S.useState(function(){return L(n(h),void 0,{autoBind:!0})})[0]}const D={GridCollage:{id:"1",name:"wg",routerName:"网格",icon:"contouringRestore",url:"/GridCollage"},PosterCollage:{id:"5",name:"hb",routerName:"海报",icon:"post",url:"/PosterCollage"},ConcatCollage:{id:"2",name:"pj",routerName:"拼接",icon:"splicing",url:"/ConcatCollage"},FreeCollage:{id:"4",name:"zy",routerName:"自由",icon:"jigsaw",url:"/FreeCollage"}};function F({collageStore:n,pathname:u,imageLayerList:h}){return t.jsx("div",{children:t.jsx("div",{style:{flex:1},children:Object.values(D).map(e=>e.url?t.jsx("div",{style:{position:"relative"},children:t.jsx("div",{onClick:()=>{u!==e.url&&n.cloneDeepImageLayerList(h)},children:t.jsx("div",{children:e.routerName})})},e.id):null)})})}const N=x(F),A=x(({collageStore:n,children:u})=>{const{rootStore:h}=n,e=w(()=>({isShow:!1,tipContent:"作品下载成功",confirmButtonText:"确认",confirmFn:()=>{},cancelFn:()=>{e.isShow=!1},hasCancelButton:!1})),o=w(()=>({isShow:!1,cancelFn:()=>{},progressInfo:{progressPercentage:0}}));async function v({canvas:r,fileName:f}){var g;try{const{width:s,height:l}=((g=n.getOneCollageInfo())==null?void 0:g.page)||{width:400,height:1e3},a=s<=l?400:s/l*400,d=Math.floor(a*l/s),c=document.createElement("canvas");c.width=a,c.height=d;const i=c.getContext("2d");i&&i.drawImage(r,0,0,a,d);const C=await T(c,"image/jpeg",.8),_=b(C,f),I=await B()}catch(s){throw new Error(`保存图片失败${s.message}`)}}function p(){o.isShow===!0&&o.progressInfo.progressPercentage<85&&(o.progressInfo.progressPercentage+=10,setTimeout(()=>{p()},200))}async function m({suffix:r,quality:f,type:g}){o.isShow=!1,e.isShow=!1,e.hasCancelButton=!1,o.progressInfo.progressPercentage=0,e.tipContent="作品下载成功",e.confirmButtonText="确认";const s=n.getOneCollageInfo();if(s)try{const{Render:l}=await j(async()=>{const{Render:i}=await import("./index-CD9hqDE7.js");return{Render:i}},__vite__mapDeps([0,1,2,3,4]));let a=null;o.isShow=!0,o.cancelFn=()=>{o.isShow=!1,a==null||a.cancelDownLoad()},await new Promise(i=>{p(),setTimeout(()=>{i("")},0)});const d=new l(s,{syncData:o.progressInfo});a=d;const c=n.getLocalStore();c&&await P(c),await d.start(),await d.downLoad({format:r,quality:+f}).then(i=>{o.progressInfo.progressPercentage=100,o.isShow=!1,e.isShow=!0,e.confirmFn=()=>{e.isShow=!1},v({canvas:i,fileName:""})})}catch(l){o.isShow=!1,e.isShow=!0,l.message==="overSize"?(e.tipContent="尺寸大于8000px",e.confirmButtonText="好的",e.confirmFn=()=>{e.isShow=!1},e.hasCancelButton=!1):(e.tipContent="下载失败",e.confirmButtonText="重新下载",e.confirmFn=()=>{m({suffix:r,quality:f,type:"0"})},e.hasCancelButton=!0)}}function y({suffix:r,quality:f}){h.userInfo&&m({suffix:r,quality:f,type:"1"})}return t.jsxs("div",{className:"Layout",onDragStart:r=>{r.stopPropagation(),r.preventDefault()},children:[t.jsx("div",{onClick:()=>{y({suffix:"image/png",quality:1})}}),t.jsxs("div",{style:{width:"100%",height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",cursor:"default"},children:[t.jsx("div",{style:{width:"100%",height:"60px"}}),t.jsx("div",{style:{width:"100%",flex:1,overflow:"hidden"},children:t.jsxs("div",{style:{display:"flex",width:"100%",height:"100%",flexDirection:"row"},children:[t.jsx(N,{collageStore:n,pathname:n.pathname,imageLayerList:n.getImageLayerList()}),t.jsx("div",{style:{flex:1,height:"100%",overflow:"hidden"},children:u})]})})]})]})});export{A as default};
