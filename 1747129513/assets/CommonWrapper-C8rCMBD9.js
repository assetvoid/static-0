import{R as bt,r as x,a as du,d as cu,j as d}from"./index-BpkY95s5.js";import{aJ as kt,bj as gn,aH as tt,cG as Is,cH as fu,cI as lu,cJ as Fa,l as de,cK as lr,cL as Li,bh as Ar,m as Ct,cM as $n,bo as ft,D as ue,x as X,cN as Xi,cO as js,aK as Ia,bk as cn,cP as Ot,cQ as Te,cR as gu,bG as hu,az as Kt,k as fe,cS as pu,cT as Ji,r as vu,cU as Ms,s as Rs,z as ks,cV as Ds,ay as Ce,p as ce,aE as mu,bw as ja,bn as yu,bp as xu,cW as wu,cX as bu,cY as Os,cZ as Cu,c_ as Vs,c$ as Pu,d0 as Ns,bJ as Lu,d1 as Eu,d2 as Tu,d3 as Fu,d4 as Iu,aS as ju,bI as Mu,d5 as As,d6 as Ru,d7 as gi,d8 as ku,d9 as Du,da as Ou,ch as Ei,db as Vu,dc as Nu,aC as Au,v as Vt,dd as _u,bF as Bu,de as $u,by as zu,df as ut,aR as Wu,dg as _s,bD as zn,dh as qt,di as Er,dj as _r,br as On,dk as Tr,bX as Bs,cA as Qi,cz as Vn,dl as Si,dm as Uu,dn as Hu,dp as ea,dq as Gu,bT as Ti,dr as qu,ds as Ma,dt as Yu,du as Ku,dv as Fr,dw as Zu,dx as Xu,dy as Ju,S as Qu,dz as $s,bS as Fi,dA as Su,dB as ed,dC as zs,dD as hi,dE as td,dF as Ii,e as ta,bY as na,dG as nd,Y as ra,b9 as ia,$ as hn,Z as pn,b6 as aa,b5 as Ws,a3 as sa,a4 as R,dH as pi,a5 as Me,a6 as vn,a2 as Ra,a7 as K,ad as yt,cy as ka,cu as rd,dI as id,F as Us,ab as oa,J as Fe,ac as Hs,a1 as Ye,aa as Ir,a0 as $,aw as Ae,dJ as Gs,dK as ji,au as Dt,X as ad,dL as qs,W as sd,av as I,dM as Y,dN as Wn,dO as lt,dP as jn,dQ as Ht,dR as Mt,b8 as Da,at as Un,M as Ys,N as od,dS as ud,dT as Mi,dU as Ri,H as Nn,G as dd,an as cd,I as fd,bf as ld,ai as gd,aj as hd,ce as pd,dV as Oa,dW as Ks,j as Ke,dX as vd,dY as md,dZ as yd,d_ as xd,d$ as Zs,e0 as Rn,e1 as Xs,bR as wd,aX as Js,aY as Qs,bU as bd,bV as Cd,bl as Pd,w as Ld,e2 as Ed,e3 as Pt,e4 as Td,e5 as Fd,cC as Id,e6 as jd,e7 as Md,e8 as Rd,e9 as kd,ea as Dd}from"./index-BmkeKudn.js";import{d as O}from"./index-CsSXPTiX.js";import{c as An,a as Br,r as ua,u as Od,s as Vd}from"./methods-BRCwTmNU.js";function Nd(e){const t={x:0,y:0},n=[],r=[];function i(y,g){let h="";return typeof(y==null?void 0:y.delta)=="number"&&g?Math.abs(y.delta)<=Math.abs(g.delta)?h="line":h="rects":typeof(y==null?void 0:y.delta)=="number"?h="line":g&&(h="rects"),h}const{leftTop:a,leftBottom:s,rightTop:o,rightBottom:u}=kt(e.bunchRectangle);let c=e.props.getPageSize().width,f=e.props.getPageSize().height;const l=gn(e);tt(e)&&l&&(c=l.width,f=l.height);{const y=jr({type:"MOVING",localStore:e,layer:e.bunchRectangle,x:"x",width:"width",origin:"",roomSize:{width:c,height:f}}),g=Va(e,"left","width","top","height",{roomWidth:c,roomHeight:f}),h=i(y,g);if(typeof(y==null?void 0:y.delta)=="number"&&h==="line"){if(t.x=y.delta,y.type==="page")n.push({x:y.value*e.getPageScale(),y:0,width:1,height:f*e.getPageScale()});else{const v=[a.y,s.y,o.y,u.y],b=e.getLayer(y.layerId);if(b){const P=kt(b);v.push(P.leftTop.y,P.leftBottom.y,P.rightTop.y,P.rightBottom.y)}const m=lr(v),w=Li(v)-lr(v);n.push({x:y.value*e.getPageScale(),y:m*e.getPageScale(),width:1,height:w*e.getPageScale()})}e.bunchRectangleXFixed=!0}else g&&h==="rects"?(t.x=g.delta,r.push({dimension:"x",rect:g.leftRect}),r.push({dimension:"x",rect:g.rightRect}),e.bunchRectangleXFixed=!0):e.bunchRectangleXFixed=!1}{const y=jr({type:"MOVING",localStore:e,layer:e.bunchRectangle,x:"y",width:"height",origin:"",roomSize:{width:c,height:f}}),g=Va(e,"top","height","left","width",{roomWidth:c,roomHeight:f}),h=i(y,g);if(typeof(y==null?void 0:y.delta)=="number"&&h==="line"){if(t.y=y.delta,y.type==="page")n.push({x:0,y:y.value*e.getPageScale(),height:1,width:c*e.getPageScale()});else{const v=[a.x,s.x,o.x,u.x],b=e.getLayer(y.layerId);if(b){const P=kt(b);v.push(P.leftTop.x,P.leftBottom.x,P.rightTop.x,P.rightBottom.x)}const m=lr(v),w=Li(v)-lr(v);n.push({y:y.value*e.getPageScale(),x:m*e.getPageScale(),height:1,width:w*e.getPageScale()})}e.bunchRectangleYFixed=!0}else g&&h==="rects"?(t.y=g.delta,r.push({dimension:"y",rect:g.leftRect}),r.push({dimension:"y",rect:g.rightRect}),e.bunchRectangleYFixed=!0):e.bunchRectangleYFixed=!1}return e.helperLineList=n,e.helperRectList=r,t}function Ad(e){if(tt(e)){const n=gn(e);return n?n.children.filter(r=>e.getSelectedLayerIdList().includes(r.id)===!1):e.props.getCurrentPage().children.filter(r=>e.getSelectedLayerIdList().includes(r.id)===!1)||[]}return e.editingGroupLayer?e.getNormalLayerList().filter(n=>n.id!==e.activeGroupLayerId):e.getNormalLayerList().filter(n=>e.getSelectedLayerIdList().includes(n.id)===!1)}function jr({type:e,localStore:t,layer:n,x:r,width:i,origin:a,roomSize:s}){const o=kt(n),u=[];let c=-1,f=1/0;const l=s,p=[{type:"page",value:0,layerId:"",delta:null},{type:"page",value:l[i],layerId:"",delta:null},{type:"page",value:l[i]/2,layerId:"",delta:null}];Ad(t).forEach(v=>{const b=kt(v);[b.leftTop[r],b.leftBottom[r],b.center[r],b.rightTop[r],b.rightBottom[r]].forEach(m=>{p.push({type:"layer",value:m,layerId:v.id,delta:null})})});let g=[];a==="left"?g=["rightTop","rightBottom"]:a==="right"?g=["leftTop","leftBottom"]:a==="top"?g=["leftBottom","rightBottom"]:a==="bottom"?g=["leftTop","rightTop"]:g=["leftTop","leftBottom","rightTop","rightBottom","center"],g.forEach(v=>{p.forEach(b=>{const m=b.value-o[v][r];Math.abs(m)<Is/t.getPageScale()&&u.push({...b,delta:m,movingPointName:v})})}),u.map(v=>Math.abs(v.delta)).forEach((v,b)=>{v<f&&(f=v,c=b)});const h=u[c];if(h&&e==="RESIZING"){let v=[0,0,0,0];if(r==="x"?(v=[h.value,-1e6,h.value,1e6],h.movingPointName==="leftTop"?h.fixedPointName="rightTop":h.movingPointName==="leftBottom"?h.fixedPointName="rightBottom":h.movingPointName==="rightTop"?h.fixedPointName="leftTop":h.movingPointName==="rightBottom"&&(h.fixedPointName="leftBottom")):r==="y"&&(v=[-1e5,h.value,1e5,h.value],h.movingPointName==="leftTop"?h.fixedPointName="leftBottom":h.movingPointName==="leftBottom"?h.fixedPointName="leftTop":h.movingPointName==="rightTop"?h.fixedPointName="rightBottom":h.movingPointName==="rightBottom"&&(h.fixedPointName="rightTop")),h.movingPointName&&h.fixedPointName){const b=fu(o[h.fixedPointName].x,o[h.fixedPointName].y,o[h.movingPointName].x,o[h.movingPointName].y,...v);b&&(h.size=lu(o[h.fixedPointName],b))}}return h}function Va(e,t,n,r,i,{roomWidth:a,roomHeight:s}){const o=Fa(e.bunchRectangle);let u=[];u=(gn(e)||e.props.getCurrentPage()).children.filter(g=>{var h;return g.id!==((h=e.selectedSingleLayer)==null?void 0:h.id)||""});const f=u.map(g=>Fa(g)).concat(t==="left"?[{left:0,top:0,width:0,height:s},{left:a,top:0,width:0,height:s}]:[{left:0,top:0,width:a,height:0},{left:0,top:s,width:a,height:0}]).filter(g=>g[t]+g[n]<o[t]||g[t]>o[t]+o[n]);let l=Is,p;function y(g,h){return!(g[r]>h[r]+h[i]||g[r]+g[i]<h[r])}if(f.forEach(g=>{f.filter(h=>h!==g).forEach(h=>{const v=de.sortBy([o,g,h],t),[b,m,w]=v,P=m[t]-(b[t]+b[n]),E=w[t]-(m[t]+m[n]);P>0&&E>0&&Math.abs(P-E)<l&&y(b,m)&&y(m,w)&&(l=Math.abs(P-E),p=v)})}),p){const[g,h,v]=p;let b=0,m=0;if(h===o){const C=g[t]+g[n];b=C+(v[t]-C)/2-(h[t]+h[n]/2),h[t]+=b,m=(v[t]-C-h[n])/2}else if(g===o){m=v[t]-(h[t]+h[n]);const C=v[t]-2*m-h[n]-g[n];b=C-g[t],g[t]=C}else if(v===o){m=h[t]-(g[t]+g[n]);const C=h[t]+h[n]+m;b=C-v[t],v[t]=C}const w=de.min([h[r],g[r]])||0,P=de.max([h[r]+h[i],g[r]+g[i]])||0,E=de.min([h[r],v[r]])||0,L=de.max([h[r]+h[i],v[r]+v[i]])||0;return _d({isX:t==="left",leftBox:g,rightBox:v,middleBox:h,delta:b,rectSpan:m,leftRectMin:w,leftRectMax:P,rightRectMin:E,rightRectMax:L})}return null}function _d({isX:e,leftBox:t,rightBox:n,middleBox:r,delta:i,rectSpan:a,leftRectMin:s,leftRectMax:o,rightRectMin:u,rightRectMax:c}){if(e){const f={left:t.left+t.width,width:a,top:s,height:o-s},l={left:r.left+r.width,width:a,top:u,height:c-u};return{delta:i,rectSpan:a,leftRect:f,rightRect:l}}{const f={top:t.top+t.height,height:a,left:s,width:o-s},l={top:r.top+r.height,height:a,left:u,width:c-u};return{delta:i,rectSpan:a,leftRect:f,rightRect:l}}}function Bd(e,t,n){const r=e.getPointInPage(n);return $d(e,t,r)}function $d(e,t,n){const r=kt(t);return Ar("layer",n,t.rotate,{x:r.leftTop.x,y:r.leftTop.y})}function tp({localStore:e,pointInLayer:t,layer:n}){const r=Ct(n),i=Ar("global",{x:t.x-n.width/2,y:t.y-n.height/2},-n.rotate);return{x:i.x+r.x,y:i.y+r.y}}function np(e,t){e.x<t.left&&(e.x=t.left),e.x>t.left+t.width&&(e.x=t.left+t.width),e.y<t.top&&(e.y=t.top),e.y>t.top+t.height&&(e.y=t.top+t.height)}function Ss({localStore:e,layer:t,step:n}){var r;t.parentId&&$n(e,t,{step:n}),t.id===((r=e.selectedSingleLayer)==null?void 0:r.id)&&ft(e,t)}function zd(e,t){e.currentStatus="movingLayers",Wd(e,t),ue(e,t)}function Na(e,t){e.bunchRectangle.left+=t.x,e.bunchRectangle.top+=t.y}function Wd(e,t){var f,l,p,y;const n=X(e),r=tt(e);if(e.selectedSingleLayer){const g=e.getLayer(e.selectedSingleLayer.parentId);if(g&&Ia(g)!=="NONE"&&e.selectedSingleLayer.stackPositioning!=="ABSOLUTE"&&r){Gd({localStore:e,context:r,fileData:r.fileData,parent:g,layer:e.selectedSingleLayer,e:t,step:n}),ft(e,e.selectedSingleLayer),(l=(f=e.props).doAction)==null||l.call(f,n.getNewAction());return}}let i={x:0,y:0},a=null;if(r){const g=gn(e);if(g){const{absoluteTransform:h}=cn(r.fileData,{type:"layer",layerId:g.id});if(h){const v=Ot(e,t);v&&(i=Te(h,v),h[0][2]=0,h[1][2]=0,a=h)}}else{const h=Ot(e,t);h&&(i=h)}}const s=Xi(e,t,a),o={x:s.x,y:s.y};Na(e,o);let u={x:0,y:0};e.options.applyMagneticEffect&&(u=Nd(e)),Na(e,u);const c={x:o.x+u.x,y:o.y+u.y};if(e.selectedSingleLayer){const g=e.selectedSingleLayer,h=e.getLayer(e.selectedSingleLayer.parentId);h&&Ia(h)!=="NONE"&&g.stackPositioning!=="ABSOLUTE"||(Yt(e,e.selectedSingleLayer,c.x,c.y,n),e.selectedSingleLayer.parentId&&$n(e,e.selectedSingleLayer,{step:n}),r&&gu({context:r,localStore:e,singleLayer:g,step:n,pointInContainer:i}),ft(e,e.selectedSingleLayer))}else e.selectedLayerList.forEach(g=>{Yt(e,g,c.x,c.y,n)});(y=(p=e.props).doAction)==null||y.call(p,n.getNewAction())}function rp({figmaLeft:e,figmaTop:t,layer:n,localStore:r,step:i}){const a=pu({x:e,y:t,width:n.width,height:n.height,rotate:n.rotate});Yt(r,n,a.left-n.left,a.top-n.top,i),Ss({localStore:r,layer:n,step:i})}function Yt(e,t,n,r,i,a){const s={x:n,y:r};i.update({layer:t,data:{left:t.left+s.x,top:t.top+s.y}}),t.nodeType==="GROUP"&&t.children.length>0&&t.children.forEach(o=>{Yt(e,o,s.x,s.y,i)}),t.nodeType==="IMAGE"&&t.extra.rectList&&t.extra.rectList.length>0&&t.extra.rectList.forEach(o=>{Yt(e,o,s.x,s.y,i)})}function Ud(e,t){var i;const n=X(e);e.currentStatus="movingPageFrame";const r=Xi(e,t,null);e.props.matting&&Yt(e,(i=e.props.matting)==null?void 0:i.getPageFrame(),r.x,r.y,n),ue(e,t)}function Hd(e,t){e.currentStatus="movingPageInWorkspaceWithoutBounds";const n=t.pageX-e.pointerX,r=t.pageY-e.pointerY,{workspaceState:i}=e;i.positionLeft+=n,i.positionTop+=r,e.workspaceElement&&js(e,e.workspaceElement),ue(e,t)}function ip(e,t){t.stopPropagation(),e.currentStatus="movingPageInWorkspaceWithoutBounds",fe(e,t)}function Gd({context:e,localStore:t,fileData:n,e:r,parent:i,layer:a,step:s}){if(t.isFullyFunctional===!1)return;const o=Ot(t,r);if(!o)return;let u="";if(i.children.forEach(c=>{if(c.id!==a.id){const f=cn(n,{type:"layer",layerId:c.id}),l=Te(f.absoluteTransform,o);i.stackMode==="VERTICAL"&&l.y>0&&l.y<c.height&&Math.abs(c.height/2-l.y)<=c.height/5&&(u=c.id),i.stackMode==="HORIZONTAL"&&l.x>0&&l.x<c.width&&Math.abs(c.width/2-l.x)<=c.width/5&&(u=c.id)}}),u){const c=[];i.children.forEach(f=>{f.id===a.id?c.push(u):f.id===u?c.push(a.id):c.push(f.id)}),s.update({layer:i,data:{children:c}}),i.children=hu(t,c),Kt({localStore:t,layer:i,instanceChain:[],step:s})}}function eo(e,t){const n=e.getContext("2d");let r=0,i=0;t instanceof HTMLImageElement?(r=t.naturalWidth,i=t.naturalHeight):(r=t.width,i=t.height),e.width=r,e.height=i,n&&(n.clearRect(0,0,r,i),n.globalCompositeOperation="source-over",n.shadowBlur=0,n.drawImage(t,0,0,r,i))}function to(e){const t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height)}function qd(e,t){const n=e.getContext("2d");if(n){const r=n==null?void 0:n.globalCompositeOperation;n.globalCompositeOperation="destination-out",n.drawImage(t,0,0,t.width,t.height),n.globalCompositeOperation=r}}function no(e,t){return Math.floor(e*((1-t/100)/4))}function ro(e,t,n){const r=Bd(e,t,n);if(!t.image)return r;let i=Ar("rotated",{x:r.x-t.width/2,y:r.y-t.height/2},t.image.rotate||0);i={x:i.x-(t.image.imageX||0),y:i.y-(t.image.imageY||0)};const a=Ji(t),{image:s}=t;return i={x:(i.x+s.width/2)/a,y:(i.y+s.height/2)/a},s.flipH&&(i.x=s.naturalWidth-i.x),s.flipV&&(i.y=s.naturalHeight-i.y),i}function io({canvas:e,type:t,strokeColor:n,strokeWidth:r,shadowBlur:i,point:a,isStart:s}){const o=e.getContext("2d");if(o){o.globalCompositeOperation="source-over";const u=r-2*i;o.lineWidth=u,o.shadowBlur=i,o.shadowColor=n,o.fillStyle=n,o.strokeStyle=n,o.lineCap="round",o.lineJoin="round",s&&o.beginPath(),o.lineTo(a.x,a.y),o.stroke(),o.arc(a.x,a.y,u/2,0,2*Math.PI,!1),o.fill(),o.beginPath(),o.moveTo(a.x,a.y),o.shadowBlur=0}}function Yd(e,t,n){fe(e,n);const r=Ji(t),i=ro(e,t,n),a=e.eraserPathCanvas;a&&(to(a),io({canvas:a,type:"BRUSH",strokeWidth:e.state.eraserVisualDiam/e.getPageScale()/r,strokeColor:e.state.eraserPathColor,shadowBlur:no(e.state.eraserVisualDiam,100-e.state.eraserShadowBlurPercent)/e.getPageScale()/r,isStart:!0,point:i}))}function Kd(e,t){ue(e,t);const n=e.selectedSingleImageLayer;if(n){const r=Ji(n),i=ro(e,n,t),a=e.eraserPathCanvas;a&&io({canvas:a,type:"BRUSH",strokeWidth:e.state.eraserVisualDiam/e.getPageScale()/r,strokeColor:e.state.eraserPathColor,shadowBlur:no(e.state.eraserVisualDiam,100-e.state.eraserShadowBlurPercent)/e.getPageScale()/r,point:i,isStart:!1})}}async function Zd(e,t){var r;const n=e.eraserPathCanvas;if(n){const i=e.selectedSingleImageLayer;if(i&&i.image){const a=document.createElement("canvas"),s=await vu((r=i.image)==null?void 0:r.imageSource);a.getContext("2d")&&(eo(a,s),qd(a,n)),i.image.imageSource=a.toDataURL()}to(n)}}const ao=1;function Xd(e,t){const n=Ct(e.bunchRectangle),r=e.getPointInContainer(t),i=ks(r,n);let a=i-e.pointerAppliedAngle;e.bunchRectangleRotationFixed?Math.abs(a)>=ao?(e.bunchRectangleRotationFixed=!1,e.pointerAppliedAngle=i):a=0:e.pointerAppliedAngle=i,e.pointerCurrentAngle=i,Jd(e,a),ue(e,t)}function Jd(e,t){var a,s;const n=X(e);let r=t;const i=e.bunchRectangle.rotate+t;if([-135,-90,-45,0,45,90,135,180].forEach(o=>{Math.abs(i-o)<ao&&(r=o-e.bunchRectangle.rotate,e.bunchRectangleRotationFixed=!0)}),un(e,e.bunchRectangle,e.bunchRectangleCenter,r,n),e.selectedSingleLayer){const o=e.getLayer(e.selectedSingleLayer.parentId);if(!o||o.nodeType==="FRAME"||o.nodeType==="SECTION"){const u=Ct(e.selectedSingleLayer);un(e,e.selectedSingleLayer,u,r,n),e.getFigma()&&ft(e,e.selectedSingleLayer)}else un(e,e.selectedSingleLayer,e.bunchRectangleCenter,r,n),$n(e,e.selectedSingleLayer,{step:n})}else e.selectedLayerList.forEach(o=>{un(e,o,e.bunchRectangleCenter,r,n)});(s=(a=e.props).doAction)==null||s.call(a,n.getNewAction())}function un(e,t,n,r,i,a){var h;let s=t.rotate+r;for(;s>180;)s-=360;for(;s<-180;)s+=360;i.update({layer:t,data:{rotate:s}});const o=Ct(t),u=Math.cos(r*Math.PI/180),c=Math.sin(r*Math.PI/180),f={x:o.x-n.x,y:o.y-n.y},l={x:f.x*u-f.y*c},p=n.x+l.x,y=n.y+f.x*c+f.y*u,g={x:p,y};i.update({layer:t,data:{left:g.x-t.width/2,top:g.y-t.height/2}}),t.nodeType==="GROUP"&&t.children.length>0&&t.children.forEach(v=>un(e,v,n,r,i)),t.nodeType==="IMAGE"&&((h=t.extra.rectList)==null?void 0:h.length)>0&&t.extra.rectList.forEach(v=>un(e,v,n,r,i))}function Qd(e,t,n){const r=X(e);(t.nodeType==="IMAGE"||t.nodeType==="ROUNDED_RECTANGLE")&&t.image&&(r.update({layer:t,data:{image(i){i.rotate=Ms(n)}}}),Rs(e,t))}function ap(e){const t=e.imageLayerUnderEditing;t&&t.image&&(e.layerUnderCropping=de.cloneDeep(t))}function sp(e){const t=e.props.getBackgroundLayer();t&&(e.layerUnderCropping=de.cloneDeep(t))}function Sd(e){e.layerUnderCropping&&(e.selectedSingleLayer&&ft(e,e.selectedSingleLayer),e.layerUnderCropping=null)}function ec(e){if(e.layerUnderCropping){const{id:t}=e.layerUnderCropping,n=Ds(e,t);if(n)e.layerUnderCropping=de.cloneDeep(n);else{const r=e.props.getBackgroundLayer();r&&t===r.id&&(e.layerUnderCropping=de.cloneDeep(r))}}}function tc(e){var n,r,i;const t=(n=e.layerUnderCropping)==null?void 0:n.id;if(t){const a=X(e),s=Ds(e,t);if(s){if(e.layerUnderCropping){const o={left:e.layerUnderCropping.left,top:e.layerUnderCropping.top,width:e.layerUnderCropping.width,height:e.layerUnderCropping.height,rotate:e.layerUnderCropping.rotate},u=de.cloneDeep(e.layerUnderCropping.image);a.update({layer:s,data:{...o,image(c){Object.assign(c,de.cloneDeep(u))}}}),s.parentId&&$n(e,s,{step:a}),e.selectedSingleLayer&&ft(e,e.selectedSingleLayer)}}else{const o=e.props.getBackgroundLayer();o&&t===o.id&&Object.assign(o,de.cloneDeep(e.layerUnderCropping))}(i=(r=e.props).doAction)==null||i.call(r,a.getNewAction()),Ce(e)}e.layerUnderCropping=null}function op({localStore:e,layerList:t,step:n}){t.forEach(r=>{n.update({layer:r,data:{isLocked:!0}})}),t.length>1&&ce(e,{type:"clear"})}function nc({layer:e,step:t}){t.update({layer:e,data:{isLocked:!1}})}function up(e){e.editingText=!1}function Aa(e){var t,n;e.isFullyFunctional!==!1&&(e.editingText=!0,(n=(t=e.props).doAction)==null||n.call(t,{type:"RerenderCanvas"}))}function dp(e,t,n,r){var i,a;r.update({layer:t,data:{textAutoResize:n}}),mu({localStore:e,layer:t,step:r,instanceChain:[]}),Kt({localStore:e,layer:t,instanceChain:[],step:r}),(a=(i=e.props).doAction)==null||a.call(i,r.getNewAction())}function vi({localStore:e,layer:t,step:n,resizeOriginType:r}){const i=t.nodeType==="INSTANCE"?[t]:[];if(r==="left"||r==="right"||r==="leftTop"||r==="leftBottom"||r==="rightTop"||r==="rightBottom"){const a=ja(e,t);yu({localStore:e,layer:t,size:"Fixed",containerStackMode:(a==null?void 0:a.stackMode)||"NONE",instanceChain:i,step:n})}if(r==="top"||r==="bottom"||r==="leftTop"||r==="leftBottom"||r==="rightTop"||r==="rightBottom"){const a=ja(e,t);xu({localStore:e,layer:t,size:"Fixed",containerStackMode:(a==null?void 0:a.stackMode)||"NONE",instanceChain:i,step:n})}(r==="leftTop"||r==="leftBottom"||r==="rightTop"||r==="rightBottom")&&t.nodeType==="TEXT"&&n.update({layer:t,data:{textAutoResize:"NONE"}})}function xt({localStore:e,layer:t,targetSize:n,origin:r,step:i}){let a=t.width,s=t.height;r==="left"||r==="right"?a=n.x:(r==="top"||r==="bottom")&&(s=n.y);const o=wu(t,a,s,r);bu({localStore:e,layer:t,left:o.x,top:o.y,width:a,height:s,step:i})}function so(e,t,n,r,i,a){const s=oo(e,t,n,r);xt({localStore:e,layer:n,targetSize:s,origin:r,step:i})}function oo(e,t,n,r,i){const a=n,s=Ct(a),o=e.getPointInContainer(t),u={x:o.x-s.x,y:o.y-s.y},c=Ar("rotated",u,a.rotate);let f=n.width,l=n.height;{const y=gn(e),g={width:e.props.getCurrentPage().width,height:e.props.getCurrentPage().height};if(y&&(g.width=y.width,g.height=y.height),g.width>0&&g.height>0){const h=jr({type:"RESIZING",localStore:e,layer:n,x:"x",width:"width",origin:r,roomSize:g}),v=jr({type:"RESIZING",localStore:e,layer:n,x:"y",width:"height",origin:r,roomSize:g});h&&typeof h.size=="number"&&(f=h.size,e.bunchRectangleXFixed=!0),v&&typeof v.size=="number"&&(l=v.size,e.bunchRectangleYFixed=!0)}}Xi(e,t,null);const{LAYER_MINIMUN_SIZE:p}=e.options;return e.bunchRectangleXFixed===!1&&(r==="left"?f=c.x+a.width/2:r==="right"&&(f=-(c.x-a.width/2))),f<p&&(f=p),e.bunchRectangleYFixed===!1&&(r==="top"?l=c.y+a.height/2:r==="bottom"&&(l=-(c.y-a.height/2))),l<p&&(l=p),{x:f,y:l}}function rc(e){const t=[];return Object.keys(e).forEach(n=>{const r=n,i=e[r];t.push({key:r,value:i})}),t}function ki({localStore:e,layer:t,targetSize:n,origin:r,step:i}){var a,s;if(t.nodeType==="TEXT")e.editingText=!1,(r==="left"||r==="right")&&Lu({localStore:e,layer:t,instanceChain:[]})==="Hug"&&i.update({layer:t,data:{textAutoResize:"HEIGHT"}}),vi({localStore:e,layer:t,step:i,resizeOriginType:r}),Eu({localStore:e,layer:t,step:i,instanceChain:[]}),xt({localStore:e,layer:t,targetSize:n,origin:r,step:i});else if(t.nodeType==="svg")xt({localStore:e,layer:t,targetSize:n,origin:r,step:i}),Os(t);else if(t.nodeType==="vector")xt({localStore:e,layer:t,targetSize:n,origin:r,step:i});else if(t.nodeType==="video")ac({localStore:e,layer:t,targetSize:n,origin:r,step:i});else if(t.nodeType==="IMAGE"||t.nodeType==="ROUNDED_RECTANGLE")_a({localStore:e,layer:t,step:i,origin:r,targetSize:n});else if(t.nodeType==="FRAME"||t.nodeType==="SYMBOL"||t.nodeType==="INSTANCE"){if(vi({localStore:e,layer:t,step:i,resizeOriginType:r}),t.nodeType==="SYMBOL"){const o=e.getFigma();if(o){const u=Tu(o.context.fileData,t);rc(u).forEach(c=>{vi({localStore:e,layer:c.value,step:i,resizeOriginType:r})})}}_a({localStore:e,layer:t,step:i,origin:r,targetSize:n})}else t.nodeType==="SECTION"&&xt({localStore:e,layer:t,targetSize:n,origin:r,step:i});Ss({localStore:e,layer:t,step:i}),Kt({localStore:e,layer:t,instanceChain:[],step:i}),(s=(a=e.props).doAction)==null||s.call(a,i.getNewAction())}function ic(e,t){const n=e.selectedSingleLayer;if(n){const r=X(e),i=oo(e,t,n,e.resizeOriginType),a=e.resizeOriginType;ki({localStore:e,layer:n,targetSize:i,origin:a,step:r})}ue(e,t)}function cp({localStore:e,width:t,height:n,step:r}){const i=e.selectedSingleLayer;i&&(t&&!n?(e.resizeOriginType="left",ki({localStore:e,layer:i,targetSize:{x:Math.max(t,e.options.LAYER_MINIMUN_SIZE),y:i.height},origin:"left",step:r})):!t&&n&&ki({localStore:e,layer:i,targetSize:{x:i.width,y:Math.max(n,e.options.LAYER_MINIMUN_SIZE)},origin:"top",step:r}))}function ac({localStore:e,layer:t,step:n,targetSize:r,origin:i}){const a=t.width,s=t.height;xt({localStore:e,layer:t,origin:i,targetSize:r,step:n});const o={x:t.width/a,y:t.height/s};t.video.width*=o.x,t.video.height*=o.y}function _a({localStore:e,layer:t,step:n,targetSize:r,origin:i}){if(!t.image)xt({localStore:e,layer:t,targetSize:r,origin:i,step:n});else if(t.image.imageScaleMode==="FILL")xt({localStore:e,layer:t,targetSize:r,origin:i,step:n}),Rs(e,t,!0);else if(t.image.imageScaleMode==="STRETCH"&&t.image){const a=t.width,s=t.height;xt({localStore:e,layer:t,targetSize:r,origin:i,step:n});const o={x:t.width/a,y:t.height/s};n.update({layer:t,data:{image(u){u.width*=o.x,u.imageX*=o.x,u.height*=o.y,u.imageY*=o.y}}})}}function Ba(e,t,n,r){const i=X(e);if(t){const a=Ct(t);so(e,n,t,e.resizeOriginType,i);const s=Ct(t);Pu(t,Ns(a,s))}}function $a(e,t,n){t.image&&(t.image.imageScaleMode==="STRETCH"?(An(e),Cu({layer:t,step:n})):(An(e),Vs(e,t,n)))}function fp(e,t,n){if(t.strokeWidth=n,t.data.type==="line"){const r=X(e);Os(t),ft(e,t),t.parentId&&$n(e,t,{step:r})}}function za(e,t,n){const r=X(e);if(t&&(e.resizeOriginType==="leftTop"||e.resizeOriginType==="rightTop"||e.resizeOriginType==="leftBottom"||e.resizeOriginType==="rightBottom")){const i=kt(t)[e.resizeOriginType],a=Fu(e,t,i,n);t.width*a>=e.options.LAYER_MINIMUN_SIZE&&t.height*a>=e.options.LAYER_MINIMUN_SIZE&&(Iu(e,t,i,a,r),ft(e,t))}}function Wa(e,t,n,r){const i=X(e),a=[];e.resizeOriginType==="leftTop"?(a.push("left"),a.push("top")):e.resizeOriginType==="rightTop"?(a.push("right"),a.push("top")):e.resizeOriginType==="leftBottom"?(a.push("left"),a.push("bottom")):e.resizeOriginType==="rightBottom"&&(a.push("right"),a.push("bottom")),a.forEach(s=>{so(e,n,t,s,i)})}function sc(e,t){const n=e.split(","),r=n[0].match(/:(.*?);/)[1],i=r.split("/")[1],a=atob(n[1]);let s=a.length;const o=new Uint8Array(s);for(;s--;)o[s]=a.charCodeAt(s);return new File([o],`${t}.${i}`,{type:r})}function oc(e,t){return new Promise((n,r)=>{const i=new Image;i.setAttribute("crossOrigin","Anonymous");const a=document.createElement("canvas"),s=a.getContext("2d");i.onload=()=>{const{width:o,height:u}=i;a.height=u,a.width=o,s.drawImage(i,0,0,o,u),n(a.toDataURL("image/png"))},i.onerror=o=>{r(new Error("图片加载失败"))},i.src=e})}let da={};function lp(e){const t=ju();return da[t]=uc(e),t}function Ua(e){return da[e]}function uc(e){const t=document.createElement("canvas");return eo(t,e),t}function gp(){da={}}function Mr(e){if(!e)throw new Error("layer.textData does not exist");if(e.characters.length!==e.characterStyleIDs.length)throw new Error("Characters length does not equal characterStyleIDs length!!");const t={};if(e.styleOverrideTable.forEach(r=>{const{styleID:i}=r;if(t[i])throw new Error(`Duplicated styleID: ${i}`);t[i]=r}),t[0])throw new Error("Unexpected styleID 0");const n=new Set;if(e.characterStyleIDs.forEach(r=>{r!==0&&n.add(r)}),n.forEach(r=>{if(!t[r])throw new Error(`Could not find style override. styleID = ${r}`);delete t[r]}),Object.keys(t).length!==0)throw new Error("Useless style override found")}function Ha({localStore:e,start:t,length:n}){const r=X(e),i=e.selectedSingleLayer;if((i==null?void 0:i.nodeType)==="TEXT"&&i.textData&&t>=0&&n>0){const a=i.textData.characters.substring(0,t)+i.textData.characters.substring(t+n),s=[...i.textData.characterStyleIDs];s.splice(t,n),r.update({layer:i,data:{textData(o){o.characters=a,o.characterStyleIDs=[...s];const u=new Set;s.forEach(c=>{u.add(c)}),o.styleOverrideTable=o.styleOverrideTable.filter(c=>u.has(c.styleID))}}}),Mr(i.textData),e.selectionInfo.textRange$.start=t,e.selectionInfo.textRange$.end=t,Br(e,i,[],r),Kt({localStore:e,layer:i,instanceChain:[],step:r})}}function dc({localStore:e,str:t,mode:n}){var a,s;const r=e.selectedSingleLayer,i=X(e);if((r==null?void 0:r.nodeType)==="TEXT"&&r.textData){Mr(r.textData);const{inputText:o}=e.advancedTextEditor;let{characters:u}=r.textData;const c=[...r.textData.characterStyleIDs];let f=0,l=0,p=0,y=0;if(n==="composition"){const{start:g}=o;o.compositionText&&(p=g,y=o.compositionText.length),l=g,o.compositionText=t}else{const{start:g,end:h}=e.selectionInfo.textRange$;g===h&&(l=g)}{let g=l-1;g<0&&(g=0),typeof c[g]=="number"&&(f=c[g])}y>0&&(u=u.substring(0,p)+u.substring(p+y),c.splice(p,y));{let g="";const h=[];if(l===u.length)c.forEach(v=>{h.push(v)}),h.push(...t.split("").map(()=>f)),g=u+t;else if(l>=0&&l<u.length)c.forEach((v,b)=>{b===l&&h.push(...t.split("").map(()=>f)),h.push(v)}),g=u.substring(0,l)+t+u.substring(l);else throw new Error("");i.update({layer:r,data:{textData(v){v.characters=g,v.characterStyleIDs=[...h]}}}),e.selectionInfo.textRange$.start=l+t.length,e.selectionInfo.textRange$.end=l+t.length,Mr(r.textData)}Br(e,r,[],i),Kt({localStore:e,layer:r,instanceChain:[],step:i}),(s=(a=e.props).doAction)==null||s.call(a,i.getNewAction())}}function cc(e){let t=0;return e.styleOverrideTable.forEach(n=>{n.styleID>t&&(t=n.styleID)}),t+1}function hp({localStore:e,layer:t,step:n,segmentData:r,globalData:i,fillPaints:a}){var u,c;const{start:s,end:o}=e.selectionInfo.textRange$;if(i&&n.update({layer:t,data:i}),console.log({segmentData:r}),e.editingText&&(r||a))if(s===o){let f=0;s>0?f=t.textData.characterStyleIDs[s-1]:f=t.textData.characterStyleIDs[s]||0,f>0?n.update({layer:t,data:{textData(l){const p=l.styleOverrideTable.find(y=>y.styleID===f);if(p)Object.assign(p,de.cloneDeep(r)),a&&(p.fillPaints=p.fillPaints||[],a(p.fillPaints));else throw new Error("override not found")}}}):(r&&n.update({layer:t,data:r}),a&&n.update({layer:t,data:{fillPaints:a}}))}else s!==o&&n.update({layer:t,data:{textData(f){Mu({start:s,end:o,textData:f}).forEach(p=>{if(p.styleID!==0&&p.styleID!==p.prevOne&&p.styleID!==p.nextOne){const y=f.styleOverrideTable.find(g=>g.styleID===p.styleID);if(y)Object.assign(y,de.cloneDeep(r)),a&&(y.fillPaints=y.fillPaints||[],a(y.fillPaints));else throw new Error("override not found")}else{const y=cc(f),g=p.styleID===0?{fillPaints:t.fillPaints}:f.styleOverrideTable.find(v=>v.styleID===p.styleID),h={...de.cloneDeep(g),styleID:y,...de.cloneDeep(r)};a&&(h.fillPaints=h.fillPaints||[],a(h.fillPaints)),f.styleOverrideTable.push(h);for(let v=p.start;v<p.end;v+=1)f.characterStyleIDs[v]=y}})}}});else r&&n.update({layer:t,data:r}),a&&n.update({layer:t,data:{fillPaints:a}});Mr(t.textData),As(t),Br(e,t,[],n),Kt({localStore:e,layer:t,instanceChain:[],step:n}),(c=(u=e.props).doAction)==null||c.call(u,n.getNewAction())}function fc(e,t,{step:n,enforceCoveringLayer:r}){if(e.image){if(e.image.imageScaleMode==="FILL"){const i=ku({frame:e,image:e.image}),s=Du({frame:e,image:e.image})/i*100,o=r?Li([s,t]):t,u=i*o/100,c=e.image.naturalWidth*u,f=e.image.naturalHeight*u,l=c/e.image.width;n.update({layer:e,data:{image(p){p.width=c,p.height=f,p.imageX*=l,p.imageY*=l}}})}else if(e.image.imageScaleMode==="STRETCH"){const i=Ou(e),a=t/100*i,s=a/e.image.width;n.update({layer:e,data:{image(o){o.width=a,o.height*=s,o.imageX*=s,o.imageY*=s}}})}}}function pp(e,t){if(t.image){const n=X(e);An(e),Ei(t,{step:n})}}function lc(e,t,n){let r=gi;const i=e.getPointInPage(n);if(!e.imageLayerUnderEditing)return 100;const a=Ct(e.imageLayerUnderEditing),s=Ns(a,i),o=s.x*e.getPageScale();return Ru(e,s.x),o>=47?r=gi:o>=24&&o<47?r=e.pointerDownScalePercent+(o-24)/23*(gi-e.pointerDownScalePercent):o>=10&&o<24?r=100+(o-10)/14*(e.pointerDownScalePercent-100):r=100,r}let Lr=!1;function Fn(e,t){return e.key===t}function gc({e,localStore:t}){var r,i;const n=t.selectedSingleLayer;if((n==null?void 0:n.nodeType)==="TEXT"&&n.textData)if(e.key==="ArrowRight"){e.preventDefault();let{start:a}=t.selectionInfo.textRange$;a+=1,a>n.textData.characters.length&&(a=n.textData.characters.length),t.selectionInfo.textRange$.start=a,t.selectionInfo.textRange$.end=a}else if(e.key==="ArrowLeft"){e.preventDefault();let{start:a}=t.selectionInfo.textRange$;a-=1,a<0&&(a=0),t.selectionInfo.textRange$.start=a,t.selectionInfo.textRange$.end=a}else if(Fn(e,"ArrowUp"))e.preventDefault(),Vu({localStore:t,layer:n});else if(Fn(e,"ArrowDown"))e.preventDefault(),Nu({localStore:t,layer:n});else if(Fn(e,"Delete")||Fn(e,"Backspace")){if(t.advancedTextEditor.inputMode==="single"){const{start:a,end:s}=t.selectionInfo.textRange$;Ha(a===s?{localStore:t,start:a-1,length:1}:{localStore:t,start:a,length:s-a})}}else Fn(e,"Enter")&&t.advancedTextEditor.inputMode==="single"&&(e.preventDefault(),dc({localStore:t,str:`
`,mode:"single"}));(i=(r=t.props).doAction)==null||i.call(r,{type:"RerenderCanvas"})}function hc(e,t,n){if((t.key==="Meta"||t.key==="Control")&&(e.controlKeyUnderPress=!0),!Lr){if(e.editingText&&e.options.useTextEditor==="ADVANCED_EDITOR"&&e.advancedTextEditor.inputElement===document.activeElement){gc({localStore:e,e:t});return}if(!(t.key==="Meta"||t.key==="Control"||t.key==="Alt"||t.key==="Shift"))if(t.code==="KeyZ"){if(t.ctrlKey||t.metaKey){const r=e.getFigma();t.shiftKey?e.shortcutMap["Shift + Meta + Z"]?e.shortcutMap["Shift + Meta + Z"]():r?e.history.redo():n.canRedo&&n.redo():e.shortcutMap["Meta + Z"]?e.shortcutMap["Meta + Z"]():r?e.history.undo():n.canUndo&&n.undo()}}else if(t.key==="Delete"||t.key==="Backspace"){let r="";if(document.activeElement&&(r=document.activeElement.tagName),r!=="INPUT"){if(e.editingText)return;e.shortcutMap.Delete&&e.shortcutMap.Delete(t)}Lr=!0}else{const r=[];r.push(t.key),t.altKey&&r.unshift("Alt"),(t.ctrlKey||t.metaKey)&&r.unshift("Meta"),t.shiftKey&&r.unshift("Shift");const i=r.join(" + ");e.shortcutMap[i]&&e.shortcutMap[i](t),Lr=!0}}}function pc(e,t,n){Lr=!1,(t.key==="Meta"||t.key==="Control")&&(e.controlKeyUnderPress=!1)}function uo(e,t,n){var a,s,o;const r=e.getFigma(),i=_u(e,t.parentId)||((a=e.getFigma())==null?void 0:a.currentPage);r&&i&&i.nodeType!=="DOCUMENT"&&(i.children.push(t),Bu(r.context.fileData,t),n.update({layer:i,data:{life:{type:"createChildren",newLayers:{[t.id]:t},children:i.children.map(u=>u.id)}}}),(o=(s=e.props).doAction)==null||o.call(s,n.getNewAction()))}function vc(e,t,n,r){const i=Au(e);i.parentId=t,i.left=n.left,i.top=n.top,i.width=n.width,i.height=n.height,i.name="Unnamed frame";const a=Vt(e);return uo(e,i,a),Ce(e),i.id}function mc({localStore:e}){var n,r;e.editingVector={currentOperation:null},e.getFigma()&&e.selectedSingleLayer&&e.selectedSingleLayer.nodeType==="vector"&&$u({localStore:e,vectorData:e.selectedSingleLayer.vectorData}),(r=(n=e.props).doAction)==null||r.call(n,{type:"UpdateNodes",payload:{layerMap:{}}})}function yc({localStore:e,figma:t,e:n,step:r}){const i=zu(e),{fileData:a}=t.context,s=ut(a,n);return i.left=s.x,i.top=s.y,e.editingVector={currentOperation:null},i.strokeGeometry=[{styleID:0,windingRule:"NONZERO",commands:[]}],i.strokePaints=[{type:"SOLID",color:Wu("#000000").toFigmaColor(),opacity:1,blendMode:"NORMAL",visible:!0}],uo(e,i,r),i}function gr(){return{styleID:0,start:{vertex:0,dx:0,dy:0},end:{vertex:0,dx:0,dy:0}}}function vp(e){const t={vectorNetwork:{vertices:[],segments:[],regions:[]},normalizedSize:{x:0,y:0},styleOverrideTable:[]},{vertices:n,segments:r}=t.vectorNetwork;let i=null,a=gr(),s={segments:[]};const o={currentPathStart:0},u={type:"M",index:0,numbers:[]};e.forEach(f=>{const l={styleID:0,windingRule:f.windingRule,loops:[]};t.vectorNetwork.regions.push(l);const p=[...f.cmds];for(;p.length>0;){const y=p[0];if(typeof y=="string")y==="M"?(u.type="M",u.index=0,s={segments:[]},l.loops.push(s)):y==="L"?(a=gr(),u.type="L",u.index=0):y==="C"?(a=gr(),u.type="C",u.index=0,u.numbers=[]):y==="Z"&&(a=gr(),a.start.vertex=n.length-1,a.end.vertex=o.currentPathStart,r.push(a),s.segments.push(r.length-1)),i={styleID:0,x:0,y:0};else if(typeof y=="number")if(i){if(u.type==="M")u.index===0?i.x=y:u.index===1&&(i.y=y,n.push(i),o.currentPathStart=n.length-1);else if(u.type==="L")u.index===0?i.x=y:u.index===1&&(i.y=y,n.push(i),a.start.vertex=n.length-2,a.end.vertex=n.length-1,r.push(a),s.segments.push(r.length-1));else if(u.type==="C"){if(u.numbers.push(y),u.index===5){a.start.vertex=n.length-1;const g=n[n.length-1];i.x=u.numbers[4],i.y=u.numbers[5],n.push(i),a.end.vertex=n.length-1,a.start.dx=u.numbers[0]-g.x,a.start.dy=u.numbers[1]-g.y,a.end.dx=u.numbers[2]-i.x,a.end.dy=u.numbers[3]-i.y,r.push(a),s.segments.push(r.length-1)}}else if(u.type!=="Z")throw new Error("");u.index+=1}else throw new Error("");p.shift()}});const c=_s(t);return t.normalizedSize={x:c.x,y:c.y},t}function Rr({localStore:e,e:t}){e.pointerTarget$$=xc({localStore:e,e:t})}function xc({localStore:e,e:t}){const n=e.getFigma();if(!n)return null;const r=zn({localStore:e});if(r){const i=ut(n.context.fileData,t),a={x:n.context.fileData.doScale(i.x),y:n.context.fileData.doScale(i.y)};if(e.editingVector){const g=[...n.context.fileData.overlay$$];for(;g.length>0;){const v=g[g.length-1];if(v&&(v.type==="VectorVertex"||v.type==="BezierControlPoint")&&Math.abs(a.x-v.visualPoint.x)<4&&Math.abs(a.y-v.visualPoint.y)<4)return e.currentTool==="MoveTool"&&e.setCursor("grab"),{...v};g.pop()}const h=e.selectedSingleLayer;if(h&&h.nodeType==="vector"&&e.vectorEditor){const v=qt({fileData:n.context.fileData,info:{type:"layer",layerId:h.id}}),b=Te(v,i),{x:m,y:w}=Er({layer:h,localPoint:b});let P=null;if(e.vectorEditor.closedPathList.forEach((E,L)=>{E.contains(m,w)&&(P={type:"VectorRegion",regionId:L})}),P)return P}return e.currentTool==="MoveTool"?e.setCursor("auto"):e.setCursor("crosshair"),null}const{absoluteTransform:s,layer:o,instanceChain:u}=_r({fileData:n.context.fileData,target:r}),c=Te(s,i),f=On({localStore:e,layer:o,instanceChain:u}),{width:l,height:p}=f,y=e.getPageScale();if(r.type==="phantom"&&Tr(c,{width:l,height:p}))return e.setCursor("auto"),{type:"resizer"};if(Math.abs(c.x)<5/y&&Math.abs(c.y)<5/y)return e.setCursor("nwse-resize"),{type:"LayerAnchor",origin:"rightBottom"};if(Math.abs(c.x-l)<5/y&&Math.abs(c.y-p)<5/y)return e.setCursor("nwse-resize"),{type:"LayerAnchor",origin:"leftTop"};if(Math.abs(c.x)<5/y&&Math.abs(c.y-p)<5/y)return e.setCursor("nesw-resize"),{type:"LayerAnchor",origin:"rightTop"};if(Math.abs(c.x-l)<5/y&&Math.abs(c.y)<5/y)return e.setCursor("nesw-resize"),{type:"LayerAnchor",origin:"leftBottom"};if(Math.abs(c.x)<5/y&&c.y>0&&c.y<p)return e.setCursor("ew-resize"),{type:"border",origin:"right"};if(Math.abs(c.x-l)<5/y&&c.y>0&&c.y<p)return e.setCursor("ew-resize"),{type:"border",origin:"left"};if(Math.abs(c.y)<5/y&&c.x>0&&c.x<l)return e.setCursor("ns-resize"),{type:"border",origin:"bottom"};if(Math.abs(c.y-p)<5/y&&c.x>0&&c.x<l)return e.setCursor("ns-resize"),{type:"border",origin:"top"};if(c.x>l&&c.x<l+10/y&&c.y>p&&c.y<p+10/y)return e.setCursor("alias"),{type:"rotater"};if(Tr(c,{width:l,height:p}))return e.setCursor("auto"),{type:"resizer"}}return e.setCursor("auto"),null}function co({localStore:e,fileData:t,layer:n,instanceChain:r,boundingStack:i,transform:a}){const s=On({localStore:e,layer:n,instanceChain:r}),o=[{x:0,y:0},{x:0,y:s.height},{x:s.width,y:s.height},{x:s.width,y:0}];a&&o.forEach(u=>{const c=Bs(a,u);u.x=c.x,u.y=c.y}),i.push(o),((n.nodeType==="FRAME"||n.nodeType==="SYMBOL"||n.nodeType==="INSTANCE")&&s.frameMaskDisabled===!0||n.nodeType==="SECTION")&&Qi(t,n).forEach(c=>{const f=On({localStore:e,instanceChain:Vn(r,c),layer:c}),l=Si(f);co({localStore:e,fileData:t,layer:c,instanceChain:Vn(r,c),transform:Uu(a,l),boundingStack:i})})}function wc({e,localStore:t,fileData:n}){const r=zn({localStore:t});if(r){const{layer:i,absoluteTransform:a,instanceChain:s}=_r({fileData:n,target:r}),o=Ot(t,e),u=Te(a,o),c=Cc({fileData:n,layer:i,pointerInContainer:u,instanceChain:s});if(c){if(r.type==="entity"){if(i.nodeType==="INSTANCE"){const f=Hu(t,i);ce(t,{type:"$target",target:{type:"phantom",id:c.id,completeChain:f.map(l=>({id:l.id,nodeType:l.nodeType})).concat([{id:c.id,nodeType:c.nodeType}])}});return}ce(t,{type:"replace",idList:[c.id]});return}r.type==="phantom"&&ce(t,{type:"$target",target:{type:"phantom",id:c.id,completeChain:r.completeChain.concat([{id:c.id,nodeType:c.nodeType}])}})}}}function bc(e,t){const n=[],{localStore:r}=e,i=zn({localStore:r});if(r.controlKeyUnderPress===!1&&i){const{layer:o,absoluteTransform:u,instanceChain:c}=_r({fileData:e,target:i}),f=Te(u,t),l=On({localStore:e.localStore,layer:o,instanceChain:c});if(Tr(f,{width:l.width,height:l.height}))return null}const s=[...e.localStore.props.getCurrentPage().children].reverse();for(let o=0;o<s.length;o+=1){const u=s[o];if(u){const c=fo({fileData:e,pointInContainer:t,parent:null,layer:u,instanceChain:u.nodeType==="INSTANCE"?[u]:[],chain:n,currentSelection:i});if(c){const f=n.filter(p=>p.nodeType==="INSTANCE").map(p=>p.id),l={type:f.length>0&&f[f.length-1]!==c.id?"phantom":"entity",id:c.id,completeChain:n};return console.log("chain",n.map(p=>p.nodeType).join(",")),l}}}return null}function Cc({layer:e,fileData:t,pointerInContainer:n,instanceChain:r}){if(e&&(e.nodeType==="FRAME"||e.nodeType==="SYMBOL"||e.nodeType==="INSTANCE")){const i=[...Qi(t,e)].reverse();for(let a=0;a<i.length;a+=1){const s=i[a],o=On({localStore:t.localStore,layer:s,instanceChain:Vn(r,s)});if(!o.visible)continue;const u=Si(o),c=Te(u,n);if(lo(t,c,s,Vn(r,s))===!0)return s}}return null}function fo({fileData:e,pointInContainer:t,parent:n,layer:r,instanceChain:i,chain:a,currentSelection:s}){i=Vn(i,r);const o=Gu({localStore:e.localStore,layer:r,instanceChain:i});if(o.visible===!1)return null;const u=Si(o),c=Te(u,t);if(lo(e,c,r,i)===!1)return null;if(a.push({id:r.id,nodeType:r.nodeType}),e.localStore.controlKeyUnderPress===!1&&!(s!=null&&s.completeChain.map(l=>l.id).includes(r.id))){if(n&&(s!=null&&s.completeChain.map(l=>l.id).includes(n.id)))return r;if(r.nodeType!=="SECTION")if(n===null||n.nodeType==="SECTION")if(r.nodeType==="FRAME"){if(!e.localStore.options.ignoreRootFrames)return r}else return r;else return r}if(r.nodeType==="FRAME"||r.nodeType==="SYMBOL"||r.nodeType==="INSTANCE"||r.nodeType==="GROUP"||r.nodeType==="SECTION"){const l=[...Qi(e,r)].reverse();for(let p=0;p<l.length;p+=1){const y=l[p];if(y){const g=fo({fileData:e,pointInContainer:c,parent:r,layer:y,instanceChain:i,chain:a,currentSelection:s});if(g)return g}}}return Tr(c,o)?r:null}function lo(e,t,n,r){const i=[];for(co({localStore:e.localStore,layer:n,instanceChain:r,fileData:e,boundingStack:i,transform:[[1,0,0],[0,1,0],[0,0,1]]});i.length>0;){const a=i[0];if(ea(t,a))return!0;i.shift()}return!1}function Pc({localStore:e,e:t}){var r,i;const n=tt(e);if(n){const{fileData:a}=n;if(Rr({localStore:e,e:t}),e.currentTool==="MoveTool"&&e.currentStatus===""){const s=Ot(e,t),o=bc(n.fileData,s);console.log(o),o&&e.getSelectedLayerIdList().includes(o.id)===!1?a.hoveredTarget=o:a.hoveredTarget=null}else n.fileData.hoveredTarget=null;(i=(r=e.props).doAction)==null||i.call(r,{type:"RerenderCanvas"})}}function Lc(e,t,n){t.stopPropagation(),e.pointerDownScalePercent=e.scalePercentDisplayed,e.currentStatus="pointerDownOnImageControllerScaler",fe(e,t)}function ca(e,t){var n,r;t.stopPropagation(),t.button===2?(e.currentStatus="rightPointDownOnResizer",e.getFigma()&&(t.preventDefault(),e.layerWithMenuId=((n=e.selectedSingleLayer)==null?void 0:n.id)||"",e.menuX=t.pageX,e.menuY=t.pageY,e.menuShow=!0)):e.editingText&&((r=e.selectedSingleLayer)==null?void 0:r.nodeType)==="TEXT"?kc(e,t):(e.currentStatus="pointerDownOnResizer",fe(e,t))}function Ec({localStore:e,e:t}){t.stopPropagation(),e.currentStatus="pointerDownOnParentGroup"}function go(e,t){Vt(e),t.stopPropagation(),e.currentStatus="rotatingLayers",fe(e,t)}function ho(e,t,n){t.preventDefault(),t.stopPropagation(),Vt(e),e.currentStatus="resizingLayersByCorner",e.layersCanBeScaled=!0,fe(e,t),e.resizeOriginType=n,e.resizeTransformOrigin=kt(e.bunchRectangle)[n]}function Hn(e,t,n){t.stopPropagation(),e.currentStatus="pointerDownOnLayerBorder",e.resizeOriginType=n,fe(e,t)}function hr(e,t,n){n.stopPropagation(),e.currentStatus="resizingImageLayerFrameByCorner",e.resizeAndKeepRatio=!0,e.resizeOriginType=t,fe(e,n)}function pr(e,t,n){n.stopPropagation(),e.currentStatus="resizingImageLayerFrameByBorder",e.resizeAndKeepRatio=!1,e.resizeOriginType=t,fe(e,n)}function Tc(e,t,n){e.currentStatus="drawingEraserPath",Yd(e,t,n)}function Fc(e,t){t.stopPropagation(),e.currentStatus="draggingThumbnail",fe(e,t)}function Ic(e,t){if(t.button===2)e.currentStatus="rightPointDownOnWorkspace",t.stopPropagation(),t.preventDefault(),ua(e,null,t);else{const n=tt(e);n?(fe(e,t),Mc({localStore:e,e:t,context:n}),e.isMobile&&(t.isPrimary,(e.currentStatus==="pointerDownOnWorkspace"||e.currentTool==="HandTool")&&(e.currentStatus="tryManipulatingWorkspace"))):(e.currentStatus="pointerDownOnWorkspace",fe(e,t),e.getNormalLayerList().length>0&&Ti(e,t))}}function jc(e,t,n,r){if(n){if(n.type==="LayerAnchor"){ft(e,t),ho(e,r,n.origin);return}if(n.type==="border"){ft(e,t),Hn(e,r,n.origin);return}if(n.type==="rotater"){go(e,r);return}n.type==="resizer"&&ca(e,r)}}function Mc({localStore:e,e:t,context:n}){if(e.currentTool==="MoveTool"){Pc({localStore:e,e:t}),Rr({localStore:e,e:t});const{pointerTarget$$:r}=e;if(r)if(r.type==="VectorVertex")e.currentStatus="vector: pointerDownOnVectorVertex",e.editingVector&&(e.editingVector.currentOperation=de.cloneDeep(r));else if(r.type==="BezierControlPoint")e.currentStatus="vector: movingVectorControlPoint",e.editingVector&&(e.editingVector.currentOperation=de.cloneDeep(r));else{const i=zn({localStore:e});i&&(i.type==="entity"?e.selectedSingleLayer&&jc(e,e.selectedSingleLayer,r,t):i.type==="phantom"&&ca(e,t))}else n.fileData.hoveredTarget?(e.currentStatus="pointerDownOnHoveredLayer",e.isMobile===!1&&Ti(e,t)):(e.currentStatus="pointerDownOnWorkspace",e.isMobile===!1&&Ti(e,t));fe(e,t)}else if(e.currentTool==="DrawRectTool"){const r=e.getFigma();r&&(r.layerToBeCreated.startWorldPoint=ut(r.context.fileData,t),r.layerToBeCreated.endWorldPoint=null,e.currentStatus="drawingLayerRect")}else e.currentTool==="VectorPenTool"&&Rc({localStore:e,e:t})}function Rc({localStore:e,e:t}){var r,i,a,s,o,u,c;const n=e.getFigma();if(n&&e.editingVector)if(e.selectedSingleLayer){if(((r=e.selectedSingleLayer)==null?void 0:r.nodeType)==="vector"){const{fileData:f}=n.context,l=e.selectedSingleLayer,p=Vt(e),y=ut(f,t);if(e.editingVector.currentOperation===null){Rr({localStore:e,e:t});const{pointerTarget$$:g}=e;if((g==null?void 0:g.type)==="VectorVertex"){fe(e,t);const h=l.vectorData.vectorNetwork.vertices[g.vertexIndex];e.editingVector.currentOperation={type:"SegmentCandidate",status:"",startVertex:{vid:g.vertexIndex,x:h.x,y:h.y,dx:0,dy:0},endVertex:{vid:-1,x:h.x,y:h.y,dx:0,dy:0}},e.currentStatus="vector: pointerDownOnStartVertex",(a=(i=e.props).doAction)==null||a.call(i,p.getNewAction())}else{fe(e,t);const h=cn(f,{type:"layer",layerId:l.id}),v=Te(h.absoluteTransform,y),b=l.width/l.vectorData.normalizedSize.x,m=l.height/l.vectorData.normalizedSize.y,w={x:v.x/b,y:v.y/m};e.editingVector.currentOperation={type:"SegmentCandidate",status:"",startVertex:{vid:-1,x:w.x,y:w.y,dx:0,dy:0},endVertex:{vid:-1,x:w.x,y:w.y,dx:0,dy:0}},e.currentStatus="vector: pointerDownOnStartVertex",(o=(s=e.props).doAction)==null||o.call(s,p.getNewAction())}}else if(e.segmentCandidate){Rr({localStore:e,e:t});const{pointerTarget$$:g}=e;if((g==null?void 0:g.type)==="VectorVertex"){e.currentStatus="vector: pointerDownOnEndVertex",e.segmentCandidate.endVertex.vid=g.vertexIndex;const h=l.vectorData.vectorNetwork.vertices[g.vertexIndex];if(!h)throw new Error;e.segmentCandidate.endVertex.x=h.x,e.segmentCandidate.endVertex.y=h.y,e.segmentCandidate.endVertex.dx=0,e.segmentCandidate.endVertex.dy=0,e.segmentCandidate.status=""}else{const h=cn(f,{type:"layer",layerId:l.id}),v=Te(h.absoluteTransform,y),b=Er({layer:l,localPoint:v});e.segmentCandidate.endVertex.x=b.x,e.segmentCandidate.endVertex.y=b.y,e.segmentCandidate.status="",e.currentStatus="vector: pointerDownOnEndVertex"}(c=(u=e.props).doAction)==null||c.call(u,p.getNewAction())}}}else{fe(e,t);const f=Vt(e),l=yc({localStore:e,figma:n,e:t,step:f});ce(e,{type:"replace",idList:[l.id]}),e.editingVector.currentOperation={type:"SegmentCandidate",status:"",startVertex:{vid:-1,x:0,y:0,dx:0,dy:0},endVertex:{vid:-1,x:0,y:0,dx:0,dy:0}},e.currentStatus="vector: pointerDownOnStartVertex"}}function kc(e,t){var r,i;const n=e.selectedSingleLayer;if((n==null?void 0:n.nodeType)==="TEXT"&&n.textData){e.currentStatus="pointerDownOnTextRange";const a=Ot(e,t),s=tt(e);if(s&&a){const o=qt({fileData:s.fileData,info:{type:"layer",layerId:n.id}}),u=Te(o,a);s.fileData.paragraphManager.activeParagraph&&(qu({localStore:e,layer:n,paragraph:s.fileData.paragraphManager.activeParagraph,textData:n.textData,scaledX:s.fileData.doScale(u.x),scaledY:s.fileData.doScale(u.y)}),e.advancedTextEditor.initialSelectionIndex=e.selectionInfo.textRange$.start),(i=(r=e.props).doAction)==null||i.call(r,{type:"RerenderCanvas"})}}}function Dc({localStore:e,e:t,step:n}){var i,a,s,o;const r=e.getFigma();if(r){const{fileData:u}=r.context,c=ut(u,t),f=e.selectedSingleLayer;if(f&&f.nodeType==="vector"&&((a=(i=e.editingVector)==null?void 0:i.currentOperation)==null?void 0:a.type)==="VectorVertex"){const l=e.editingVector.currentOperation.vertexIndex;if(l>=0){const p=qt({fileData:u,info:{type:"layer",layerId:f.id}}),y=Te(p,c),g={x:y.x/f.width*f.vectorData.normalizedSize.x,y:y.y/f.height*f.vectorData.normalizedSize.y};n.update({layer:f,data:{vectorData(h){h.vectorNetwork.vertices[l].x=g.x,h.vectorNetwork.vertices[l].y=g.y}}}),(o=(s=e.props).doAction)==null||o.call(s,n.getNewAction())}}}}function Oc({localStore:e,figma:t,layer:n,e:r,step:i}){var f,l,p,y,g,h;const{fileData:a}=t.context,s=ut(a,r);let o=-1,u="start";((l=(f=e.editingVector)==null?void 0:f.currentOperation)==null?void 0:l.type)==="BezierControlPoint"?(o=e.editingVector.currentOperation.segmentId,u=e.editingVector.currentOperation.kind):((y=(p=e.editingVector)==null?void 0:p.currentOperation)==null?void 0:y.type)==="SegmentCandidate"&&(u="end");const c=n.vectorData.vectorNetwork.segments[o];if(c){const v=c[u].vertex,b=n.vectorData.vectorNetwork.vertices[v];if(b){const m=qt({fileData:a,info:{type:"layer",layerId:n.id}}),w=Te(m,s),P={x:w.x/n.width*n.vectorData.normalizedSize.x,y:w.y/n.height*n.vectorData.normalizedSize.y};i.update({layer:n,data:{vectorData(E){var j,T;let L=P.x-b.x,C=P.y-b.y;((T=(j=e.editingVector)==null?void 0:j.currentOperation)==null?void 0:T.type)==="SegmentCandidate"&&(L=-L,C=-C),E.vectorNetwork.segments[o][u].dx=L,E.vectorNetwork.segments[o][u].dy=C}}}),(h=(g=e.props).doAction)==null||h.call(g,i.getNewAction())}}}function Vc(e,t,n){var i,a,s,o,u,c,f,l,p,y,g,h,v,b,m,w,P,E,L;e.pointerMoved=!0;const r=e.getFigma();if(e.currentStatus==="draggingImageInLayer"){if(e.selectedPanel){const C=X(e),j=(n.pageX-e.pointerX)/e.getPageScale(),T=(n.pageY-e.pointerY)/e.getPageScale();Ma(e.selectedPanel,j,T,{step:C,autoAdjust:!0}),ue(e,n)}}else if(e.currentStatus==="draggingImageControllerMover"){const C=e.imageLayerUnderEditing;if(C){const j=X(e),T=(n.pageX-e.pointerX)/e.getPageScale(),F=(n.pageY-e.pointerY)/e.getPageScale();Ma(C,T,F,{step:j,autoAdjust:!1}),(a=(i=e.props).doAction)==null||a.call(i,j.getNewAction()),ue(e,n)}}else if(e.currentStatus==="draggingImageControllerRotator"){const C=e.imageLayerUnderEditing;if(C&&C.image){const j=X(e),T=Ms(ks(e.getPointInPage(n),Ct(C)));e.pointerCurrentAngle=T,Qd(e,C,T-C.rotate),(o=(s=e.props).doAction)==null||o.call(s,j.getNewAction()),ue(e,n)}}else if(e.currentStatus==="pointerDownOnImageControllerScaler"||e.currentStatus==="draggingImageControllerScaler"){e.currentStatus="draggingImageControllerScaler";const C=e.imageLayerUnderEditing;if(C&&C.image){const j=X(e),T=lc(e,C,n);fc(C,T,{step:j,enforceCoveringLayer:!1}),(c=(u=e.props).doAction)==null||c.call(u,j.getNewAction()),ue(e,n)}}else if(e.currentStatus==="pointerDownOnLeftImage"||e.currentStatus==="draggingLeftImageToPage")e.currentStatus="draggingLeftImageToPage",ue(e,n);else if(e.currentStatus==="draggingPanelImageOut")ue(e,n);else if(e.currentStatus==="draggingPolygonDot")ue(e,n),t==null||t.updateActivePointDot({x:e.getPointInPage(n).x/t.getPage().width,y:e.getPointInPage(n).y/t.getPage().height});else if(e.currentStatus==="pointerDownOnResizer"||e.currentStatus==="pointerDownOnLayerFrame"||e.currentStatus==="movingLayers")e.currentStatus="movingLayers",X(e),zd(e,n);else if(e.currentStatus==="rotatingLayers")Xd(e,n);else if(e.currentStatus==="resizingLayersByCorner")n.preventDefault(),Yu(e,e.resizeTransformOrigin,n);else if(e.currentStatus==="pointerDownOnLayerBorder"||e.currentStatus==="resizingLayersByBorder")e.currentStatus="resizingLayersByBorder",ic(e,n);else if(e.currentStatus==="pointerDownOnWorkspace"||e.currentStatus==="pointerDownOnHoveredLayer"||e.currentStatus==="drawingSelectionRect")e.currentStatus="drawingSelectionRect",Ku(e,n);else if(e.currentStatus==="resizingImageLayerFrameByCorner"){const C=e.imageLayerUnderEditing;C&&za(e,C,n)}else if(e.currentStatus==="resizingImageLayerFrameByBorder"){const C=e.layerUnderCropping;C&&Ba(e,C,n)}else if(e.currentStatus==="drawingEraserPath")Kd(e,n);else if(e.currentStatus==="resizingPageFrameByCorner"){const C=(f=e.props.matting)==null?void 0:f.getPageFrame();C&&za(e,C,n)}else if(e.currentStatus==="resizingPageFrameByBorder"){const C=(l=e.props.matting)==null?void 0:l.getPageFrame();C&&Ba(e,C,n)}else if(e.currentStatus==="resizingPageFrameFreelyByCorner"){const C=(p=e.props.matting)==null?void 0:p.getPageFrame();C&&Wa(e,C,n)}else if(e.currentStatus==="drawingMattingStrokePath")ue(e,n),(y=e.props.matting)==null||y.drawStrokePath(n);else if(e.currentStatus==="movingPageFrame")Ud(e,n);else if(e.currentStatus==="movingPageInWorkspaceWithoutBounds")Hd(e,n);else if(e.currentStatus==="movingPageInV3Workspace"){const C=n.pageX-e.pointerX,j=n.pageY-e.pointerY;ue(e,n),Fr({localStore:e,deltaX:-C,deltaY:-j})}else if(e.currentStatus==="drawingRect")(g=e.props.matting)==null||g.drawRect(n);else if(e.currentStatus==="movingRect")(h=e.props.matting)==null||h.moveRect(n),ue(e,n);else if(e.currentStatus==="drawingEliminatorStrokePath")ue(e,n),(v=e.props.eliminator)==null||v.drawStrokePath(n);else if(e.currentStatus==="movingEliminatorFrame"){const C=(b=e.props.eliminator)==null?void 0:b.getSelectedFrameLayer();if(C){const j=e.getPointInPage(n),{width:T,height:F}=e.props.getPageSize();if(j.x<0||j.y<0||j.x>T||j.y>F)return;const M=(n.pageX-e.pointerX)/e.getPageScale(),k=(n.pageY-e.pointerY)/e.getPageScale();Yt(e,C,M,k,new Qu("")),C.top<0&&(C.top=0),C.left<0&&(C.left=0),C.top+C.height>F&&(C.top=F-C.height),C.left+C.width>T&&(C.left=T-C.width)}ue(e,n)}else if(e.currentStatus==="drawingEliminatorFrame")(m=e.props.eliminator)==null||m.drawEliminatorFrame(n);else if(e.currentStatus==="resizingEliminatorFrameByCorner"){if(e.props.eliminator){const C=(w=e.props.eliminator)==null?void 0:w.getSelectedFrameLayer();if(C){const{width:j,height:T}=e.props.getPageSize(),F=e.getPointInPage(n);if(F.x<0||F.y<0||F.x>j||F.y>T)return;Wa(e,C,n)}}(P=e.props.matting)==null||P.resizeRectByCorner(n)}else if(e.currentStatus==="resizingEliminatorFrameByBorder")(E=e.props.matting)==null||E.resizeRectByBorder(n);else if(e.currentStatus==="movingTimelineNeedle")Zu(e,n);else if(e.currentStatus==="tryManipulatingWorkspace"||e.currentStatus==="manipulatingWorkspace")e.currentStatus="manipulatingWorkspace",Xu(e,n);else if(e.currentStatus==="drawingLayerRect")r&&(r.layerToBeCreated.endWorldPoint=ut(r.context.fileData,{pageX:n.pageX,pageY:n.pageY}));else if(e.currentStatus==="vector: pointerDownOnStartVertex"||e.currentStatus==="vector: choosingStartControl"){e.currentStatus="vector: choosingStartControl";const C=e.selectedSingleLayer;if(r&&(C==null?void 0:C.nodeType)==="vector"&&e.editingVector){const j=ut(r==null?void 0:r.context.fileData,n),T=qt({fileData:r.context.fileData,info:{type:"layer",layerId:C.id}}),F=Te(T,j);if(e.segmentCandidate){const{startVertex:M}=e.segmentCandidate;M.dx=F.x-M.x,M.dy=F.y-M.y}}}else if(e.currentStatus==="vector: pointerDownOnEndVertex"||e.currentStatus==="vector: choosingEndControl"){e.currentStatus="vector: choosingEndControl";const C=e.selectedSingleLayer;if(r&&(C==null?void 0:C.nodeType)==="vector"&&e.editingVector){const j=ut(r.context.fileData,n),T=qt({fileData:r.context.fileData,info:{type:"layer",layerId:C.id}}),F=Te(T,j),M=Er({layer:C,localPoint:F});if(e.segmentCandidate){const{endVertex:k}=e.segmentCandidate;k.dx=-(M.x-k.x),k.dy=-(M.y-k.y),console.log({endVertex:k,x:k.x,y:k.y,dx:k.dx,dy:k.dy})}}}else if(e.currentStatus==="vector: pointerDownOnVectorVertex"||e.currentStatus==="vector: movingVectorVertex"){if(e.currentStatus="vector: movingVectorVertex",r){const C=X(e);Dc({localStore:e,e:n,step:C})}}else if(e.currentStatus==="vector: movingVectorControlPoint"){const C=e.selectedSingleLayer;if(r&&(C==null?void 0:C.nodeType)==="vector"){const j=X(e);Oc({localStore:e,figma:r,layer:C,e:n,step:j})}}else(e.currentStatus==="pointerDownOnTextRange"||e.currentStatus==="selectingTextRange")&&(e.currentStatus="selectingTextRange",Ju(e,n));if(((L=e.segmentCandidate)==null?void 0:L.status)==="choosingEndVertex"){const C=e.selectedSingleLayer;if(r&&(C==null?void 0:C.nodeType)==="vector"&&e.editingVector){const j=ut(r==null?void 0:r.context.fileData,n),T=qt({fileData:r.context.fileData,info:{type:"layer",layerId:C.id}}),F=Te(T,j),M=Er({layer:C,localPoint:F});if(e.segmentCandidate){const{endVertex:k}=e.segmentCandidate;k.x=M.x,k.y=M.y}}}e.editingVector&&ue(e,n)}function Nc(e,t){if(e.selectedPanel)return e.selectedPanel;if(e.selectedSingleLayer){if(e.selectedSingleLayer.nodeType==="GROUP"){if(t){const n=$s(e,t,[e.selectedSingleLayer]),r=e.getLayer(n);if(r)return r}else if(e.activeLayerInGroupId){const n=e.getLayer(e.activeLayerInGroupId);if(n)return n}}return e.selectedSingleLayer}return null}function Ac({localStore:e,layer:t,step:n}){if(e.editingVector&&e.segmentCandidate){const r=e.segmentCandidate;if(!e.editingVector)throw new Error;const i=[];let a=null;if(r.endVertex.vid>-1)e.editingVector.currentOperation=null;else{const{vertices:s}=t.vectorData.vectorNetwork;let o=s.length-1;s[r.startVertex.vid]||(i.push({styleID:0,x:r.startVertex.x,y:r.startVertex.y}),o+=1,r.startVertex.vid=o),s[r.endVertex.vid]||(i.push({styleID:0,x:r.endVertex.x,y:r.endVertex.y}),o+=1,r.endVertex.vid=o),e.editingVector.currentOperation={type:"SegmentCandidate",status:"choosingEndVertex",startVertex:{vid:r.endVertex.vid,x:r.endVertex.x,y:r.endVertex.y,dx:-r.endVertex.dx,dy:-r.endVertex.dy},endVertex:{vid:-1,x:r.endVertex.x,y:r.endVertex.y,dx:0,dy:0}}}if(a={styleID:0,start:{vertex:r.startVertex.vid,dx:r.startVertex.dx,dy:r.startVertex.dy},end:{vertex:r.endVertex.vid,dx:r.endVertex.dx,dy:r.endVertex.dy}},n.update({layer:t,data:{vectorData(s){s.vectorNetwork.vertices.push(...de.cloneDeep(i)),a&&s.vectorNetwork.segments.push(de.cloneDeep(a))}}}),t.width===0){const s=_s(t.vectorData);n.update({layer:t,data:{vectorData(o){o.normalizedSize={x:s.x,y:s.y}}}}),n.update({layer:t,data:{width:t.vectorData.normalizedSize.x,height:t.vectorData.normalizedSize.y}})}}}function mp({vectorData:e}){const t={},{segments:n}=e.vectorNetwork;n.forEach((a,s)=>{a.start.vertex>-1&&(t[a.start.vertex]||(t[a.start.vertex]={type:"",id:`${a.start.vertex}`,currentSegmentId:"",segmentIdList:[]}),t[a.start.vertex].segmentIdList.push(`${s}`)),a.end.vertex>-1&&(t[a.end.vertex]||(t[a.end.vertex]={type:"",id:`${a.end.vertex}`,currentSegmentId:"",segmentIdList:[]}),t[a.end.vertex].segmentIdList.push(`${s}`))}),Object.keys(t).forEach(a=>{const s=t[a];s.segmentIdList.length===1&&(s.type="initial"),s.segmentIdList.length>2&&(s.type="crossing")});const r=[],i={vertexChain:[{vertexId:"0",segmentId:""}]};for(console.log(t);i.vertexChain.length>0;){const a=i.vertexChain[i.vertexChain.length-1],s=t[a.vertexId];if(console.log(`vertex ${a.vertexId}`),s.segmentIdList[0]){const o=s.segmentIdList[0];if(o===a.segmentId)s.segmentIdList.shift();else{a.segmentId=o,s.segmentIdList.shift(),console.log(`checking segment ${o}`);const u=n[Number(o)];let c="";`${u.start.vertex}`===s.id?c=`${u.end.vertex}`:c=`${u.start.vertex}`,console.log(`Next vertex ${c}`);const f=i.vertexChain.findIndex(l=>l.vertexId===c);f>-1?r.push({loop:i.vertexChain.slice(f).map(l=>l.segmentId)}):i.vertexChain.push({vertexId:c,segmentId:o})}}else i.vertexChain.pop()}console.log(r)}function _c(e,t,n){var i,a,s,o,u,c,f,l,p,y,g,h,v,b;if(console.log(e.currentStatus),e.currentStatus==="movingLayers")e.helperLineList=[],e.helperRectList=[],Fi(e,n)===!1&&t.record("MovedLayers"),Ce(e);else if(e.currentStatus==="movingPageFrame")t.record("MovedLayers"),Ce(e);else if(e.currentStatus==="rotatingLayers")t.record("MovedLayers"),Ce(e);else if(e.currentStatus==="resizingLayersByBorder")t.record("MovedLayers"),Ce(e);else if(e.currentStatus==="resizingLayersByCorner")t.record("MovedLayers"),Ce(e);else if(e.currentStatus==="draggingPolygonDot"&&e.pointerMoved)t.record("polygonDotMoved");else if(e.currentStatus==="drawingSelectionRect")Su(e,n);else if(e.currentStatus==="draggingImageInLayer"){if(e.pointerMoved){const m=e.selectedPanel;if(m&&m.nodeType==="IMAGE"&&m.image){const w=X(e);Ei(m,{step:w}),t.record("MovedLayerImage")}}}else if(e.currentStatus==="draggingImageControllerMover"){const m=e.imageLayerUnderEditing;if(m&&m.image){const w=X(e);An(e),Ei(m,{step:w}),e.layerUnderCropping||t.record("MovedLayerImage"),(a=(i=e.props).doAction)==null||a.call(i,w.getNewAction()),Ce(e)}}else if(e.currentStatus==="draggingImageControllerScaler"){if(e.imageLayerUnderEditing){const m=X(e);An(e),Vs(e,e.imageLayerUnderEditing,m),e.layerUnderCropping||t.record("ScaledLayerImage"),(o=(s=e.props).doAction)==null||o.call(s,m.getNewAction()),Ce(e)}}else if(e.currentStatus==="draggingImageControllerRotator"){if(!e.layerUnderCropping){const m=X(e);(c=(u=e.props).doAction)==null||c.call(u,m.getNewAction()),Ce(e),t.record("UpdatedLayerImageRotation")}}else if(e.currentStatus==="resizingImageLayerFrameByCorner"){const m=e.imageLayerUnderEditing;if(m){const w=X(e);$a(e,m,w)}}else if(e.currentStatus==="resizingImageLayerFrameByBorder"){const m=e.imageLayerUnderEditing;if(m){const w=X(e);$a(e,m,w)}}else if(!(e.currentStatus==="draggingLeftImageToPage"||e.currentStatus==="pointerDownOnLeftImage")){if(e.currentStatus==="pointerDownOnWorkspace")Fi(e,n)&&ce(e,{type:"clear"});else if(e.currentStatus==="pointerDownOnHoveredLayer"){const m=tt(e);if(m){const{hoveredTarget:w}=m.fileData;w&&ce(e,{type:"$target",target:w})}}else if(e.currentStatus==="pointerDownOnResizer"&&e.pointerMoved===!1)new Date().getTime()-e.lastClickedAt<300?Bc({localStore:e,e:n}):$c({localStore:e,e:n});else if(e.currentStatus==="pointerDownOnParentGroup")Wc({localStore:e,e:n});else if(e.currentStatus==="tryManipulatingWorkspace"){if(e.isMobile){if(e.pointerDownOnLayerId){const m=e.getLayer(e.pointerDownOnLayerId);m&&ed(e,m,n)}else ce(e,{type:"clear"});e.pointerDownOnLayerId=""}e.currentStatus=""}else if(e.currentStatus==="manipulatingWorkspace")e.workspaceElement&&zs({localStore:e,workspace:e.workspaceElement}),e.pointerMap={},e.currentStatus="";else if(e.currentStatus==="drawingEraserPath")Zd(e);else if(e.currentStatus==="drawingMattingStrokePath")(f=e.props.matting)==null||f.finishStrokePath(n);else if(e.currentStatus==="drawingEliminatorStrokePath")(l=e.props.eliminator)==null||l.finishStrokePath(n);else if(e.currentStatus==="drawingEliminatorFrame")(p=e.props.eliminator)==null||p.finishEliminatorFrame();else if(e.currentStatus==="resizingEliminatorFrameByCorner")(y=e.props.matting)==null||y.finishResizingRect();else if(e.currentStatus==="resizingEliminatorFrameByBorder")(g=e.props.matting)==null||g.finishResizingRect();else if(e.currentStatus==="drawingRect")(h=e.props.matting)==null||h.finishDrawingRect();else if(e.currentStatus==="movingRect")(v=e.props.matting)==null||v.finishMoveRect();else if(e.currentStatus==="drawingLayerRect"){const m=e.getFigma();if(m){const w=vc(e,"",m.layerToBeCreatedRect);e.currentTool="MoveTool",ce(e,{type:"replace",idList:[w]})}}else if(e.currentStatus==="vector: pointerDownOnStartVertex")e.segmentCandidate&&(e.segmentCandidate.status="choosingEndVertex");else if(e.currentStatus==="vector: choosingStartControl")e.segmentCandidate&&(e.segmentCandidate.status="choosingEndVertex");else if(e.currentStatus==="vector: pointerDownOnEndVertex"||e.currentStatus==="vector: choosingEndControl"){if(((b=e.selectedSingleLayer)==null?void 0:b.nodeType)==="vector"){const m=X(e);Ac({localStore:e,layer:e.selectedSingleLayer,step:m}),hi({localStore:e,layer:e.selectedSingleLayer,step:m})}Ce(e)}else if(e.currentStatus==="vector: pointerDownOnVectorVertex")Ce(e);else if(e.currentStatus==="vector: movingVectorControlPoint"){const m=e.selectedSingleLayer,w=X(e);(m==null?void 0:m.nodeType)==="vector"&&hi({localStore:e,layer:m,step:w}),Ce(e)}else if(e.currentStatus==="vector: movingVectorVertex"){const m=e.selectedSingleLayer,w=X(e);(m==null?void 0:m.nodeType)==="vector"&&m.width&&m.height&&hi({localStore:e,layer:m,step:w}),Ce(e)}else if(e.currentStatus==="pointerDownOnTextRange"||e.currentStatus==="selectingTextRange"){const{advancedTextEditor:m}=e;m.inputText.compositionText="",m.inputElement&&(m.inputElement.value="",m.inputElement.focus()),m.inputMode="single"}}e.currentStatus==="rightPointDownOnResizer"&&(e.getFigma()||(n.stopPropagation(),n.preventDefault(),e.props.onRightPointerUpOnResizer?e.props.onRightPointerUpOnResizer():ua(e,e.selectedSingleLayer,n))),e.currentStatus==="rightPointDownOnResizer"||e.currentStatus==="rightPointDownOnWorkspace"||e.currentStatus==="pointerDownOnEmptyPanel"||(e.menuShow=!1),(e.currentStatus==="pointerDownOnResizer"||e.currentStatus==="pointerDownOnLayerFrame")&&e.pointerMoved===!1&&(e.lastClickedAt=new Date().getTime());const r=e.getFigma();r&&(r.context.fileData.hoveredTarget=null),e.currentStatus==="playingTimeline"||(e.currentStatus="")}function Bc({localStore:e,e:t}){var r,i,a,s;const n=tt(e);if(n){const o=zn({localStore:e});if(o){const{layer:u}=_r({fileData:n.fileData,target:o});(i=(r=e.props).onDoubleClickedLayer)==null||i.call(r,{layer:u,e:t});return}}if(e.selectedSingleLayer&&e.selectedSingleLayer.nodeType==="vector")mc({localStore:e});else{const o=Nc(e,t);o&&((s=(a=e.props).onDoubleClickedLayer)==null||s.call(a,{layer:o,e:t}))}}function $c({localStore:e,e:t}){var n;if(e.getFigma()){const r=e.getFigma();r&&(((n=e.selectedSingleLayer)==null?void 0:n.nodeType)==="TEXT"?(t.stopPropagation(),e.currentStatus="",Aa(e)):e.pointerMoved===!1&&r.context.fileData.hoveredTarget&&ce(e,{type:"$target",target:r.context.fileData.hoveredTarget}))}else if(e.selectionStatus==="multipleLayers"){const r=td(e,t,e.selectedNormalLayerList);r?e.controlKeyUnderPress?ce(e,{type:"remove",idList:[r]}):ce(e,{type:"replace",idList:[r]}):Ii(e,t)}else if(e.selectedSingleLayer)if(e.selectedSingleLayer.nodeType==="FRAME"){t.stopPropagation();const r=tt(e);r&&wc({e:t,localStore:e,fileData:r.fileData})}else e.selectedSingleLayer.nodeType==="TEXT"?(t.stopPropagation(),e.currentStatus="",Aa(e)):e.selectedSingleLayer.nodeType==="GROUP"?zc({localStore:e,e:t}):ta(e.selectedSingleLayer)||Ii(e,t)}function zc({localStore:e,e:t}){t.stopPropagation();const n=e.selectedSingleLayer,r=Ot(e,t);let i="";if(n&&r){const a=[...n.children].reverse();for(let s=0;s<a.length;s+=1){const o=a[s],u=na(o);if(ea(r,u)){i=o.id,ce(e,{type:"replace",idList:[o.id]});break}}}i||Ii(e,t)}function Wc({localStore:e,e:t}){const n=e.selectedSingleLayer;if(n){const r=e.getLayer(n.parentId);if(r){const i=Ot(e,t);if(r&&i){const a=[...r.children].reverse();let s=!1;for(let o=0;o<a.length;o+=1){const u=a[o],c=na(u);if(ea(i,c)){ce(e,{type:"replace",idList:[u.id]}),s=!0;break}}s||ce(e,{type:"replace",idList:[r.id]})}}}}function po(e){const{width:t,height:n}=e.props.getPageSize(),{thumbnailMaxWidth:r,thumbnailMaxHeight:i}=e.options,a=t/i,s=n/r;return Math.max(a,s)}function Uc(e,t,n){if(e.currentStatus==="draggingThumbnail"){const r=e.getPageScale()*po(e),i=t.pageX-e.pointerX,a=t.pageY-e.pointerY;ue(e,t),n&&(n.scrollLeft+=i*r,n.scrollTop+=a*r)}}function _n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=[];return bt.Children.forEach(e,function(r){r==null&&!t.keepEmpty||(Array.isArray(r)?n=n.concat(_n(r)):nd(r)&&r.props?n=n.concat(_n(r.props.children,t)):n.push(r))}),n}var Di=x.createContext(null);function Hc(e){var t=e.children,n=e.onBatchResize,r=x.useRef(0),i=x.useRef([]),a=x.useContext(Di),s=x.useCallback(function(o,u,c){r.current+=1;var f=r.current;i.current.push({size:o,element:u,data:c}),Promise.resolve().then(function(){f===r.current&&(n==null||n(i.current),i.current=[])}),a==null||a(o,u,c)},[n,a]);return x.createElement(Di.Provider,{value:s},t)}var vo=function(){if(typeof Map<"u")return Map;function e(t,n){var r=-1;return t.some(function(i,a){return i[0]===n?(r=a,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var r=e(this.__entries__,n),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(n,r){var i=e(this.__entries__,n);~i?this.__entries__[i][1]=r:this.__entries__.push([n,r])},t.prototype.delete=function(n){var r=this.__entries__,i=e(r,n);~i&&r.splice(i,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,r){r===void 0&&(r=null);for(var i=0,a=this.__entries__;i<a.length;i++){var s=a[i];n.call(r,s[1],s[0])}},t}()}(),Oi=typeof window<"u"&&typeof document<"u"&&window.document===document,kr=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Gc=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(kr):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),qc=2;function Yc(e,t){var n=!1,r=!1,i=0;function a(){n&&(n=!1,e()),r&&o()}function s(){Gc(a)}function o(){var u=Date.now();if(n){if(u-i<qc)return;r=!0}else n=!0,r=!1,setTimeout(s,t);i=u}return o}var Kc=20,Zc=["top","right","bottom","left","width","height","size","weight"],Xc=typeof MutationObserver<"u",Jc=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Yc(this.refresh.bind(this),Kc)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var n=this.observers_,r=n.indexOf(t);~r&&n.splice(r,1),!n.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return t.forEach(function(n){return n.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!Oi||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Xc?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!Oi||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var n=t.propertyName,r=n===void 0?"":n,i=Zc.some(function(a){return!!~r.indexOf(a)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),mo=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},fn=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||kr},yo=$r(0,0,0,0);function Dr(e){return parseFloat(e)||0}function Ga(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(r,i){var a=e["border-"+i+"-width"];return r+Dr(a)},0)}function Qc(e){for(var t=["top","right","bottom","left"],n={},r=0,i=t;r<i.length;r++){var a=i[r],s=e["padding-"+a];n[a]=Dr(s)}return n}function Sc(e){var t=e.getBBox();return $r(0,0,t.width,t.height)}function ef(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return yo;var r=fn(e).getComputedStyle(e),i=Qc(r),a=i.left+i.right,s=i.top+i.bottom,o=Dr(r.width),u=Dr(r.height);if(r.boxSizing==="border-box"&&(Math.round(o+a)!==t&&(o-=Ga(r,"left","right")+a),Math.round(u+s)!==n&&(u-=Ga(r,"top","bottom")+s)),!nf(e)){var c=Math.round(o+a)-t,f=Math.round(u+s)-n;Math.abs(c)!==1&&(o-=c),Math.abs(f)!==1&&(u-=f)}return $r(i.left,i.top,o,u)}var tf=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof fn(e).SVGGraphicsElement}:function(e){return e instanceof fn(e).SVGElement&&typeof e.getBBox=="function"}}();function nf(e){return e===fn(e).document.documentElement}function rf(e){return Oi?tf(e)?Sc(e):ef(e):yo}function af(e){var t=e.x,n=e.y,r=e.width,i=e.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(a.prototype);return mo(s,{x:t,y:n,width:r,height:i,top:n,right:t+r,bottom:i+n,left:t}),s}function $r(e,t,n,r){return{x:e,y:t,width:n,height:r}}var sf=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=$r(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=rf(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),of=function(){function e(t,n){var r=af(n);mo(this,{target:t,contentRect:r})}return e}(),uf=function(){function e(t,n,r){if(this.activeObservations_=[],this.observations_=new vo,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof fn(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)||(n.set(t,new sf(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof fn(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)&&(n.delete(t),n.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(n){n.isActive()&&t.activeObservations_.push(n)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,n=this.activeObservations_.map(function(r){return new of(r.target,r.broadcastRect())});this.callback_.call(t,n,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),xo=typeof WeakMap<"u"?new WeakMap:new vo,wo=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=Jc.getInstance(),r=new uf(t,n,this);xo.set(this,r)}return e}();["observe","unobserve","disconnect"].forEach(function(e){wo.prototype[e]=function(){var t;return(t=xo.get(this))[e].apply(t,arguments)}});var df=function(){return typeof kr.ResizeObserver<"u"?kr.ResizeObserver:wo}(),Rt=new Map;function cf(e){e.forEach(function(t){var n,r=t.target;(n=Rt.get(r))===null||n===void 0||n.forEach(function(i){return i(r)})})}var bo=new df(cf);function ff(e,t){Rt.has(e)||(Rt.set(e,new Set),bo.observe(e)),Rt.get(e).add(t)}function lf(e,t){Rt.has(e)&&(Rt.get(e).delete(t),Rt.get(e).size||(bo.unobserve(e),Rt.delete(e)))}var gf=function(e){ra(n,e);var t=ia(n);function n(){return hn(this,n),t.apply(this,arguments)}return pn(n,[{key:"render",value:function(){return this.props.children}}]),n}(x.Component);function hf(e,t){var n=e.children,r=e.disabled,i=x.useRef(null),a=x.useRef(null),s=x.useContext(Di),o=typeof n=="function",u=o?n(i):n,c=x.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),f=!o&&x.isValidElement(u)&&aa(u),l=f?Ws(u):null,p=sa(l,i),y=function(){var b;return pi(i.current)||(i.current&&Me(i.current)==="object"?pi((b=i.current)===null||b===void 0?void 0:b.nativeElement):null)||pi(a.current)};x.useImperativeHandle(t,function(){return y()});var g=x.useRef(e);g.current=e;var h=x.useCallback(function(v){var b=g.current,m=b.onResize,w=b.data,P=v.getBoundingClientRect(),E=P.width,L=P.height,C=v.offsetWidth,j=v.offsetHeight,T=Math.floor(E),F=Math.floor(L);if(c.current.width!==T||c.current.height!==F||c.current.offsetWidth!==C||c.current.offsetHeight!==j){var M={width:T,height:F,offsetWidth:C,offsetHeight:j};c.current=M;var k=C===Math.round(E)?E:C,V=j===Math.round(L)?L:j,A=R(R({},M),{},{offsetWidth:k,offsetHeight:V});s==null||s(A,v,w),m&&Promise.resolve().then(function(){m(A,v)})}},[]);return x.useEffect(function(){var v=y();return v&&!r&&ff(v,h),function(){return lf(v,h)}},[i.current,r]),x.createElement(gf,{ref:a},f?x.cloneElement(u,{ref:p}):u)}var pf=x.forwardRef(hf),vf="rc-observer-key";function mf(e,t){var n=e.children,r=typeof n=="function"?[n]:_n(n);return r.map(function(i,a){var s=(i==null?void 0:i.key)||"".concat(vf,"-").concat(a);return x.createElement(pf,vn({},e,{key:s,ref:a===0?t:void 0}),i)})}var fa=x.forwardRef(mf);fa.Collection=Hc;function mi(e){return e!==void 0}function yf(e,t){var n=t||{},r=n.defaultValue,i=n.value,a=n.onChange,s=n.postState,o=Ra(function(){return mi(i)?i:mi(r)?typeof r=="function"?r():r:typeof e=="function"?e():e}),u=K(o,2),c=u[0],f=u[1],l=i!==void 0?i:c,p=s?s(l):l,y=yt(a),g=Ra([l]),h=K(g,2),v=h[0],b=h[1];ka(function(){var w=v[0];c!==w&&y(c,w)},[v]),ka(function(){mi(i)||f(i)},[i]);var m=yt(function(w,P){f(w,P),b([l],P)});return[p,m]}const Or=["blue","purple","cyan","green","magenta","pink","red","orange","yellow","volcano","geekblue","lime","gold"];function xf(e,t){return Or.reduce((n,r)=>{const i=e[`${r}1`],a=e[`${r}3`],s=e[`${r}6`],o=e[`${r}7`];return Object.assign(Object.assign({},n),t(r,{lightColor:i,lightBorderColor:a,darkColor:s,textColor:o}))},{})}function wf(e){return e&&bt.isValidElement(e)&&e.type===bt.Fragment}const bf=(e,t,n)=>bt.isValidElement(e)?bt.cloneElement(e,typeof n=="function"?n(e.props||{}):n):t;function Cf(e,t){return bf(e,e,t)}const yi=()=>({height:0,opacity:0}),qa=e=>{const{scrollHeight:t}=e;return{height:t,opacity:1}},Pf=e=>({height:e?e.offsetHeight:0}),xi=(e,t)=>(t==null?void 0:t.deadline)===!0||t.propertyName==="height",yp=function(){return{motionName:`${arguments.length>0&&arguments[0]!==void 0?arguments[0]:rd}-motion-collapse`,onAppearStart:yi,onEnterStart:yi,onAppearActive:qa,onEnterActive:qa,onLeaveStart:Pf,onLeaveActive:yi,onAppearEnd:xi,onEnterEnd:xi,onLeaveEnd:xi,motionDeadline:500}},Lf=(e,t,n)=>n!==void 0?n:`${e}-${t}`,Ef=function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var t=e.getBBox(),n=t.width,r=t.height;if(n||r)return!0}if(e.getBoundingClientRect){var i=e.getBoundingClientRect(),a=i.width,s=i.height;if(a||s)return!0}}return!1},Tf=e=>{const t=bt.useContext(id);return bt.useMemo(()=>e?typeof e=="string"?e??t:typeof e=="function"?e(t):t:t,[e,t])},Ff=e=>{const{componentCls:t}=e;return{[t]:{"&-block":{display:"flex",width:"100%"},"&-vertical":{flexDirection:"column"}}}},If=e=>{const{componentCls:t,antCls:n}=e;return{[t]:{display:"inline-flex","&-rtl":{direction:"rtl"},"&-vertical":{flexDirection:"column"},"&-align":{flexDirection:"column","&-center":{alignItems:"center"},"&-start":{alignItems:"flex-start"},"&-end":{alignItems:"flex-end"},"&-baseline":{alignItems:"baseline"}},[`${t}-item:empty`]:{display:"none"},[`${t}-item > ${n}-badge-not-a-wrapper:only-child`]:{display:"block"}}}},jf=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-row-small":{rowGap:e.spaceGapSmallSize},"&-gap-row-middle":{rowGap:e.spaceGapMiddleSize},"&-gap-row-large":{rowGap:e.spaceGapLargeSize},"&-gap-col-small":{columnGap:e.spaceGapSmallSize},"&-gap-col-middle":{columnGap:e.spaceGapMiddleSize},"&-gap-col-large":{columnGap:e.spaceGapLargeSize}}}},Mf=Us("Space",e=>{const t=oa(e,{spaceGapSmallSize:e.paddingXS,spaceGapMiddleSize:e.padding,spaceGapLargeSize:e.paddingLG});return[If(t),jf(t),Ff(t)]},()=>({}),{resetStyle:!1});var Co=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const zr=x.createContext(null),xp=(e,t)=>{const n=x.useContext(zr),r=x.useMemo(()=>{if(!n)return"";const{compactDirection:i,isFirstItem:a,isLastItem:s}=n,o=i==="vertical"?"-vertical-":"-";return Fe(`${e}-compact${o}item`,{[`${e}-compact${o}first-item`]:a,[`${e}-compact${o}last-item`]:s,[`${e}-compact${o}item-rtl`]:t==="rtl"})},[e,t,n]);return{compactSize:n==null?void 0:n.compactSize,compactDirection:n==null?void 0:n.compactDirection,compactItemClassnames:r}},Rf=e=>{const{children:t}=e;return x.createElement(zr.Provider,{value:null},t)},kf=e=>{const{children:t}=e,n=Co(e,["children"]);return x.createElement(zr.Provider,{value:x.useMemo(()=>n,[n])},t)},wp=e=>{const{getPrefixCls:t,direction:n}=x.useContext(Hs),{size:r,direction:i,block:a,prefixCls:s,className:o,rootClassName:u,children:c}=e,f=Co(e,["size","direction","block","prefixCls","className","rootClassName","children"]),l=Tf(w=>r??w),p=t("space-compact",s),[y,g]=Mf(p),h=Fe(p,g,{[`${p}-rtl`]:n==="rtl",[`${p}-block`]:a,[`${p}-vertical`]:i==="vertical"},o,u),v=x.useContext(zr),b=_n(c),m=x.useMemo(()=>b.map((w,P)=>{const E=(w==null?void 0:w.key)||`${p}-item-${P}`;return x.createElement(kf,{key:E,compactSize:l,compactDirection:i,isFirstItem:P===0&&(!v||(v==null?void 0:v.isFirstItem)),isLastItem:P===b.length-1&&(!v||(v==null?void 0:v.isLastItem))},w)}),[r,b,v]);return b.length===0?null:y(x.createElement("div",Object.assign({className:h},f),m))},Df=e=>({animationDuration:e,animationFillMode:"both"}),Of=e=>({animationDuration:e,animationFillMode:"both"}),Vf=function(e,t,n,r){const a=(arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1)?"&":"";return{[`
      ${a}${e}-enter,
      ${a}${e}-appear
    `]:Object.assign(Object.assign({},Df(r)),{animationPlayState:"paused"}),[`${a}${e}-leave`]:Object.assign(Object.assign({},Of(r)),{animationPlayState:"paused"}),[`
      ${a}${e}-enter${e}-enter-active,
      ${a}${e}-appear${e}-appear-active
    `]:{animationName:t,animationPlayState:"running"},[`${a}${e}-leave${e}-leave-active`]:{animationName:n,animationPlayState:"running",pointerEvents:"none"}}},Nf=new Ye("antZoomIn",{"0%":{transform:"scale(0.2)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),Af=new Ye("antZoomOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.2)",opacity:0}}),Ya=new Ye("antZoomBigIn",{"0%":{transform:"scale(0.8)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),Ka=new Ye("antZoomBigOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.8)",opacity:0}}),_f=new Ye("antZoomUpIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 0%"}}),Bf=new Ye("antZoomUpOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 0%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0}}),$f=new Ye("antZoomLeftIn",{"0%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"0% 50%"}}),zf=new Ye("antZoomLeftOut",{"0%":{transform:"scale(1)",transformOrigin:"0% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0}}),Wf=new Ye("antZoomRightIn",{"0%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"100% 50%"}}),Uf=new Ye("antZoomRightOut",{"0%":{transform:"scale(1)",transformOrigin:"100% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0}}),Hf=new Ye("antZoomDownIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 100%"}}),Gf=new Ye("antZoomDownOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 100%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0}}),qf={zoom:{inKeyframes:Nf,outKeyframes:Af},"zoom-big":{inKeyframes:Ya,outKeyframes:Ka},"zoom-big-fast":{inKeyframes:Ya,outKeyframes:Ka},"zoom-left":{inKeyframes:$f,outKeyframes:zf},"zoom-right":{inKeyframes:Wf,outKeyframes:Uf},"zoom-up":{inKeyframes:_f,outKeyframes:Bf},"zoom-down":{inKeyframes:Hf,outKeyframes:Gf}},Yf=(e,t)=>{const{antCls:n}=e,r=`${n}-${t}`,{inKeyframes:i,outKeyframes:a}=qf[t];return[Vf(r,i,a,t==="zoom-big-fast"?e.motionDurationFast:e.motionDurationMid),{[`
        ${r}-enter,
        ${r}-appear
      `]:{transform:"scale(0)",opacity:0,animationTimingFunction:e.motionEaseOutCirc,"&-prepare":{transform:"none"}},[`${r}-leave`]:{animationTimingFunction:e.motionEaseInOutCirc}}]};var Po=x.createContext(null),Za=[];function Kf(e,t){var n=x.useState(function(){if(!Ir())return null;var g=document.createElement("div");return g}),r=K(n,1),i=r[0],a=x.useRef(!1),s=x.useContext(Po),o=x.useState(Za),u=K(o,2),c=u[0],f=u[1],l=s||(a.current?void 0:function(g){f(function(h){var v=[g].concat($(h));return v})});function p(){i.parentElement||document.body.appendChild(i),a.current=!0}function y(){var g;(g=i.parentElement)===null||g===void 0||g.removeChild(i),a.current=!1}return Ae(function(){return e?s?s(p):p():y(),y},[e]),Ae(function(){c.length&&(c.forEach(function(g){return g()}),f(Za))},[c]),[i,l]}function Zf(e){var t="rc-scrollbar-measure-".concat(Math.random().toString(36).substring(7)),n=document.createElement("div");n.id=t;var r=n.style;r.position="absolute",r.left="0",r.top="0",r.width="100px",r.height="100px",r.overflow="scroll";var i,a;if(e){var s=getComputedStyle(e);r.scrollbarColor=s.scrollbarColor,r.scrollbarWidth=s.scrollbarWidth;var o=getComputedStyle(e,"::-webkit-scrollbar"),u=parseInt(o.width,10),c=parseInt(o.height,10);try{var f=u?"width: ".concat(o.width,";"):"",l=c?"height: ".concat(o.height,";"):"";Gs(`
#`.concat(t,`::-webkit-scrollbar {
`).concat(f,`
`).concat(l,`
}`),t)}catch(g){console.error(g),i=u,a=c}}document.body.appendChild(n);var p=e&&i&&!isNaN(i)?i:n.offsetWidth-n.clientWidth,y=e&&a&&!isNaN(a)?a:n.offsetHeight-n.clientHeight;return document.body.removeChild(n),ji(t),{width:p,height:y}}function Xf(e){return typeof document>"u"||!e||!(e instanceof Element)?{width:0,height:0}:Zf(e)}function Jf(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var Qf="rc-util-locker-".concat(Date.now()),Xa=0;function Sf(e){var t=!!e,n=x.useState(function(){return Xa+=1,"".concat(Qf,"_").concat(Xa)}),r=K(n,1),i=r[0];Ae(function(){if(t){var a=Xf(document.body).width,s=Jf();Gs(`
html body {
  overflow-y: hidden;
  `.concat(s?"width: calc(100% - ".concat(a,"px);"):"",`
}`),i)}else ji(i);return function(){ji(i)}},[t,i])}var el=!1;function tl(e){return el}var Ja=function(t){return t===!1?!1:!Ir()||!t?null:typeof t=="string"?document.querySelector(t):typeof t=="function"?t():t},Lo=x.forwardRef(function(e,t){var n=e.open,r=e.autoLock,i=e.getContainer;e.debug;var a=e.autoDestroy,s=a===void 0?!0:a,o=e.children,u=x.useState(n),c=K(u,2),f=c[0],l=c[1],p=f||n;x.useEffect(function(){(s||n)&&l(n)},[n,s]);var y=x.useState(function(){return Ja(i)}),g=K(y,2),h=g[0],v=g[1];x.useEffect(function(){var M=Ja(i);v(M??null)});var b=Kf(p&&!h),m=K(b,2),w=m[0],P=m[1],E=h??w;Sf(r&&n&&Ir()&&(E===w||E===document.body));var L=null;if(o&&aa(o)&&t){var C=o;L=C.ref}var j=sa(L,t);if(!p||!Ir()||h===void 0)return null;var T=E===!1||tl(),F=o;return t&&(F=x.cloneElement(o,{ref:j})),x.createElement(Po.Provider,{value:P},T?F:du.createPortal(F,E))});function nl(){var e=R({},cu);return e.useId}var Qa=0,Sa=nl();const Eo=Sa?function(t){var n=Sa();return t||n}:function(t){var n=x.useState("ssr-id"),r=K(n,2),i=r[0],a=r[1];return x.useEffect(function(){var s=Qa;Qa+=1,a("rc_unique_".concat(s))},[]),t||i};var Gt="RC_FORM_INTERNAL_HOOKS",ee=function(){Dt(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},ln=x.createContext({getFieldValue:ee,getFieldsValue:ee,getFieldError:ee,getFieldWarning:ee,getFieldsError:ee,isFieldsTouched:ee,isFieldTouched:ee,isFieldValidating:ee,isFieldsValidating:ee,resetFields:ee,setFields:ee,setFieldValue:ee,setFieldsValue:ee,validateFields:ee,submit:ee,getInternalHooks:function(){return ee(),{dispatch:ee,initEntityValue:ee,registerField:ee,useSubscribe:ee,setInitialValues:ee,destroyForm:ee,setCallbacks:ee,registerWatch:ee,getFields:ee,setValidateMessages:ee,setPreserve:ee,getInitialValue:ee}}}),Vr=x.createContext(null);function Vi(e){return e==null?[]:Array.isArray(e)?e:[e]}function rl(e){return e&&!!e._init}function Ni(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}var Ai=Ni();function il(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function al(e,t,n){if(ad())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&qs(i,n.prototype),i}function _i(e){var t=typeof Map=="function"?new Map:void 0;return _i=function(r){if(r===null||!il(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(r))return t.get(r);t.set(r,i)}function i(){return al(r,arguments,sd(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),qs(i,r)},_i(e)}var sl=/%[sdj%]/g,ol=function(){};function Bi(e){if(!e||!e.length)return null;var t={};return e.forEach(function(n){var r=n.field;t[r]=t[r]||[],t[r].push(n)}),t}function _e(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=0,a=n.length;if(typeof e=="function")return e.apply(null,n);if(typeof e=="string"){var s=e.replace(sl,function(o){if(o==="%%")return"%";if(i>=a)return o;switch(o){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch{return"[Circular]"}break;default:return o}});return s}return e}function ul(e){return e==="string"||e==="url"||e==="hex"||e==="email"||e==="date"||e==="pattern"}function he(e,t){return!!(e==null||t==="array"&&Array.isArray(e)&&!e.length||ul(t)&&typeof e=="string"&&!e)}function dl(e,t,n){var r=[],i=0,a=e.length;function s(o){r.push.apply(r,$(o||[])),i++,i===a&&n(r)}e.forEach(function(o){t(o,s)})}function es(e,t,n){var r=0,i=e.length;function a(s){if(s&&s.length){n(s);return}var o=r;r=r+1,o<i?t(e[o],a):n([])}a([])}function cl(e){var t=[];return Object.keys(e).forEach(function(n){t.push.apply(t,$(e[n]||[]))}),t}var ts=function(e){ra(n,e);var t=ia(n);function n(r,i){var a;return hn(this,n),a=t.call(this,"Async Validation Error"),I(Y(a),"errors",void 0),I(Y(a),"fields",void 0),a.errors=r,a.fields=i,a}return pn(n)}(_i(Error));function fl(e,t,n,r,i){if(t.first){var a=new Promise(function(p,y){var g=function(b){return r(b),b.length?y(new ts(b,Bi(b))):p(i)},h=cl(e);es(h,n,g)});return a.catch(function(p){return p}),a}var s=t.firstFields===!0?Object.keys(e):t.firstFields||[],o=Object.keys(e),u=o.length,c=0,f=[],l=new Promise(function(p,y){var g=function(v){if(f.push.apply(f,v),c++,c===u)return r(f),f.length?y(new ts(f,Bi(f))):p(i)};o.length||(r(f),p(i)),o.forEach(function(h){var v=e[h];s.indexOf(h)!==-1?es(v,n,g):dl(v,n,g)})});return l.catch(function(p){return p}),l}function ll(e){return!!(e&&e.message!==void 0)}function gl(e,t){for(var n=e,r=0;r<t.length;r++){if(n==null)return n;n=n[t[r]]}return n}function ns(e,t){return function(n){var r;return e.fullFields?r=gl(t,e.fullFields):r=t[n.field||e.fullField],ll(n)?(n.field=n.field||e.fullField,n.fieldValue=r,n):{message:typeof n=="function"?n():n,fieldValue:r,field:n.field||e.fullField}}}function rs(e,t){if(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];Me(r)==="object"&&Me(e[n])==="object"?e[n]=R(R({},e[n]),r):e[n]=r}}return e}var nn="enum",hl=function(t,n,r,i,a){t[nn]=Array.isArray(t[nn])?t[nn]:[],t[nn].indexOf(n)===-1&&i.push(_e(a.messages[nn],t.fullField,t[nn].join(", ")))},pl=function(t,n,r,i,a){if(t.pattern){if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(n)||i.push(_e(a.messages.pattern.mismatch,t.fullField,n,t.pattern));else if(typeof t.pattern=="string"){var s=new RegExp(t.pattern);s.test(n)||i.push(_e(a.messages.pattern.mismatch,t.fullField,n,t.pattern))}}},vl=function(t,n,r,i,a){var s=typeof t.len=="number",o=typeof t.min=="number",u=typeof t.max=="number",c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=n,l=null,p=typeof n=="number",y=typeof n=="string",g=Array.isArray(n);if(p?l="number":y?l="string":g&&(l="array"),!l)return!1;g&&(f=n.length),y&&(f=n.replace(c,"_").length),s?f!==t.len&&i.push(_e(a.messages[l].len,t.fullField,t.len)):o&&!u&&f<t.min?i.push(_e(a.messages[l].min,t.fullField,t.min)):u&&!o&&f>t.max?i.push(_e(a.messages[l].max,t.fullField,t.max)):o&&u&&(f<t.min||f>t.max)&&i.push(_e(a.messages[l].range,t.fullField,t.min,t.max))},To=function(t,n,r,i,a,s){t.required&&(!r.hasOwnProperty(t.field)||he(n,s||t.type))&&i.push(_e(a.messages.required,t.fullField))},vr;const ml=function(){if(vr)return vr;var e="[a-fA-F\\d:]",t=function(L){return L&&L.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(e,")|(?<=").concat(e,")(?=\\s|$))"):""},n="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",r="[a-fA-F\\d]{1,4}",i=["(?:".concat(r,":){7}(?:").concat(r,"|:)"),"(?:".concat(r,":){6}(?:").concat(n,"|:").concat(r,"|:)"),"(?:".concat(r,":){5}(?::").concat(n,"|(?::").concat(r,"){1,2}|:)"),"(?:".concat(r,":){4}(?:(?::").concat(r,"){0,1}:").concat(n,"|(?::").concat(r,"){1,3}|:)"),"(?:".concat(r,":){3}(?:(?::").concat(r,"){0,2}:").concat(n,"|(?::").concat(r,"){1,4}|:)"),"(?:".concat(r,":){2}(?:(?::").concat(r,"){0,3}:").concat(n,"|(?::").concat(r,"){1,5}|:)"),"(?:".concat(r,":){1}(?:(?::").concat(r,"){0,4}:").concat(n,"|(?::").concat(r,"){1,6}|:)"),"(?::(?:(?::".concat(r,"){0,5}:").concat(n,"|(?::").concat(r,"){1,7}|:))")],a="(?:%[0-9a-zA-Z]{1,})?",s="(?:".concat(i.join("|"),")").concat(a),o=new RegExp("(?:^".concat(n,"$)|(?:^").concat(s,"$)")),u=new RegExp("^".concat(n,"$")),c=new RegExp("^".concat(s,"$")),f=function(L){return L&&L.exact?o:new RegExp("(?:".concat(t(L)).concat(n).concat(t(L),")|(?:").concat(t(L)).concat(s).concat(t(L),")"),"g")};f.v4=function(E){return E&&E.exact?u:new RegExp("".concat(t(E)).concat(n).concat(t(E)),"g")},f.v6=function(E){return E&&E.exact?c:new RegExp("".concat(t(E)).concat(s).concat(t(E)),"g")};var l="(?:(?:[a-z]+:)?//)",p="(?:\\S+(?::\\S*)?@)?",y=f.v4().source,g=f.v6().source,h="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",v="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",b="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",m="(?::\\d{2,5})?",w='(?:[/?#][^\\s"]*)?',P="(?:".concat(l,"|www\\.)").concat(p,"(?:localhost|").concat(y,"|").concat(g,"|").concat(h).concat(v).concat(b,")").concat(m).concat(w);return vr=new RegExp("(?:^".concat(P,"$)"),"i"),vr};var is={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},Mn={integer:function(t){return Mn.number(t)&&parseInt(t,10)===t},float:function(t){return Mn.number(t)&&!Mn.integer(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch{return!1}},date:function(t){return typeof t.getTime=="function"&&typeof t.getMonth=="function"&&typeof t.getYear=="function"&&!isNaN(t.getTime())},number:function(t){return isNaN(t)?!1:typeof t=="number"},object:function(t){return Me(t)==="object"&&!Mn.array(t)},method:function(t){return typeof t=="function"},email:function(t){return typeof t=="string"&&t.length<=320&&!!t.match(is.email)},url:function(t){return typeof t=="string"&&t.length<=2048&&!!t.match(ml())},hex:function(t){return typeof t=="string"&&!!t.match(is.hex)}},yl=function(t,n,r,i,a){if(t.required&&n===void 0){To(t,n,r,i,a);return}var s=["integer","float","array","regexp","object","method","email","number","date","url","hex"],o=t.type;s.indexOf(o)>-1?Mn[o](n)||i.push(_e(a.messages.types[o],t.fullField,t.type)):o&&Me(n)!==t.type&&i.push(_e(a.messages.types[o],t.fullField,t.type))},xl=function(t,n,r,i,a){(/^\s+$/.test(n)||n==="")&&i.push(_e(a.messages.whitespace,t.fullField))};const H={required:To,whitespace:xl,type:yl,range:vl,enum:hl,pattern:pl};var wl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a)}r(s)},bl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(n==null&&!t.required)return r();H.required(t,n,i,s,a,"array"),n!=null&&(H.type(t,n,i,s,a),H.range(t,n,i,s,a))}r(s)},Cl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&H.type(t,n,i,s,a)}r(s)},Pl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n,"date")&&!t.required)return r();if(H.required(t,n,i,s,a),!he(n,"date")){var u;n instanceof Date?u=n:u=new Date(n),H.type(t,u,i,s,a),u&&H.range(t,u.getTime(),i,s,a)}}r(s)},Ll="enum",El=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&H[Ll](t,n,i,s,a)}r(s)},Tl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&(H.type(t,n,i,s,a),H.range(t,n,i,s,a))}r(s)},Fl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&(H.type(t,n,i,s,a),H.range(t,n,i,s,a))}r(s)},Il=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&H.type(t,n,i,s,a)}r(s)},jl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(n===""&&(n=void 0),he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&(H.type(t,n,i,s,a),H.range(t,n,i,s,a))}r(s)},Ml=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),n!==void 0&&H.type(t,n,i,s,a)}r(s)},Rl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n,"string")&&!t.required)return r();H.required(t,n,i,s,a),he(n,"string")||H.pattern(t,n,i,s,a)}r(s)},kl=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n)&&!t.required)return r();H.required(t,n,i,s,a),he(n)||H.type(t,n,i,s,a)}r(s)},Dl=function(t,n,r,i,a){var s=[],o=Array.isArray(n)?"array":Me(n);H.required(t,n,i,s,a,o),r(s)},Ol=function(t,n,r,i,a){var s=[],o=t.required||!t.required&&i.hasOwnProperty(t.field);if(o){if(he(n,"string")&&!t.required)return r();H.required(t,n,i,s,a,"string"),he(n,"string")||(H.type(t,n,i,s,a),H.range(t,n,i,s,a),H.pattern(t,n,i,s,a),t.whitespace===!0&&H.whitespace(t,n,i,s,a))}r(s)},wi=function(t,n,r,i,a){var s=t.type,o=[],u=t.required||!t.required&&i.hasOwnProperty(t.field);if(u){if(he(n,s)&&!t.required)return r();H.required(t,n,i,o,a,s),he(n,s)||H.type(t,n,i,o,a)}r(o)};const kn={string:Ol,method:Il,number:jl,boolean:Cl,regexp:kl,integer:Fl,float:Tl,array:bl,object:Ml,enum:El,pattern:Rl,date:Pl,url:wi,hex:wi,email:wi,required:Dl,any:wl};var Gn=function(){function e(t){hn(this,e),I(this,"rules",null),I(this,"_messages",Ai),this.define(t)}return pn(e,[{key:"define",value:function(n){var r=this;if(!n)throw new Error("Cannot configure a schema with no rules");if(Me(n)!=="object"||Array.isArray(n))throw new Error("Rules must be an object");this.rules={},Object.keys(n).forEach(function(i){var a=n[i];r.rules[i]=Array.isArray(a)?a:[a]})}},{key:"messages",value:function(n){return n&&(this._messages=rs(Ni(),n)),this._messages}},{key:"validate",value:function(n){var r=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},s=n,o=i,u=a;if(typeof o=="function"&&(u=o,o={}),!this.rules||Object.keys(this.rules).length===0)return u&&u(null,s),Promise.resolve(s);function c(g){var h=[],v={};function b(w){if(Array.isArray(w)){var P;h=(P=h).concat.apply(P,$(w))}else h.push(w)}for(var m=0;m<g.length;m++)b(g[m]);h.length?(v=Bi(h),u(h,v)):u(null,s)}if(o.messages){var f=this.messages();f===Ai&&(f=Ni()),rs(f,o.messages),o.messages=f}else o.messages=this.messages();var l={},p=o.keys||Object.keys(this.rules);p.forEach(function(g){var h=r.rules[g],v=s[g];h.forEach(function(b){var m=b;typeof m.transform=="function"&&(s===n&&(s=R({},s)),v=s[g]=m.transform(v),v!=null&&(m.type=m.type||(Array.isArray(v)?"array":Me(v)))),typeof m=="function"?m={validator:m}:m=R({},m),m.validator=r.getValidationMethod(m),m.validator&&(m.field=g,m.fullField=m.fullField||g,m.type=r.getType(m),l[g]=l[g]||[],l[g].push({rule:m,value:v,source:s,field:g}))})});var y={};return fl(l,o,function(g,h){var v=g.rule,b=(v.type==="object"||v.type==="array")&&(Me(v.fields)==="object"||Me(v.defaultField)==="object");b=b&&(v.required||!v.required&&g.value),v.field=g.field;function m(C,j){return R(R({},j),{},{fullField:"".concat(v.fullField,".").concat(C),fullFields:v.fullFields?[].concat($(v.fullFields),[C]):[C]})}function w(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],j=Array.isArray(C)?C:[C];!o.suppressWarning&&j.length&&e.warning("async-validator:",j),j.length&&v.message!==void 0&&(j=[].concat(v.message));var T=j.map(ns(v,s));if(o.first&&T.length)return y[v.field]=1,h(T);if(!b)h(T);else{if(v.required&&!g.value)return v.message!==void 0?T=[].concat(v.message).map(ns(v,s)):o.error&&(T=[o.error(v,_e(o.messages.required,v.field))]),h(T);var F={};v.defaultField&&Object.keys(g.value).map(function(V){F[V]=v.defaultField}),F=R(R({},F),g.rule.fields);var M={};Object.keys(F).forEach(function(V){var A=F[V],G=Array.isArray(A)?A:[A];M[V]=G.map(m.bind(null,V))});var k=new e(M);k.messages(o.messages),g.rule.options&&(g.rule.options.messages=o.messages,g.rule.options.error=o.error),k.validate(g.value,g.rule.options||o,function(V){var A=[];T&&T.length&&A.push.apply(A,$(T)),V&&V.length&&A.push.apply(A,$(V)),h(A.length?A:null)})}}var P;if(v.asyncValidator)P=v.asyncValidator(v,g.value,w,g.source,o);else if(v.validator){try{P=v.validator(v,g.value,w,g.source,o)}catch(C){var E,L;(E=(L=console).error)===null||E===void 0||E.call(L,C),o.suppressValidatorError||setTimeout(function(){throw C},0),w(C.message)}P===!0?w():P===!1?w(typeof v.message=="function"?v.message(v.fullField||v.field):v.message||"".concat(v.fullField||v.field," fails")):P instanceof Array?w(P):P instanceof Error&&w(P.message)}P&&P.then&&P.then(function(){return w()},function(C){return w(C)})},function(g){c(g)},s)}},{key:"getType",value:function(n){if(n.type===void 0&&n.pattern instanceof RegExp&&(n.type="pattern"),typeof n.validator!="function"&&n.type&&!kn.hasOwnProperty(n.type))throw new Error(_e("Unknown rule type %s",n.type));return n.type||"string"}},{key:"getValidationMethod",value:function(n){if(typeof n.validator=="function")return n.validator;var r=Object.keys(n),i=r.indexOf("message");return i!==-1&&r.splice(i,1),r.length===1&&r[0]==="required"?kn.required:kn[this.getType(n)]||void 0}}]),e}();I(Gn,"register",function(t,n){if(typeof n!="function")throw new Error("Cannot register a validator by type, validator is not a function");kn[t]=n});I(Gn,"warning",ol);I(Gn,"messages",Ai);I(Gn,"validators",kn);var Ne="'${name}' is not a valid ${type}",Fo={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:Ne,method:Ne,array:Ne,object:Ne,number:Ne,date:Ne,boolean:Ne,integer:Ne,float:Ne,regexp:Ne,email:Ne,url:Ne,hex:Ne},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},as=Gn;function Vl(e,t){return e.replace(/\\?\$\{\w+\}/g,function(n){if(n.startsWith("\\"))return n.slice(1);var r=n.slice(2,-1);return t[r]})}var ss="CODE_LOGIC_ERROR";function $i(e,t,n,r,i){return zi.apply(this,arguments)}function zi(){return zi=Wn(lt().mark(function e(t,n,r,i,a){var s,o,u,c,f,l,p,y,g;return lt().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return s=R({},r),delete s.ruleIndex,as.warning=function(){},s.validator&&(o=s.validator,s.validator=function(){try{return o.apply(void 0,arguments)}catch(b){return console.error(b),Promise.reject(ss)}}),u=null,s&&s.type==="array"&&s.defaultField&&(u=s.defaultField,delete s.defaultField),c=new as(I({},t,[s])),f=jn(Fo,i.validateMessages),c.messages(f),l=[],v.prev=10,v.next=13,Promise.resolve(c.validate(I({},t,n),R({},i)));case 13:v.next=18;break;case 15:v.prev=15,v.t0=v.catch(10),v.t0.errors&&(l=v.t0.errors.map(function(b,m){var w=b.message,P=w===ss?f.default:w;return x.isValidElement(P)?x.cloneElement(P,{key:"error_".concat(m)}):P}));case 18:if(!(!l.length&&u)){v.next=23;break}return v.next=21,Promise.all(n.map(function(b,m){return $i("".concat(t,".").concat(m),b,u,i,a)}));case 21:return p=v.sent,v.abrupt("return",p.reduce(function(b,m){return[].concat($(b),$(m))},[]));case 23:return y=R(R({},r),{},{name:t,enum:(r.enum||[]).join(", ")},a),g=l.map(function(b){return typeof b=="string"?Vl(b,y):b}),v.abrupt("return",g);case 26:case"end":return v.stop()}},e,null,[[10,15]])})),zi.apply(this,arguments)}function Nl(e,t,n,r,i,a){var s=e.join("."),o=n.map(function(f,l){var p=f.validator,y=R(R({},f),{},{ruleIndex:l});return p&&(y.validator=function(g,h,v){var b=!1,m=function(){for(var E=arguments.length,L=new Array(E),C=0;C<E;C++)L[C]=arguments[C];Promise.resolve().then(function(){Dt(!b,"Your validator function has already return a promise. `callback` will be ignored."),b||v.apply(void 0,L)})},w=p(g,h,m);b=w&&typeof w.then=="function"&&typeof w.catch=="function",Dt(b,"`callback` is deprecated. Please return a promise instead."),b&&w.then(function(){v()}).catch(function(P){v(P||" ")})}),y}).sort(function(f,l){var p=f.warningOnly,y=f.ruleIndex,g=l.warningOnly,h=l.ruleIndex;return!!p==!!g?y-h:p?1:-1}),u;if(i===!0)u=new Promise(function(){var f=Wn(lt().mark(function l(p,y){var g,h,v;return lt().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:g=0;case 1:if(!(g<o.length)){m.next=12;break}return h=o[g],m.next=5,$i(s,t,h,r,a);case 5:if(v=m.sent,!v.length){m.next=9;break}return y([{errors:v,rule:h}]),m.abrupt("return");case 9:g+=1,m.next=1;break;case 12:p([]);case 13:case"end":return m.stop()}},l)}));return function(l,p){return f.apply(this,arguments)}}());else{var c=o.map(function(f){return $i(s,t,f,r,a).then(function(l){return{errors:l,rule:f}})});u=(i?_l(c):Al(c)).then(function(f){return Promise.reject(f)})}return u.catch(function(f){return f}),u}function Al(e){return Wi.apply(this,arguments)}function Wi(){return Wi=Wn(lt().mark(function e(t){return lt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(t).then(function(i){var a,s=(a=[]).concat.apply(a,$(i));return s}));case 1:case"end":return r.stop()}},e)})),Wi.apply(this,arguments)}function _l(e){return Ui.apply(this,arguments)}function Ui(){return Ui=Wn(lt().mark(function e(t){var n;return lt().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=0,i.abrupt("return",new Promise(function(a){t.forEach(function(s){s.then(function(o){o.errors.length&&a([o]),n+=1,n===t.length&&a([])})})}));case 2:case"end":return i.stop()}},e)})),Ui.apply(this,arguments)}function oe(e){return Vi(e)}function os(e,t){var n={};return t.forEach(function(r){var i=Ht(e,r);n=Mt(n,r,i)}),n}function dn(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e&&e.some(function(r){return Io(t,r,n)})}function Io(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return!e||!t||!n&&e.length!==t.length?!1:t.every(function(r,i){return e[i]===r})}function Bl(e,t){if(e===t)return!0;if(!e&&t||e&&!t||!e||!t||Me(e)!=="object"||Me(t)!=="object")return!1;var n=Object.keys(e),r=Object.keys(t),i=new Set([].concat(n,r));return $(i).every(function(a){var s=e[a],o=t[a];return typeof s=="function"&&typeof o=="function"?!0:s===o})}function $l(e){var t=arguments.length<=1?void 0:arguments[1];return t&&t.target&&Me(t.target)==="object"&&e in t.target?t.target[e]:t}function us(e,t,n){var r=e.length;if(t<0||t>=r||n<0||n>=r)return e;var i=e[t],a=t-n;return a>0?[].concat($(e.slice(0,n)),[i],$(e.slice(n,t)),$(e.slice(t+1,r))):a<0?[].concat($(e.slice(0,t)),$(e.slice(t+1,n+1)),[i],$(e.slice(n+1,r))):e}var zl=["name"],Ge=[];function bi(e,t,n,r,i,a){return typeof e=="function"?e(t,n,"source"in a?{source:a.source}:{}):r!==i}var la=function(e){ra(n,e);var t=ia(n);function n(r){var i;if(hn(this,n),i=t.call(this,r),I(Y(i),"state",{resetCount:0}),I(Y(i),"cancelRegisterFunc",null),I(Y(i),"mounted",!1),I(Y(i),"touched",!1),I(Y(i),"dirty",!1),I(Y(i),"validatePromise",void 0),I(Y(i),"prevValidating",void 0),I(Y(i),"errors",Ge),I(Y(i),"warnings",Ge),I(Y(i),"cancelRegister",function(){var u=i.props,c=u.preserve,f=u.isListField,l=u.name;i.cancelRegisterFunc&&i.cancelRegisterFunc(f,c,oe(l)),i.cancelRegisterFunc=null}),I(Y(i),"getNamePath",function(){var u=i.props,c=u.name,f=u.fieldContext,l=f.prefixName,p=l===void 0?[]:l;return c!==void 0?[].concat($(p),$(c)):[]}),I(Y(i),"getRules",function(){var u=i.props,c=u.rules,f=c===void 0?[]:c,l=u.fieldContext;return f.map(function(p){return typeof p=="function"?p(l):p})}),I(Y(i),"refresh",function(){i.mounted&&i.setState(function(u){var c=u.resetCount;return{resetCount:c+1}})}),I(Y(i),"metaCache",null),I(Y(i),"triggerMetaEvent",function(u){var c=i.props.onMetaChange;if(c){var f=R(R({},i.getMeta()),{},{destroy:u});Da(i.metaCache,f)||c(f),i.metaCache=f}else i.metaCache=null}),I(Y(i),"onStoreChange",function(u,c,f){var l=i.props,p=l.shouldUpdate,y=l.dependencies,g=y===void 0?[]:y,h=l.onReset,v=f.store,b=i.getNamePath(),m=i.getValue(u),w=i.getValue(v),P=c&&dn(c,b);switch(f.type==="valueUpdate"&&f.source==="external"&&!Da(m,w)&&(i.touched=!0,i.dirty=!0,i.validatePromise=null,i.errors=Ge,i.warnings=Ge,i.triggerMetaEvent()),f.type){case"reset":if(!c||P){i.touched=!1,i.dirty=!1,i.validatePromise=void 0,i.errors=Ge,i.warnings=Ge,i.triggerMetaEvent(),h==null||h(),i.refresh();return}break;case"remove":{if(p&&bi(p,u,v,m,w,f)){i.reRender();return}break}case"setField":{var E=f.data;if(P){"touched"in E&&(i.touched=E.touched),"validating"in E&&!("originRCField"in E)&&(i.validatePromise=E.validating?Promise.resolve([]):null),"errors"in E&&(i.errors=E.errors||Ge),"warnings"in E&&(i.warnings=E.warnings||Ge),i.dirty=!0,i.triggerMetaEvent(),i.reRender();return}else if("value"in E&&dn(c,b,!0)){i.reRender();return}if(p&&!b.length&&bi(p,u,v,m,w,f)){i.reRender();return}break}case"dependenciesUpdate":{var L=g.map(oe);if(L.some(function(C){return dn(f.relatedFields,C)})){i.reRender();return}break}default:if(P||(!g.length||b.length||p)&&bi(p,u,v,m,w,f)){i.reRender();return}break}p===!0&&i.reRender()}),I(Y(i),"validateRules",function(u){var c=i.getNamePath(),f=i.getValue(),l=u||{},p=l.triggerName,y=l.validateOnly,g=y===void 0?!1:y,h=Promise.resolve().then(Wn(lt().mark(function v(){var b,m,w,P,E,L,C;return lt().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(i.mounted){T.next=2;break}return T.abrupt("return",[]);case 2:if(b=i.props,m=b.validateFirst,w=m===void 0?!1:m,P=b.messageVariables,E=b.validateDebounce,L=i.getRules(),p&&(L=L.filter(function(F){return F}).filter(function(F){var M=F.validateTrigger;if(!M)return!0;var k=Vi(M);return k.includes(p)})),!(E&&p)){T.next=10;break}return T.next=8,new Promise(function(F){setTimeout(F,E)});case 8:if(i.validatePromise===h){T.next=10;break}return T.abrupt("return",[]);case 10:return C=Nl(c,f,L,u,w,P),C.catch(function(F){return F}).then(function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ge;if(i.validatePromise===h){var M;i.validatePromise=null;var k=[],V=[];(M=F.forEach)===null||M===void 0||M.call(F,function(A){var G=A.rule.warningOnly,W=A.errors,U=W===void 0?Ge:W;G?V.push.apply(V,$(U)):k.push.apply(k,$(U))}),i.errors=k,i.warnings=V,i.triggerMetaEvent(),i.reRender()}}),T.abrupt("return",C);case 13:case"end":return T.stop()}},v)})));return g||(i.validatePromise=h,i.dirty=!0,i.errors=Ge,i.warnings=Ge,i.triggerMetaEvent(),i.reRender()),h}),I(Y(i),"isFieldValidating",function(){return!!i.validatePromise}),I(Y(i),"isFieldTouched",function(){return i.touched}),I(Y(i),"isFieldDirty",function(){if(i.dirty||i.props.initialValue!==void 0)return!0;var u=i.props.fieldContext,c=u.getInternalHooks(Gt),f=c.getInitialValue;return f(i.getNamePath())!==void 0}),I(Y(i),"getErrors",function(){return i.errors}),I(Y(i),"getWarnings",function(){return i.warnings}),I(Y(i),"isListField",function(){return i.props.isListField}),I(Y(i),"isList",function(){return i.props.isList}),I(Y(i),"isPreserve",function(){return i.props.preserve}),I(Y(i),"getMeta",function(){i.prevValidating=i.isFieldValidating();var u={touched:i.isFieldTouched(),validating:i.prevValidating,errors:i.errors,warnings:i.warnings,name:i.getNamePath(),validated:i.validatePromise===null};return u}),I(Y(i),"getOnlyChild",function(u){if(typeof u=="function"){var c=i.getMeta();return R(R({},i.getOnlyChild(u(i.getControlled(),c,i.props.fieldContext))),{},{isFunction:!0})}var f=_n(u);return f.length!==1||!x.isValidElement(f[0])?{child:f,isFunction:!1}:{child:f[0],isFunction:!1}}),I(Y(i),"getValue",function(u){var c=i.props.fieldContext.getFieldsValue,f=i.getNamePath();return Ht(u||c(!0),f)}),I(Y(i),"getControlled",function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=i.props,f=c.name,l=c.trigger,p=c.validateTrigger,y=c.getValueFromEvent,g=c.normalize,h=c.valuePropName,v=c.getValueProps,b=c.fieldContext,m=p!==void 0?p:b.validateTrigger,w=i.getNamePath(),P=b.getInternalHooks,E=b.getFieldsValue,L=P(Gt),C=L.dispatch,j=i.getValue(),T=v||function(A){return I({},h,A)},F=u[l],M=f!==void 0?T(j):{},k=R(R({},u),M);k[l]=function(){i.touched=!0,i.dirty=!0,i.triggerMetaEvent();for(var A,G=arguments.length,W=new Array(G),U=0;U<G;U++)W[U]=arguments[U];y?A=y.apply(void 0,W):A=$l.apply(void 0,[h].concat(W)),g&&(A=g(A,j,E(!0))),A!==j&&C({type:"updateValue",namePath:w,value:A}),F&&F.apply(void 0,W)};var V=Vi(m||[]);return V.forEach(function(A){var G=k[A];k[A]=function(){G&&G.apply(void 0,arguments);var W=i.props.rules;W&&W.length&&C({type:"validateField",namePath:w,triggerName:A})}}),k}),r.fieldContext){var a=r.fieldContext.getInternalHooks,s=a(Gt),o=s.initEntityValue;o(Y(i))}return i}return pn(n,[{key:"componentDidMount",value:function(){var i=this.props,a=i.shouldUpdate,s=i.fieldContext;if(this.mounted=!0,s){var o=s.getInternalHooks,u=o(Gt),c=u.registerField;this.cancelRegisterFunc=c(this)}a===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var i=this.state.resetCount,a=this.props.children,s=this.getOnlyChild(a),o=s.child,u=s.isFunction,c;return u?c=o:x.isValidElement(o)?c=x.cloneElement(o,this.getControlled(o.props)):(Dt(!o,"`children` of Field is not validate ReactElement."),c=o),x.createElement(x.Fragment,{key:i},c)}}]),n}(x.Component);I(la,"contextType",ln);I(la,"defaultProps",{trigger:"onChange",valuePropName:"value"});function jo(e){var t,n=e.name,r=Un(e,zl),i=x.useContext(ln),a=x.useContext(Vr),s=n!==void 0?oe(n):void 0,o=(t=r.isListField)!==null&&t!==void 0?t:!!a,u="keep";return o||(u="_".concat((s||[]).join("_"))),x.createElement(la,vn({key:u,name:s,isListField:o},r,{fieldContext:i}))}function Wl(e){var t=e.name,n=e.initialValue,r=e.children,i=e.rules,a=e.validateTrigger,s=e.isListField,o=x.useContext(ln),u=x.useContext(Vr),c=x.useRef({keys:[],id:0}),f=c.current,l=x.useMemo(function(){var h=oe(o.prefixName)||[];return[].concat($(h),$(oe(t)))},[o.prefixName,t]),p=x.useMemo(function(){return R(R({},o),{},{prefixName:l})},[o,l]),y=x.useMemo(function(){return{getKey:function(v){var b=l.length,m=v[b];return[f.keys[m],v.slice(b+1)]}}},[l]);if(typeof r!="function")return Dt(!1,"Form.List only accepts function as children."),null;var g=function(v,b,m){var w=m.source;return w==="internal"?!1:v!==b};return x.createElement(Vr.Provider,{value:y},x.createElement(ln.Provider,{value:p},x.createElement(jo,{name:[],shouldUpdate:g,rules:i,validateTrigger:a,initialValue:n,isList:!0,isListField:s??!!u},function(h,v){var b=h.value,m=b===void 0?[]:b,w=h.onChange,P=o.getFieldValue,E=function(){var T=P(l||[]);return T||[]},L={add:function(T,F){var M=E();F>=0&&F<=M.length?(f.keys=[].concat($(f.keys.slice(0,F)),[f.id],$(f.keys.slice(F))),w([].concat($(M.slice(0,F)),[T],$(M.slice(F))))):(f.keys=[].concat($(f.keys),[f.id]),w([].concat($(M),[T]))),f.id+=1},remove:function(T){var F=E(),M=new Set(Array.isArray(T)?T:[T]);M.size<=0||(f.keys=f.keys.filter(function(k,V){return!M.has(V)}),w(F.filter(function(k,V){return!M.has(V)})))},move:function(T,F){if(T!==F){var M=E();T<0||T>=M.length||F<0||F>=M.length||(f.keys=us(f.keys,T,F),w(us(M,T,F)))}}},C=m||[];return Array.isArray(C)||(C=[]),r(C.map(function(j,T){var F=f.keys[T];return F===void 0&&(f.keys[T]=f.id,F=f.keys[T],f.id+=1),{name:T,key:F,isListField:!0}}),L,v)})))}function Ul(e){var t=!1,n=e.length,r=[];return e.length?new Promise(function(i,a){e.forEach(function(s,o){s.catch(function(u){return t=!0,u}).then(function(u){n-=1,r[o]=u,!(n>0)&&(t&&a(r),i(r))})})}):Promise.resolve([])}var Mo="__@field_split__";function Ci(e){return e.map(function(t){return"".concat(Me(t),":").concat(t)}).join(Mo)}var rn=function(){function e(){hn(this,e),I(this,"kvs",new Map)}return pn(e,[{key:"set",value:function(n,r){this.kvs.set(Ci(n),r)}},{key:"get",value:function(n){return this.kvs.get(Ci(n))}},{key:"update",value:function(n,r){var i=this.get(n),a=r(i);a?this.set(n,a):this.delete(n)}},{key:"delete",value:function(n){this.kvs.delete(Ci(n))}},{key:"map",value:function(n){return $(this.kvs.entries()).map(function(r){var i=K(r,2),a=i[0],s=i[1],o=a.split(Mo);return n({key:o.map(function(u){var c=u.match(/^([^:]*):(.*)$/),f=K(c,3),l=f[1],p=f[2];return l==="number"?Number(p):p}),value:s})})}},{key:"toJSON",value:function(){var n={};return this.map(function(r){var i=r.key,a=r.value;return n[i.join(".")]=a,null}),n}}]),e}(),Hl=["name"],Gl=pn(function e(t){var n=this;hn(this,e),I(this,"formHooked",!1),I(this,"forceRootUpdate",void 0),I(this,"subscribable",!0),I(this,"store",{}),I(this,"fieldEntities",[]),I(this,"initialValues",{}),I(this,"callbacks",{}),I(this,"validateMessages",null),I(this,"preserve",null),I(this,"lastValidatePromise",null),I(this,"getForm",function(){return{getFieldValue:n.getFieldValue,getFieldsValue:n.getFieldsValue,getFieldError:n.getFieldError,getFieldWarning:n.getFieldWarning,getFieldsError:n.getFieldsError,isFieldsTouched:n.isFieldsTouched,isFieldTouched:n.isFieldTouched,isFieldValidating:n.isFieldValidating,isFieldsValidating:n.isFieldsValidating,resetFields:n.resetFields,setFields:n.setFields,setFieldValue:n.setFieldValue,setFieldsValue:n.setFieldsValue,validateFields:n.validateFields,submit:n.submit,_init:!0,getInternalHooks:n.getInternalHooks}}),I(this,"getInternalHooks",function(r){return r===Gt?(n.formHooked=!0,{dispatch:n.dispatch,initEntityValue:n.initEntityValue,registerField:n.registerField,useSubscribe:n.useSubscribe,setInitialValues:n.setInitialValues,destroyForm:n.destroyForm,setCallbacks:n.setCallbacks,setValidateMessages:n.setValidateMessages,getFields:n.getFields,setPreserve:n.setPreserve,getInitialValue:n.getInitialValue,registerWatch:n.registerWatch}):(Dt(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),I(this,"useSubscribe",function(r){n.subscribable=r}),I(this,"prevWithoutPreserves",null),I(this,"setInitialValues",function(r,i){if(n.initialValues=r||{},i){var a,s=jn(r,n.store);(a=n.prevWithoutPreserves)===null||a===void 0||a.map(function(o){var u=o.key;s=Mt(s,u,Ht(r,u))}),n.prevWithoutPreserves=null,n.updateStore(s)}}),I(this,"destroyForm",function(r){if(r)n.updateStore({});else{var i=new rn;n.getFieldEntities(!0).forEach(function(a){n.isMergedPreserve(a.isPreserve())||i.set(a.getNamePath(),!0)}),n.prevWithoutPreserves=i}}),I(this,"getInitialValue",function(r){var i=Ht(n.initialValues,r);return r.length?jn(i):i}),I(this,"setCallbacks",function(r){n.callbacks=r}),I(this,"setValidateMessages",function(r){n.validateMessages=r}),I(this,"setPreserve",function(r){n.preserve=r}),I(this,"watchList",[]),I(this,"registerWatch",function(r){return n.watchList.push(r),function(){n.watchList=n.watchList.filter(function(i){return i!==r})}}),I(this,"notifyWatch",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(n.watchList.length){var i=n.getFieldsValue(),a=n.getFieldsValue(!0);n.watchList.forEach(function(s){s(i,a,r)})}}),I(this,"timeoutId",null),I(this,"warningUnhooked",function(){}),I(this,"updateStore",function(r){n.store=r}),I(this,"getFieldEntities",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return r?n.fieldEntities.filter(function(i){return i.getNamePath().length}):n.fieldEntities}),I(this,"getFieldsMap",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=new rn;return n.getFieldEntities(r).forEach(function(a){var s=a.getNamePath();i.set(s,a)}),i}),I(this,"getFieldEntitiesForNamePathList",function(r){if(!r)return n.getFieldEntities(!0);var i=n.getFieldsMap(!0);return r.map(function(a){var s=oe(a);return i.get(s)||{INVALIDATE_NAME_PATH:oe(a)}})}),I(this,"getFieldsValue",function(r,i){n.warningUnhooked();var a,s,o;if(r===!0||Array.isArray(r)?(a=r,s=i):r&&Me(r)==="object"&&(o=r.strict,s=r.filter),a===!0&&!s)return n.store;var u=n.getFieldEntitiesForNamePathList(Array.isArray(a)?a:null),c=[];return u.forEach(function(f){var l,p,y="INVALIDATE_NAME_PATH"in f?f.INVALIDATE_NAME_PATH:f.getNamePath();if(o){var g,h;if((g=(h=f).isList)!==null&&g!==void 0&&g.call(h))return}else if(!a&&(l=(p=f).isListField)!==null&&l!==void 0&&l.call(p))return;if(!s)c.push(y);else{var v="getMeta"in f?f.getMeta():null;s(v)&&c.push(y)}}),os(n.store,c.map(oe))}),I(this,"getFieldValue",function(r){n.warningUnhooked();var i=oe(r);return Ht(n.store,i)}),I(this,"getFieldsError",function(r){n.warningUnhooked();var i=n.getFieldEntitiesForNamePathList(r);return i.map(function(a,s){return a&&!("INVALIDATE_NAME_PATH"in a)?{name:a.getNamePath(),errors:a.getErrors(),warnings:a.getWarnings()}:{name:oe(r[s]),errors:[],warnings:[]}})}),I(this,"getFieldError",function(r){n.warningUnhooked();var i=oe(r),a=n.getFieldsError([i])[0];return a.errors}),I(this,"getFieldWarning",function(r){n.warningUnhooked();var i=oe(r),a=n.getFieldsError([i])[0];return a.warnings}),I(this,"isFieldsTouched",function(){n.warningUnhooked();for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var s=i[0],o=i[1],u,c=!1;i.length===0?u=null:i.length===1?Array.isArray(s)?(u=s.map(oe),c=!1):(u=null,c=s):(u=s.map(oe),c=o);var f=n.getFieldEntities(!0),l=function(v){return v.isFieldTouched()};if(!u)return c?f.every(function(h){return l(h)||h.isList()}):f.some(l);var p=new rn;u.forEach(function(h){p.set(h,[])}),f.forEach(function(h){var v=h.getNamePath();u.forEach(function(b){b.every(function(m,w){return v[w]===m})&&p.update(b,function(m){return[].concat($(m),[h])})})});var y=function(v){return v.some(l)},g=p.map(function(h){var v=h.value;return v});return c?g.every(y):g.some(y)}),I(this,"isFieldTouched",function(r){return n.warningUnhooked(),n.isFieldsTouched([r])}),I(this,"isFieldsValidating",function(r){n.warningUnhooked();var i=n.getFieldEntities();if(!r)return i.some(function(s){return s.isFieldValidating()});var a=r.map(oe);return i.some(function(s){var o=s.getNamePath();return dn(a,o)&&s.isFieldValidating()})}),I(this,"isFieldValidating",function(r){return n.warningUnhooked(),n.isFieldsValidating([r])}),I(this,"resetWithFieldInitialValue",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=new rn,a=n.getFieldEntities(!0);a.forEach(function(u){var c=u.props.initialValue,f=u.getNamePath();if(c!==void 0){var l=i.get(f)||new Set;l.add({entity:u,value:c}),i.set(f,l)}});var s=function(c){c.forEach(function(f){var l=f.props.initialValue;if(l!==void 0){var p=f.getNamePath(),y=n.getInitialValue(p);if(y!==void 0)Dt(!1,"Form already set 'initialValues' with path '".concat(p.join("."),"'. Field can not overwrite it."));else{var g=i.get(p);if(g&&g.size>1)Dt(!1,"Multiple Field with path '".concat(p.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(g){var h=n.getFieldValue(p),v=f.isListField();!v&&(!r.skipExist||h===void 0)&&n.updateStore(Mt(n.store,p,$(g)[0].value))}}}})},o;r.entities?o=r.entities:r.namePathList?(o=[],r.namePathList.forEach(function(u){var c=i.get(u);if(c){var f;(f=o).push.apply(f,$($(c).map(function(l){return l.entity})))}})):o=a,s(o)}),I(this,"resetFields",function(r){n.warningUnhooked();var i=n.store;if(!r){n.updateStore(jn(n.initialValues)),n.resetWithFieldInitialValue(),n.notifyObservers(i,null,{type:"reset"}),n.notifyWatch();return}var a=r.map(oe);a.forEach(function(s){var o=n.getInitialValue(s);n.updateStore(Mt(n.store,s,o))}),n.resetWithFieldInitialValue({namePathList:a}),n.notifyObservers(i,a,{type:"reset"}),n.notifyWatch(a)}),I(this,"setFields",function(r){n.warningUnhooked();var i=n.store,a=[];r.forEach(function(s){var o=s.name,u=Un(s,Hl),c=oe(o);a.push(c),"value"in u&&n.updateStore(Mt(n.store,c,u.value)),n.notifyObservers(i,[c],{type:"setField",data:s})}),n.notifyWatch(a)}),I(this,"getFields",function(){var r=n.getFieldEntities(!0),i=r.map(function(a){var s=a.getNamePath(),o=a.getMeta(),u=R(R({},o),{},{name:s,value:n.getFieldValue(s)});return Object.defineProperty(u,"originRCField",{value:!0}),u});return i}),I(this,"initEntityValue",function(r){var i=r.props.initialValue;if(i!==void 0){var a=r.getNamePath(),s=Ht(n.store,a);s===void 0&&n.updateStore(Mt(n.store,a,i))}}),I(this,"isMergedPreserve",function(r){var i=r!==void 0?r:n.preserve;return i??!0}),I(this,"registerField",function(r){n.fieldEntities.push(r);var i=r.getNamePath();if(n.notifyWatch([i]),r.props.initialValue!==void 0){var a=n.store;n.resetWithFieldInitialValue({entities:[r],skipExist:!0}),n.notifyObservers(a,[r.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(s,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(n.fieldEntities=n.fieldEntities.filter(function(l){return l!==r}),!n.isMergedPreserve(o)&&(!s||u.length>1)){var c=s?void 0:n.getInitialValue(i);if(i.length&&n.getFieldValue(i)!==c&&n.fieldEntities.every(function(l){return!Io(l.getNamePath(),i)})){var f=n.store;n.updateStore(Mt(f,i,c,!0)),n.notifyObservers(f,[i],{type:"remove"}),n.triggerDependenciesUpdate(f,i)}}n.notifyWatch([i])}}),I(this,"dispatch",function(r){switch(r.type){case"updateValue":{var i=r.namePath,a=r.value;n.updateValue(i,a);break}case"validateField":{var s=r.namePath,o=r.triggerName;n.validateFields([s],{triggerName:o});break}}}),I(this,"notifyObservers",function(r,i,a){if(n.subscribable){var s=R(R({},a),{},{store:n.getFieldsValue(!0)});n.getFieldEntities().forEach(function(o){var u=o.onStoreChange;u(r,i,s)})}else n.forceRootUpdate()}),I(this,"triggerDependenciesUpdate",function(r,i){var a=n.getDependencyChildrenFields(i);return a.length&&n.validateFields(a),n.notifyObservers(r,a,{type:"dependenciesUpdate",relatedFields:[i].concat($(a))}),a}),I(this,"updateValue",function(r,i){var a=oe(r),s=n.store;n.updateStore(Mt(n.store,a,i)),n.notifyObservers(s,[a],{type:"valueUpdate",source:"internal"}),n.notifyWatch([a]);var o=n.triggerDependenciesUpdate(s,a),u=n.callbacks.onValuesChange;if(u){var c=os(n.store,[a]);u(c,n.getFieldsValue())}n.triggerOnFieldsChange([a].concat($(o)))}),I(this,"setFieldsValue",function(r){n.warningUnhooked();var i=n.store;if(r){var a=jn(n.store,r);n.updateStore(a)}n.notifyObservers(i,null,{type:"valueUpdate",source:"external"}),n.notifyWatch()}),I(this,"setFieldValue",function(r,i){n.setFields([{name:r,value:i,errors:[],warnings:[]}])}),I(this,"getDependencyChildrenFields",function(r){var i=new Set,a=[],s=new rn;n.getFieldEntities().forEach(function(u){var c=u.props.dependencies;(c||[]).forEach(function(f){var l=oe(f);s.update(l,function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return p.add(u),p})})});var o=function u(c){var f=s.get(c)||new Set;f.forEach(function(l){if(!i.has(l)){i.add(l);var p=l.getNamePath();l.isFieldDirty()&&p.length&&(a.push(p),u(p))}})};return o(r),a}),I(this,"triggerOnFieldsChange",function(r,i){var a=n.callbacks.onFieldsChange;if(a){var s=n.getFields();if(i){var o=new rn;i.forEach(function(c){var f=c.name,l=c.errors;o.set(f,l)}),s.forEach(function(c){c.errors=o.get(c.name)||c.errors})}var u=s.filter(function(c){var f=c.name;return dn(r,f)});u.length&&a(u,s)}}),I(this,"validateFields",function(r,i){n.warningUnhooked();var a,s;Array.isArray(r)||typeof r=="string"||typeof i=="string"?(a=r,s=i):s=r;var o=!!a,u=o?a.map(oe):[],c=[],f=String(Date.now()),l=new Set,p=s||{},y=p.recursive,g=p.dirty;n.getFieldEntities(!0).forEach(function(m){if(o||u.push(m.getNamePath()),!(!m.props.rules||!m.props.rules.length)&&!(g&&!m.isFieldDirty())){var w=m.getNamePath();if(l.add(w.join(f)),!o||dn(u,w,y)){var P=m.validateRules(R({validateMessages:R(R({},Fo),n.validateMessages)},s));c.push(P.then(function(){return{name:w,errors:[],warnings:[]}}).catch(function(E){var L,C=[],j=[];return(L=E.forEach)===null||L===void 0||L.call(E,function(T){var F=T.rule.warningOnly,M=T.errors;F?j.push.apply(j,$(M)):C.push.apply(C,$(M))}),C.length?Promise.reject({name:w,errors:C,warnings:j}):{name:w,errors:C,warnings:j}}))}}});var h=Ul(c);n.lastValidatePromise=h,h.catch(function(m){return m}).then(function(m){var w=m.map(function(P){var E=P.name;return E});n.notifyObservers(n.store,w,{type:"validateFinish"}),n.triggerOnFieldsChange(w,m)});var v=h.then(function(){return n.lastValidatePromise===h?Promise.resolve(n.getFieldsValue(u)):Promise.reject([])}).catch(function(m){var w=m.filter(function(P){return P&&P.errors.length});return Promise.reject({values:n.getFieldsValue(u),errorFields:w,outOfDate:n.lastValidatePromise!==h})});v.catch(function(m){return m});var b=u.filter(function(m){return l.has(m.join(f))});return n.triggerOnFieldsChange(b),v}),I(this,"submit",function(){n.warningUnhooked(),n.validateFields().then(function(r){var i=n.callbacks.onFinish;if(i)try{i(r)}catch(a){console.error(a)}}).catch(function(r){var i=n.callbacks.onFinishFailed;i&&i(r)})}),this.forceRootUpdate=t});function Ro(e){var t=x.useRef(),n=x.useState({}),r=K(n,2),i=r[1];if(!t.current)if(e)t.current=e;else{var a=function(){i({})},s=new Gl(a);t.current=s.getForm()}return[t.current]}var Hi=x.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),ql=function(t){var n=t.validateMessages,r=t.onFormChange,i=t.onFormFinish,a=t.children,s=x.useContext(Hi),o=x.useRef({});return x.createElement(Hi.Provider,{value:R(R({},s),{},{validateMessages:R(R({},s.validateMessages),n),triggerFormChange:function(c,f){r&&r(c,{changedFields:f,forms:o.current}),s.triggerFormChange(c,f)},triggerFormFinish:function(c,f){i&&i(c,{values:f,forms:o.current}),s.triggerFormFinish(c,f)},registerForm:function(c,f){c&&(o.current=R(R({},o.current),{},I({},c,f))),s.registerForm(c,f)},unregisterForm:function(c){var f=R({},o.current);delete f[c],o.current=f,s.unregisterForm(c)}})},a)},Yl=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"],Kl=function(t,n){var r=t.name,i=t.initialValues,a=t.fields,s=t.form,o=t.preserve,u=t.children,c=t.component,f=c===void 0?"form":c,l=t.validateMessages,p=t.validateTrigger,y=p===void 0?"onChange":p,g=t.onValuesChange,h=t.onFieldsChange,v=t.onFinish,b=t.onFinishFailed,m=t.clearOnDestroy,w=Un(t,Yl),P=x.useRef(null),E=x.useContext(Hi),L=Ro(s),C=K(L,1),j=C[0],T=j.getInternalHooks(Gt),F=T.useSubscribe,M=T.setInitialValues,k=T.setCallbacks,V=T.setValidateMessages,A=T.setPreserve,G=T.destroyForm;x.useImperativeHandle(n,function(){return R(R({},j),{},{nativeElement:P.current})}),x.useEffect(function(){return E.registerForm(r,j),function(){E.unregisterForm(r)}},[E,j,r]),V(R(R({},E.validateMessages),l)),k({onValuesChange:g,onFieldsChange:function(_){if(E.triggerFormChange(r,_),h){for(var q=arguments.length,Pe=new Array(q>1?q-1:0),Re=1;Re<q;Re++)Pe[Re-1]=arguments[Re];h.apply(void 0,[_].concat(Pe))}},onFinish:function(_){E.triggerFormFinish(r,_),v&&v(_)},onFinishFailed:b}),A(o);var W=x.useRef(null);M(i,!W.current),W.current||(W.current=!0),x.useEffect(function(){return function(){return G(m)}},[]);var U,J=typeof u=="function";if(J){var S=j.getFieldsValue(!0);U=u(S,j)}else U=u;F(!J);var z=x.useRef();x.useEffect(function(){Bl(z.current||[],a||[])||j.setFields(a||[]),z.current=a},[a,j]);var pe=x.useMemo(function(){return R(R({},j),{},{validateTrigger:y})},[j,y]),ie=x.createElement(Vr.Provider,{value:null},x.createElement(ln.Provider,{value:pe},U));return f===!1?ie:x.createElement(f,vn({},w,{ref:P,onSubmit:function(_){_.preventDefault(),_.stopPropagation(),j.submit()},onReset:function(_){var q;_.preventDefault(),j.resetFields(),(q=w.onReset)===null||q===void 0||q.call(w,_)}}),ie)};function ds(e){try{return JSON.stringify(e)}catch{return Math.random()}}function Zl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t[1],a=i===void 0?{}:i,s=rl(a)?{form:a}:a,o=s.form,u=x.useState(),c=K(u,2),f=c[0],l=c[1],p=x.useMemo(function(){return ds(f)},[f]),y=x.useRef(p);y.current=p;var g=x.useContext(ln),h=o||g,v=h&&h._init,b=oe(r),m=x.useRef(b);return m.current=b,x.useEffect(function(){if(v){var w=h.getFieldsValue,P=h.getInternalHooks,E=P(Gt),L=E.registerWatch,C=function(M,k){var V=s.preserve?k:M;return typeof r=="function"?r(V):Ht(V,m.current)},j=L(function(F,M){var k=C(F,M),V=ds(k);y.current!==V&&(y.current=V,l(k))}),T=C(w(),w(!0));return f!==T&&l(T),j}},[v]),f}var Xl=x.forwardRef(Kl),qn=Xl;qn.FormProvider=ql;qn.Field=jo;qn.List=Wl;qn.useForm=Ro;qn.useWatch=Zl;const cs=x.createContext({}),Jl=e=>{let{children:t,status:n,override:r}=e;const i=x.useContext(cs),a=x.useMemo(()=>{const s=Object.assign({},i);return r&&delete s.isFormItemInput,n&&(delete s.status,delete s.hasFeedback,delete s.feedbackIcon),s},[n,r,i]);return x.createElement(cs.Provider,{value:a},t)},bp=x.createContext(void 0),Ql=e=>{const{space:t,form:n,children:r}=e;if(r==null)return null;let i=r;return n&&(i=bt.createElement(Jl,{override:!0,status:!0},i)),t&&(i=bt.createElement(Rf,null,i)),i},Sl=function(){if(typeof navigator>"u"||typeof window>"u")return!1;var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e==null?void 0:e.substr(0,4))};function eg(e){var t=e.prefixCls,n=e.align,r=e.arrow,i=e.arrowPos,a=r||{},s=a.className,o=a.content,u=i.x,c=u===void 0?0:u,f=i.y,l=f===void 0?0:f,p=x.useRef();if(!n||!n.points)return null;var y={position:"absolute"};if(n.autoArrow!==!1){var g=n.points[0],h=n.points[1],v=g[0],b=g[1],m=h[0],w=h[1];v===m||!["t","b"].includes(v)?y.top=l:v==="t"?y.top=0:y.bottom=0,b===w||!["l","r"].includes(b)?y.left=c:b==="l"?y.left=0:y.right=0}return x.createElement("div",{ref:p,className:Fe("".concat(t,"-arrow"),s),style:y},o)}function tg(e){var t=e.prefixCls,n=e.open,r=e.zIndex,i=e.mask,a=e.motion;return i?x.createElement(Ys,vn({},a,{motionAppear:!0,visible:n,removeOnLeave:!0}),function(s){var o=s.className;return x.createElement("div",{style:{zIndex:r},className:Fe("".concat(t,"-mask"),o)})}):null}var ng=x.memo(function(e){var t=e.children;return t},function(e,t){return t.cache}),rg=x.forwardRef(function(e,t){var n=e.popup,r=e.className,i=e.prefixCls,a=e.style,s=e.target,o=e.onVisibleChanged,u=e.open,c=e.keepDom,f=e.fresh,l=e.onClick,p=e.mask,y=e.arrow,g=e.arrowPos,h=e.align,v=e.motion,b=e.maskMotion,m=e.forceRender,w=e.getPopupContainer,P=e.autoDestroy,E=e.portal,L=e.zIndex,C=e.onMouseEnter,j=e.onMouseLeave,T=e.onPointerEnter,F=e.onPointerDownCapture,M=e.ready,k=e.offsetX,V=e.offsetY,A=e.offsetR,G=e.offsetB,W=e.onAlign,U=e.onPrepare,J=e.stretch,S=e.targetWidth,z=e.targetHeight,pe=typeof n=="function"?n():n,ie=u||c,Z=(w==null?void 0:w.length)>0,_=x.useState(!w||!Z),q=K(_,2),Pe=q[0],Re=q[1];if(Ae(function(){!Pe&&Z&&s&&Re(!0)},[Pe,Z,s]),!Pe)return null;var ke="auto",Ie={left:"-1000vw",top:"-1000vh",right:ke,bottom:ke};if(M||!u){var nt,Ze=h.points,De=h.dynamicInset||((nt=h._experimental)===null||nt===void 0?void 0:nt.dynamicInset),me=De&&Ze[0][1]==="r",Oe=De&&Ze[0][0]==="b";me?(Ie.right=A,Ie.left=ke):(Ie.left=k,Ie.right=ke),Oe?(Ie.bottom=G,Ie.top=ke):(Ie.top=V,Ie.bottom=ke)}var Le={};return J&&(J.includes("height")&&z?Le.height=z:J.includes("minHeight")&&z&&(Le.minHeight=z),J.includes("width")&&S?Le.width=S:J.includes("minWidth")&&S&&(Le.minWidth=S)),u||(Le.pointerEvents="none"),x.createElement(E,{open:m||ie,getContainer:w&&function(){return w(s)},autoDestroy:P},x.createElement(tg,{prefixCls:i,open:u,zIndex:L,mask:p,motion:b}),x.createElement(fa,{onResize:W,disabled:!u},function(gt){return x.createElement(Ys,vn({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:m,leavedClassName:"".concat(i,"-hidden")},v,{onAppearPrepare:U,onEnterPrepare:U,visible:u,onVisibleChanged:function(ye){var $e;v==null||($e=v.onVisibleChanged)===null||$e===void 0||$e.call(v,ye),o(ye)}}),function(Be,ye){var $e=Be.className,ht=Be.style,xe=Fe(i,$e,r);return x.createElement("div",{ref:od(gt,t,ye),className:xe,style:R(R(R(R({"--arrow-x":"".concat(g.x||0,"px"),"--arrow-y":"".concat(g.y||0,"px")},Ie),Le),ht),{},{boxSizing:"border-box",zIndex:L},a),onMouseEnter:C,onMouseLeave:j,onPointerEnter:T,onClick:l,onPointerDownCapture:F},y&&x.createElement(eg,{prefixCls:i,arrow:y,arrowPos:g,align:h}),x.createElement(ng,{cache:!u&&!f},pe))})}))}),ig=x.forwardRef(function(e,t){var n=e.children,r=e.getTriggerDOMNode,i=aa(n),a=x.useCallback(function(o){ud(t,r?r(o):o)},[r]),s=sa(a,Ws(n));return i?x.cloneElement(n,{ref:s}):n}),fs=x.createContext(null);function ls(e){return e?Array.isArray(e)?e:[e]:[]}function ag(e,t,n,r){return x.useMemo(function(){var i=ls(n??t),a=ls(r??t),s=new Set(i),o=new Set(a);return e&&(s.has("hover")&&(s.delete("hover"),s.add("click")),o.has("hover")&&(o.delete("hover"),o.add("click"))),[s,o]},[e,t,n,r])}function sg(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return n?e[0]===t[0]:e[0]===t[0]&&e[1]===t[1]}function og(e,t,n,r){for(var i=n.points,a=Object.keys(e),s=0;s<a.length;s+=1){var o,u=a[s];if(sg((o=e[u])===null||o===void 0?void 0:o.points,i,r))return"".concat(t,"-placement-").concat(u)}return""}function gs(e,t,n,r){return t||(n?{motionName:"".concat(e,"-").concat(n)}:r?{motionName:r}:null)}function Yn(e){return e.ownerDocument.defaultView}function Gi(e){for(var t=[],n=e==null?void 0:e.parentElement,r=["hidden","scroll","clip","auto"];n;){var i=Yn(n).getComputedStyle(n),a=i.overflowX,s=i.overflowY,o=i.overflow;[a,s,o].some(function(u){return r.includes(u)})&&t.push(n),n=n.parentElement}return t}function Bn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Number.isNaN(e)?t:e}function In(e){return Bn(parseFloat(e),0)}function hs(e,t){var n=R({},e);return(t||[]).forEach(function(r){if(!(r instanceof HTMLBodyElement||r instanceof HTMLHtmlElement)){var i=Yn(r).getComputedStyle(r),a=i.overflow,s=i.overflowClipMargin,o=i.borderTopWidth,u=i.borderBottomWidth,c=i.borderLeftWidth,f=i.borderRightWidth,l=r.getBoundingClientRect(),p=r.offsetHeight,y=r.clientHeight,g=r.offsetWidth,h=r.clientWidth,v=In(o),b=In(u),m=In(c),w=In(f),P=Bn(Math.round(l.width/g*1e3)/1e3),E=Bn(Math.round(l.height/p*1e3)/1e3),L=(g-h-m-w)*P,C=(p-y-v-b)*E,j=v*E,T=b*E,F=m*P,M=w*P,k=0,V=0;if(a==="clip"){var A=In(s);k=A*P,V=A*E}var G=l.x+F-k,W=l.y+j-V,U=G+l.width+2*k-F-M-L,J=W+l.height+2*V-j-T-C;n.left=Math.max(n.left,G),n.top=Math.max(n.top,W),n.right=Math.min(n.right,U),n.bottom=Math.min(n.bottom,J)}}),n}function ps(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n="".concat(t),r=n.match(/^(.*)\%$/);return r?e*(parseFloat(r[1])/100):parseFloat(n)}function vs(e,t){var n=t||[],r=K(n,2),i=r[0],a=r[1];return[ps(e.width,i),ps(e.height,a)]}function ms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[e[0],e[1]]}function an(e,t){var n=t[0],r=t[1],i,a;return n==="t"?a=e.y:n==="b"?a=e.y+e.height:a=e.y+e.height/2,r==="l"?i=e.x:r==="r"?i=e.x+e.width:i=e.x+e.width/2,{x:i,y:a}}function jt(e,t){var n={t:"b",b:"t",l:"r",r:"l"};return e.map(function(r,i){return i===t?n[r]||"c":r}).join("")}function ug(e,t,n,r,i,a,s){var o=x.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:i[r]||{}}),u=K(o,2),c=u[0],f=u[1],l=x.useRef(0),p=x.useMemo(function(){return t?Gi(t):[]},[t]),y=x.useRef({}),g=function(){y.current={}};e||g();var h=yt(function(){if(t&&n&&e){let He=function(tn,Ft){var It=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Zt,Tn=_.x+tn,dr=_.y+Ft,di=Tn+me,ci=dr+De,fi=Math.max(Tn,It.left),D=Math.max(dr,It.top),B=Math.min(di,It.right),re=Math.min(ci,It.bottom);return Math.max(0,(B-fi)*(re-D))},ur=function(){_t=_.y+ne,Bt=_t+De,vt=_.x+te,Jt=vt+me};var m,w,P,E,L=t,C=L.ownerDocument,j=Yn(L),T=j.getComputedStyle(L),F=T.width,M=T.height,k=T.position,V=L.style.left,A=L.style.top,G=L.style.right,W=L.style.bottom,U=L.style.overflow,J=R(R({},i[r]),a),S=C.createElement("div");(m=L.parentElement)===null||m===void 0||m.appendChild(S),S.style.left="".concat(L.offsetLeft,"px"),S.style.top="".concat(L.offsetTop,"px"),S.style.position=k,S.style.height="".concat(L.offsetHeight,"px"),S.style.width="".concat(L.offsetWidth,"px"),L.style.left="0",L.style.top="0",L.style.right="auto",L.style.bottom="auto",L.style.overflow="hidden";var z;if(Array.isArray(n))z={x:n[0],y:n[1],width:0,height:0};else{var pe,ie,Z=n.getBoundingClientRect();Z.x=(pe=Z.x)!==null&&pe!==void 0?pe:Z.left,Z.y=(ie=Z.y)!==null&&ie!==void 0?ie:Z.top,z={x:Z.x,y:Z.y,width:Z.width,height:Z.height}}var _=L.getBoundingClientRect();_.x=(w=_.x)!==null&&w!==void 0?w:_.left,_.y=(P=_.y)!==null&&P!==void 0?P:_.top;var q=C.documentElement,Pe=q.clientWidth,Re=q.clientHeight,ke=q.scrollWidth,Ie=q.scrollHeight,nt=q.scrollTop,Ze=q.scrollLeft,De=_.height,me=_.width,Oe=z.height,Le=z.width,gt={left:0,top:0,right:Pe,bottom:Re},Be={left:-Ze,top:-nt,right:ke-Ze,bottom:Ie-nt},ye=J.htmlRegion,$e="visible",ht="visibleFirst";ye!=="scroll"&&ye!==ht&&(ye=$e);var xe=ye===ht,mn=hs(Be,p),Q=hs(gt,p),Zt=ye===$e?Q:mn,pt=xe?Q:Zt;L.style.left="auto",L.style.top="auto",L.style.right="0",L.style.bottom="0";var we=L.getBoundingClientRect();L.style.left=V,L.style.top=A,L.style.right=G,L.style.bottom=W,L.style.overflow=U,(E=L.parentElement)===null||E===void 0||E.removeChild(S);var rt=Bn(Math.round(me/parseFloat(F)*1e3)/1e3),Xe=Bn(Math.round(De/parseFloat(M)*1e3)/1e3);if(rt===0||Xe===0||Mi(n)&&!Ef(n))return;var yn=J.offset,le=J.targetOffset,Ee=vs(_,yn),ve=K(Ee,2),Je=ve[0],ze=ve[1],qr=vs(z,le),Nt=K(qr,2),We=Nt[0],Lt=Nt[1];z.x-=We,z.y-=Lt;var Yr=J.points||[],Kn=K(Yr,2),Kr=Kn[0],Zr=Kn[1],it=ms(Zr),Ve=ms(Kr),xn=an(z,it),je=an(_,Ve),Et=R({},J),te=xn.x-je.x+Je,ne=xn.y-je.y+ze,Qe=He(te,ne),At=He(te,ne,Q),wn=an(z,["t","l"]),Ue=an(_,["t","l"]),Zn=an(z,["b","r"]),bn=an(_,["b","r"]),Tt=J.overflow||{},Xn=Tt.adjustX,Xr=Tt.adjustY,Cn=Tt.shiftX,Xt=Tt.shiftY,Pn=function(Ft){return typeof Ft=="boolean"?Ft:Ft>=0},_t,Bt,vt,Jt;ur();var $t=Pn(Xr),Jn=Ve[0]===it[0];if($t&&Ve[0]==="t"&&(Bt>pt.bottom||y.current.bt)){var be=ne;Jn?be-=De-Oe:be=wn.y-bn.y-ze;var Qn=He(te,be),Jr=He(te,be,Q);Qn>Qe||Qn===Qe&&(!xe||Jr>=At)?(y.current.bt=!0,ne=be,ze=-ze,Et.points=[jt(Ve,0),jt(it,0)]):y.current.bt=!1}if($t&&Ve[0]==="b"&&(_t<pt.top||y.current.tb)){var zt=ne;Jn?zt+=De-Oe:zt=Zn.y-Ue.y-ze;var Sn=He(te,zt),Qr=He(te,zt,Q);Sn>Qe||Sn===Qe&&(!xe||Qr>=At)?(y.current.tb=!0,ne=zt,ze=-ze,Et.points=[jt(Ve,0),jt(it,0)]):y.current.tb=!1}var er=Pn(Xn),tr=Ve[1]===it[1];if(er&&Ve[1]==="l"&&(Jt>pt.right||y.current.rl)){var Wt=te;tr?Wt-=me-Le:Wt=wn.x-bn.x-Je;var nr=He(Wt,ne),Qt=He(Wt,ne,Q);nr>Qe||nr===Qe&&(!xe||Qt>=At)?(y.current.rl=!0,te=Wt,Je=-Je,Et.points=[jt(Ve,1),jt(it,1)]):y.current.rl=!1}if(er&&Ve[1]==="r"&&(vt<pt.left||y.current.lr)){var mt=te;tr?mt+=me-Le:mt=Zn.x-Ue.x-Je;var rr=He(mt,ne),ir=He(mt,ne,Q);rr>Qe||rr===Qe&&(!xe||ir>=At)?(y.current.lr=!0,te=mt,Je=-Je,Et.points=[jt(Ve,1),jt(it,1)]):y.current.lr=!1}ur();var at=Cn===!0?0:Cn;typeof at=="number"&&(vt<Q.left&&(te-=vt-Q.left-Je,z.x+Le<Q.left+at&&(te+=z.x-Q.left+Le-at)),Jt>Q.right&&(te-=Jt-Q.right-Je,z.x>Q.right-at&&(te+=z.x-Q.right+at)));var Se=Xt===!0?0:Xt;typeof Se=="number"&&(_t<Q.top&&(ne-=_t-Q.top-ze,z.y+Oe<Q.top+Se&&(ne+=z.y-Q.top+Oe-Se)),Bt>Q.bottom&&(ne-=Bt-Q.bottom-ze,z.y>Q.bottom-Se&&(ne+=z.y-Q.bottom+Se)));var St=_.x+te,en=St+me,st=_.y+ne,Sr=st+De,ar=z.x,ei=ar+Le,Ln=z.y,ti=Ln+Oe,ni=Math.max(St,ar),ri=Math.min(en,ei),sr=(ni+ri)/2,ii=sr-St,ai=Math.max(st,Ln),or=Math.min(Sr,ti),si=(ai+or)/2,oi=si-st;s==null||s(t,Et);var En=we.right-_.x-(te+_.width),ot=we.bottom-_.y-(ne+_.height);rt===1&&(te=Math.round(te),En=Math.round(En)),Xe===1&&(ne=Math.round(ne),ot=Math.round(ot));var ui={ready:!0,offsetX:te/rt,offsetY:ne/Xe,offsetR:En/rt,offsetB:ot/Xe,arrowX:ii/rt,arrowY:oi/Xe,scaleX:rt,scaleY:Xe,align:Et};f(ui)}}),v=function(){l.current+=1;var w=l.current;Promise.resolve().then(function(){l.current===w&&h()})},b=function(){f(function(w){return R(R({},w),{},{ready:!1})})};return Ae(b,[r]),Ae(function(){e||b()},[e]),[c.ready,c.offsetX,c.offsetY,c.offsetR,c.offsetB,c.arrowX,c.arrowY,c.scaleX,c.scaleY,c.align,v]}function dg(e,t,n,r,i){Ae(function(){if(e&&t&&n){let l=function(){r(),i()};var a=t,s=n,o=Gi(a),u=Gi(s),c=Yn(s),f=new Set([c].concat($(o),$(u)));return f.forEach(function(p){p.addEventListener("scroll",l,{passive:!0})}),c.addEventListener("resize",l,{passive:!0}),r(),function(){f.forEach(function(p){p.removeEventListener("scroll",l),c.removeEventListener("resize",l)})}}},[e,t,n])}function cg(e,t,n,r,i,a,s,o){var u=x.useRef(e);u.current=e;var c=x.useRef(!1);x.useEffect(function(){if(t&&r&&(!i||a)){var l=function(){c.current=!1},p=function(v){var b;u.current&&!s(((b=v.composedPath)===null||b===void 0||(b=b.call(v))===null||b===void 0?void 0:b[0])||v.target)&&!c.current&&o(!1)},y=Yn(r);y.addEventListener("pointerdown",l,!0),y.addEventListener("mousedown",p,!0),y.addEventListener("contextmenu",p,!0);var g=Ri(n);return g&&(g.addEventListener("mousedown",p,!0),g.addEventListener("contextmenu",p,!0)),function(){y.removeEventListener("pointerdown",l,!0),y.removeEventListener("mousedown",p,!0),y.removeEventListener("contextmenu",p,!0),g&&(g.removeEventListener("mousedown",p,!0),g.removeEventListener("contextmenu",p,!0))}}},[t,n,r,i,a]);function f(){c.current=!0}return f}var fg=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function lg(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Lo,t=x.forwardRef(function(n,r){var i=n.prefixCls,a=i===void 0?"rc-trigger-popup":i,s=n.children,o=n.action,u=o===void 0?"hover":o,c=n.showAction,f=n.hideAction,l=n.popupVisible,p=n.defaultPopupVisible,y=n.onPopupVisibleChange,g=n.afterPopupVisibleChange,h=n.mouseEnterDelay,v=n.mouseLeaveDelay,b=v===void 0?.1:v,m=n.focusDelay,w=n.blurDelay,P=n.mask,E=n.maskClosable,L=E===void 0?!0:E,C=n.getPopupContainer,j=n.forceRender,T=n.autoDestroy,F=n.destroyPopupOnHide,M=n.popup,k=n.popupClassName,V=n.popupStyle,A=n.popupPlacement,G=n.builtinPlacements,W=G===void 0?{}:G,U=n.popupAlign,J=n.zIndex,S=n.stretch,z=n.getPopupClassNameFromAlign,pe=n.fresh,ie=n.alignPoint,Z=n.onPopupClick,_=n.onPopupAlign,q=n.arrow,Pe=n.popupMotion,Re=n.maskMotion,ke=n.popupTransitionName,Ie=n.popupAnimation,nt=n.maskTransitionName,Ze=n.maskAnimation,De=n.className,me=n.getTriggerDOMNode,Oe=Un(n,fg),Le=T||F||!1,gt=x.useState(!1),Be=K(gt,2),ye=Be[0],$e=Be[1];Ae(function(){$e(Sl())},[]);var ht=x.useRef({}),xe=x.useContext(fs),mn=x.useMemo(function(){return{registerSubPopup:function(B,re){ht.current[B]=re,xe==null||xe.registerSubPopup(B,re)}}},[xe]),Q=Eo(),Zt=x.useState(null),pt=K(Zt,2),we=pt[0],rt=pt[1],Xe=x.useRef(null),yn=yt(function(D){Xe.current=D,Mi(D)&&we!==D&&rt(D),xe==null||xe.registerSubPopup(Q,D)}),le=x.useState(null),Ee=K(le,2),ve=Ee[0],Je=Ee[1],ze=x.useRef(null),qr=yt(function(D){Mi(D)&&ve!==D&&(Je(D),ze.current=D)}),Nt=x.Children.only(s),We=(Nt==null?void 0:Nt.props)||{},Lt={},Yr=yt(function(D){var B,re,ge=ve;return(ge==null?void 0:ge.contains(D))||((B=Ri(ge))===null||B===void 0?void 0:B.host)===D||D===ge||(we==null?void 0:we.contains(D))||((re=Ri(we))===null||re===void 0?void 0:re.host)===D||D===we||Object.values(ht.current).some(function(ae){return(ae==null?void 0:ae.contains(D))||D===ae})}),Kn=gs(a,Pe,Ie,ke),Kr=gs(a,Re,Ze,nt),Zr=x.useState(p||!1),it=K(Zr,2),Ve=it[0],xn=it[1],je=l??Ve,Et=yt(function(D){l===void 0&&xn(D)});Ae(function(){xn(l||!1)},[l]);var te=x.useRef(je);te.current=je;var ne=x.useRef([]);ne.current=[];var Qe=yt(function(D){var B;Et(D),((B=ne.current[ne.current.length-1])!==null&&B!==void 0?B:je)!==D&&(ne.current.push(D),y==null||y(D))}),At=x.useRef(),wn=function(){clearTimeout(At.current)},Ue=function(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;wn(),re===0?Qe(B):At.current=setTimeout(function(){Qe(B)},re*1e3)};x.useEffect(function(){return wn},[]);var Zn=x.useState(!1),bn=K(Zn,2),Tt=bn[0],Xn=bn[1];Ae(function(D){(!D||je)&&Xn(!0)},[je]);var Xr=x.useState(null),Cn=K(Xr,2),Xt=Cn[0],Pn=Cn[1],_t=x.useState(null),Bt=K(_t,2),vt=Bt[0],Jt=Bt[1],$t=function(B){Jt([B.clientX,B.clientY])},Jn=ug(je,we,ie&&vt!==null?vt:ve,A,W,U,_),be=K(Jn,11),Qn=be[0],Jr=be[1],zt=be[2],Sn=be[3],Qr=be[4],er=be[5],tr=be[6],Wt=be[7],nr=be[8],Qt=be[9],mt=be[10],rr=ag(ye,u,c,f),ir=K(rr,2),at=ir[0],Se=ir[1],St=at.has("click"),en=Se.has("click")||Se.has("contextMenu"),st=yt(function(){Tt||mt()}),Sr=function(){te.current&&ie&&en&&Ue(!1)};dg(je,ve,we,st,Sr),Ae(function(){st()},[vt,A]),Ae(function(){je&&!(W!=null&&W[A])&&st()},[JSON.stringify(U)]);var ar=x.useMemo(function(){var D=og(W,a,Qt,ie);return Fe(D,z==null?void 0:z(Qt))},[Qt,z,W,a,ie]);x.useImperativeHandle(r,function(){return{nativeElement:ze.current,popupElement:Xe.current,forceAlign:st}});var ei=x.useState(0),Ln=K(ei,2),ti=Ln[0],ni=Ln[1],ri=x.useState(0),sr=K(ri,2),ii=sr[0],ai=sr[1],or=function(){if(S&&ve){var B=ve.getBoundingClientRect();ni(B.width),ai(B.height)}},si=function(){or(),st()},oi=function(B){Xn(!1),mt(),g==null||g(B)},En=function(){return new Promise(function(B){or(),Pn(function(){return B})})};Ae(function(){Xt&&(mt(),Xt(),Pn(null))},[Xt]);function ot(D,B,re,ge){Lt[D]=function(ae){var cr;ge==null||ge(ae),Ue(B,re);for(var li=arguments.length,Ta=new Array(li>1?li-1:0),fr=1;fr<li;fr++)Ta[fr-1]=arguments[fr];(cr=We[D])===null||cr===void 0||cr.call.apply(cr,[We,ae].concat(Ta))}}(St||en)&&(Lt.onClick=function(D){var B;te.current&&en?Ue(!1):!te.current&&St&&($t(D),Ue(!0));for(var re=arguments.length,ge=new Array(re>1?re-1:0),ae=1;ae<re;ae++)ge[ae-1]=arguments[ae];(B=We.onClick)===null||B===void 0||B.call.apply(B,[We,D].concat(ge))});var ui=cg(je,en,ve,we,P,L,Yr,Ue),He=at.has("hover"),ur=Se.has("hover"),tn,Ft;He&&(ot("onMouseEnter",!0,h,function(D){$t(D)}),ot("onPointerEnter",!0,h,function(D){$t(D)}),tn=function(B){(je||Tt)&&we!==null&&we!==void 0&&we.contains(B.target)&&Ue(!0,h)},ie&&(Lt.onMouseMove=function(D){var B;(B=We.onMouseMove)===null||B===void 0||B.call(We,D)})),ur&&(ot("onMouseLeave",!1,b),ot("onPointerLeave",!1,b),Ft=function(){Ue(!1,b)}),at.has("focus")&&ot("onFocus",!0,m),Se.has("focus")&&ot("onBlur",!1,w),at.has("contextMenu")&&(Lt.onContextMenu=function(D){var B;te.current&&Se.has("contextMenu")?Ue(!1):($t(D),Ue(!0)),D.preventDefault();for(var re=arguments.length,ge=new Array(re>1?re-1:0),ae=1;ae<re;ae++)ge[ae-1]=arguments[ae];(B=We.onContextMenu)===null||B===void 0||B.call.apply(B,[We,D].concat(ge))}),De&&(Lt.className=Fe(We.className,De));var It=R(R({},We),Lt),Tn={},dr=["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"];dr.forEach(function(D){Oe[D]&&(Tn[D]=function(){for(var B,re=arguments.length,ge=new Array(re),ae=0;ae<re;ae++)ge[ae]=arguments[ae];(B=It[D])===null||B===void 0||B.call.apply(B,[It].concat(ge)),Oe[D].apply(Oe,ge)})});var di=x.cloneElement(Nt,R(R({},It),Tn)),ci={x:er,y:tr},fi=q?R({},q!==!0?q:{}):null;return x.createElement(x.Fragment,null,x.createElement(fa,{disabled:!je,ref:qr,onResize:si},x.createElement(ig,{getTriggerDOMNode:me},di)),x.createElement(fs.Provider,{value:mn},x.createElement(rg,{portal:e,ref:yn,prefixCls:a,popup:M,className:Fe(k,ar),style:V,target:ve,onMouseEnter:tn,onMouseLeave:Ft,onPointerEnter:tn,zIndex:J,open:je,keepDom:Tt,fresh:pe,onClick:Z,onPointerDownCapture:ui,mask:P,motion:Kn,maskMotion:Kr,onVisibleChanged:oi,onPrepare:En,forceRender:j,autoDestroy:Le,getPopupContainer:C,align:Qt,arrow:fi,arrowPos:ci,ready:Qn,offsetX:Jr,offsetY:zt,offsetR:Sn,offsetB:Qr,onAlign:st,stretch:S,targetWidth:ti/Wt,targetHeight:ii/nr})))});return t}const gg=lg(Lo);function ko(e){var t=e.children,n=e.prefixCls,r=e.id,i=e.overlayInnerStyle,a=e.bodyClassName,s=e.className,o=e.style;return x.createElement("div",{className:Fe("".concat(n,"-content"),s),style:o},x.createElement("div",{className:Fe("".concat(n,"-inner"),a),id:r,role:"tooltip",style:i},typeof t=="function"?t():t))}var sn={shiftX:64,adjustY:1},on={adjustX:1,shiftY:!0},qe=[0,0],hg={left:{points:["cr","cl"],overflow:on,offset:[-4,0],targetOffset:qe},right:{points:["cl","cr"],overflow:on,offset:[4,0],targetOffset:qe},top:{points:["bc","tc"],overflow:sn,offset:[0,-4],targetOffset:qe},bottom:{points:["tc","bc"],overflow:sn,offset:[0,4],targetOffset:qe},topLeft:{points:["bl","tl"],overflow:sn,offset:[0,-4],targetOffset:qe},leftTop:{points:["tr","tl"],overflow:on,offset:[-4,0],targetOffset:qe},topRight:{points:["br","tr"],overflow:sn,offset:[0,-4],targetOffset:qe},rightTop:{points:["tl","tr"],overflow:on,offset:[4,0],targetOffset:qe},bottomRight:{points:["tr","br"],overflow:sn,offset:[0,4],targetOffset:qe},rightBottom:{points:["bl","br"],overflow:on,offset:[4,0],targetOffset:qe},bottomLeft:{points:["tl","bl"],overflow:sn,offset:[0,4],targetOffset:qe},leftBottom:{points:["br","bl"],overflow:on,offset:[-4,0],targetOffset:qe}},pg=["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle","arrowContent","overlay","id","showArrow","classNames","styles"],vg=function(t,n){var r=t.overlayClassName,i=t.trigger,a=i===void 0?["hover"]:i,s=t.mouseEnterDelay,o=s===void 0?0:s,u=t.mouseLeaveDelay,c=u===void 0?.1:u,f=t.overlayStyle,l=t.prefixCls,p=l===void 0?"rc-tooltip":l,y=t.children,g=t.onVisibleChange,h=t.afterVisibleChange,v=t.transitionName,b=t.animation,m=t.motion,w=t.placement,P=w===void 0?"right":w,E=t.align,L=E===void 0?{}:E,C=t.destroyTooltipOnHide,j=C===void 0?!1:C,T=t.defaultVisible,F=t.getTooltipContainer,M=t.overlayInnerStyle;t.arrowContent;var k=t.overlay,V=t.id,A=t.showArrow,G=A===void 0?!0:A,W=t.classNames,U=t.styles,J=Un(t,pg),S=Eo(V),z=x.useRef(null);x.useImperativeHandle(n,function(){return z.current});var pe=R({},J);"visible"in t&&(pe.popupVisible=t.visible);var ie=function(){return x.createElement(ko,{key:"content",prefixCls:p,id:S,bodyClassName:W==null?void 0:W.body,overlayInnerStyle:R(R({},M),U==null?void 0:U.body)},k)},Z=function(){var q=x.Children.only(y),Pe=(q==null?void 0:q.props)||{},Re=R(R({},Pe),{},{"aria-describedby":k?S:null});return x.cloneElement(y,Re)};return x.createElement(gg,vn({popupClassName:Fe(r,W==null?void 0:W.root),prefixCls:p,popup:ie,action:a,builtinPlacements:hg,popupPlacement:P,ref:z,popupAlign:L,getPopupContainer:F,onPopupVisibleChange:g,afterPopupVisibleChange:h,popupTransitionName:v,popupAnimation:b,popupMotion:m,defaultPopupVisible:T,autoDestroy:j,mouseLeaveDelay:c,popupStyle:R(R({},f),U==null?void 0:U.root),mouseEnterDelay:o,arrow:G},pe),Z())};const mg=x.forwardRef(vg);function yg(e){const{sizePopupArrow:t,borderRadiusXS:n,borderRadiusOuter:r}=e,i=t/2,a=0,s=i,o=r*1/Math.sqrt(2),u=i-r*(1-1/Math.sqrt(2)),c=i-n*(1/Math.sqrt(2)),f=r*(Math.sqrt(2)-1)+n*(1/Math.sqrt(2)),l=2*i-c,p=f,y=2*i-o,g=u,h=2*i-a,v=s,b=i*Math.sqrt(2)+r*(Math.sqrt(2)-2),m=r*(Math.sqrt(2)-1),w=`polygon(${m}px 100%, 50% ${m}px, ${2*i-m}px 100%, ${m}px 100%)`,P=`path('M ${a} ${s} A ${r} ${r} 0 0 0 ${o} ${u} L ${c} ${f} A ${n} ${n} 0 0 1 ${l} ${p} L ${y} ${g} A ${r} ${r} 0 0 0 ${h} ${v} Z')`;return{arrowShadowWidth:b,arrowPath:P,arrowPolygon:w}}const xg=(e,t,n)=>{const{sizePopupArrow:r,arrowPolygon:i,arrowPath:a,arrowShadowWidth:s,borderRadiusXS:o,calc:u}=e;return{pointerEvents:"none",width:r,height:r,overflow:"hidden","&::before":{position:"absolute",bottom:0,insetInlineStart:0,width:r,height:u(r).div(2).equal(),background:t,clipPath:{_multi_value_:!0,value:[i,a]},content:'""'},"&::after":{content:'""',position:"absolute",width:s,height:s,bottom:0,insetInline:0,margin:"auto",borderRadius:{_skip_check_:!0,value:`0 0 ${Nn(o)} 0`},transform:"translateY(50%) rotate(-135deg)",boxShadow:n,zIndex:0,background:"transparent"}}},Do=8;function Oo(e){const{contentRadius:t,limitVerticalRadius:n}=e,r=t>12?t+2:12;return{arrowOffsetHorizontal:r,arrowOffsetVertical:n?Do:r}}function mr(e,t){return e?t:{}}function wg(e,t,n){const{componentCls:r,boxShadowPopoverArrow:i,arrowOffsetVertical:a,arrowOffsetHorizontal:s}=e,{arrowDistance:o=0,arrowPlacement:u={left:!0,right:!0,top:!0,bottom:!0}}=n||{};return{[r]:Object.assign(Object.assign(Object.assign(Object.assign({[`${r}-arrow`]:[Object.assign(Object.assign({position:"absolute",zIndex:1,display:"block"},xg(e,t,i)),{"&:before":{background:t}})]},mr(!!u.top,{[[`&-placement-top > ${r}-arrow`,`&-placement-topLeft > ${r}-arrow`,`&-placement-topRight > ${r}-arrow`].join(",")]:{bottom:o,transform:"translateY(100%) rotate(180deg)"},[`&-placement-top > ${r}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(100%) rotate(180deg)"},"&-placement-topLeft":{"--arrow-offset-horizontal":s,[`> ${r}-arrow`]:{left:{_skip_check_:!0,value:s}}},"&-placement-topRight":{"--arrow-offset-horizontal":`calc(100% - ${Nn(s)})`,[`> ${r}-arrow`]:{right:{_skip_check_:!0,value:s}}}})),mr(!!u.bottom,{[[`&-placement-bottom > ${r}-arrow`,`&-placement-bottomLeft > ${r}-arrow`,`&-placement-bottomRight > ${r}-arrow`].join(",")]:{top:o,transform:"translateY(-100%)"},[`&-placement-bottom > ${r}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(-100%)"},"&-placement-bottomLeft":{"--arrow-offset-horizontal":s,[`> ${r}-arrow`]:{left:{_skip_check_:!0,value:s}}},"&-placement-bottomRight":{"--arrow-offset-horizontal":`calc(100% - ${Nn(s)})`,[`> ${r}-arrow`]:{right:{_skip_check_:!0,value:s}}}})),mr(!!u.left,{[[`&-placement-left > ${r}-arrow`,`&-placement-leftTop > ${r}-arrow`,`&-placement-leftBottom > ${r}-arrow`].join(",")]:{right:{_skip_check_:!0,value:o},transform:"translateX(100%) rotate(90deg)"},[`&-placement-left > ${r}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(100%) rotate(90deg)"},[`&-placement-leftTop > ${r}-arrow`]:{top:a},[`&-placement-leftBottom > ${r}-arrow`]:{bottom:a}})),mr(!!u.right,{[[`&-placement-right > ${r}-arrow`,`&-placement-rightTop > ${r}-arrow`,`&-placement-rightBottom > ${r}-arrow`].join(",")]:{left:{_skip_check_:!0,value:o},transform:"translateX(-100%) rotate(-90deg)"},[`&-placement-right > ${r}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"},[`&-placement-rightTop > ${r}-arrow`]:{top:a},[`&-placement-rightBottom > ${r}-arrow`]:{bottom:a}}))}}function bg(e,t,n,r){if(r===!1)return{adjustX:!1,adjustY:!1};const i=r&&typeof r=="object"?r:{},a={};switch(e){case"top":case"bottom":a.shiftX=t.arrowOffsetHorizontal*2+n,a.shiftY=!0,a.adjustY=!0;break;case"left":case"right":a.shiftY=t.arrowOffsetVertical*2+n,a.shiftX=!0,a.adjustX=!0;break}const s=Object.assign(Object.assign({},a),i);return s.shiftX||(s.adjustX=!0),s.shiftY||(s.adjustY=!0),s}const ys={left:{points:["cr","cl"]},right:{points:["cl","cr"]},top:{points:["bc","tc"]},bottom:{points:["tc","bc"]},topLeft:{points:["bl","tl"]},leftTop:{points:["tr","tl"]},topRight:{points:["br","tr"]},rightTop:{points:["tl","tr"]},bottomRight:{points:["tr","br"]},rightBottom:{points:["bl","br"]},bottomLeft:{points:["tl","bl"]},leftBottom:{points:["br","bl"]}},Cg={topLeft:{points:["bl","tc"]},leftTop:{points:["tr","cl"]},topRight:{points:["br","tc"]},rightTop:{points:["tl","cr"]},bottomRight:{points:["tr","bc"]},rightBottom:{points:["bl","cr"]},bottomLeft:{points:["tl","bc"]},leftBottom:{points:["br","cl"]}},Pg=new Set(["topLeft","topRight","bottomLeft","bottomRight","leftTop","leftBottom","rightTop","rightBottom"]);function Lg(e){const{arrowWidth:t,autoAdjustOverflow:n,arrowPointAtCenter:r,offset:i,borderRadius:a,visibleFirst:s}=e,o=t/2,u={};return Object.keys(ys).forEach(c=>{const f=r&&Cg[c]||ys[c],l=Object.assign(Object.assign({},f),{offset:[0,0],dynamicInset:!0});switch(u[c]=l,Pg.has(c)&&(l.autoArrow=!1),c){case"top":case"topLeft":case"topRight":l.offset[1]=-o-i;break;case"bottom":case"bottomLeft":case"bottomRight":l.offset[1]=o+i;break;case"left":case"leftTop":case"leftBottom":l.offset[0]=-o-i;break;case"right":case"rightTop":case"rightBottom":l.offset[0]=o+i;break}const p=Oo({contentRadius:a,limitVerticalRadius:!0});if(r)switch(c){case"topLeft":case"bottomLeft":l.offset[0]=-p.arrowOffsetHorizontal-o;break;case"topRight":case"bottomRight":l.offset[0]=p.arrowOffsetHorizontal+o;break;case"leftTop":case"rightTop":l.offset[1]=-p.arrowOffsetHorizontal*2+o;break;case"leftBottom":case"rightBottom":l.offset[1]=p.arrowOffsetHorizontal*2-o;break}l.overflow=bg(c,p,t,n),s&&(l.htmlRegion="visibleFirst")}),u}const Eg=e=>{const{calc:t,componentCls:n,tooltipMaxWidth:r,tooltipColor:i,tooltipBg:a,tooltipBorderRadius:s,zIndexPopup:o,controlHeight:u,boxShadowSecondary:c,paddingSM:f,paddingXS:l,arrowOffsetHorizontal:p,sizePopupArrow:y}=e,g=t(s).add(y).add(p).equal(),h=t(s).mul(2).add(y).equal();return[{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},dd(e)),{position:"absolute",zIndex:o,display:"block",width:"max-content",maxWidth:r,visibility:"visible","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"&-hidden":{display:"none"},"--antd-arrow-background-color":a,[`${n}-inner`]:{minWidth:h,minHeight:u,padding:`${Nn(e.calc(f).div(2).equal())} ${Nn(l)}`,color:i,textAlign:"start",textDecoration:"none",wordWrap:"break-word",backgroundColor:a,borderRadius:s,boxShadow:c,boxSizing:"border-box"},[["&-placement-topLeft","&-placement-topRight","&-placement-bottomLeft","&-placement-bottomRight"].join(",")]:{minWidth:g},[["&-placement-left","&-placement-leftTop","&-placement-leftBottom","&-placement-right","&-placement-rightTop","&-placement-rightBottom"].join(",")]:{[`${n}-inner`]:{borderRadius:e.min(s,Do)}},[`${n}-content`]:{position:"relative"}}),xf(e,(v,b)=>{let{darkColor:m}=b;return{[`&${n}-${v}`]:{[`${n}-inner`]:{backgroundColor:m},[`${n}-arrow`]:{"--antd-arrow-background-color":m}}}})),{"&-rtl":{direction:"rtl"}})},wg(e,"var(--antd-arrow-background-color)"),{[`${n}-pure`]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow}}]},Tg=e=>Object.assign(Object.assign({zIndexPopup:e.zIndexPopupBase+70},Oo({contentRadius:e.borderRadius,limitVerticalRadius:!0})),yg(oa(e,{borderRadiusOuter:Math.min(e.borderRadiusOuter,4)}))),Vo=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Us("Tooltip",r=>{const{borderRadius:i,colorTextLightSolid:a,colorBgSpotlight:s}=r,o=oa(r,{tooltipMaxWidth:250,tooltipColor:a,tooltipBorderRadius:i,tooltipBg:s});return[Eg(o),Yf(r,"zoom-big-fast")]},Tg,{resetStyle:!1,injectStyle:t})(e)},Fg=Or.map(e=>`${e}-inverse`);function Ig(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?[].concat($(Fg),$(Or)).includes(e):Or.includes(e)}function No(e,t){const n=Ig(t),r=Fe({[`${e}-${t}`]:t&&n}),i={},a={};return t&&!n&&(i.background=t,a["--antd-arrow-background-color"]=t),{className:r,overlayStyle:i,arrowStyle:a}}const jg=e=>{const{prefixCls:t,className:n,placement:r="top",title:i,color:a,overlayInnerStyle:s}=e,{getPrefixCls:o}=x.useContext(Hs),u=o("tooltip",t),[c,f,l]=Vo(u),p=No(u,a),y=p.arrowStyle,g=Object.assign(Object.assign({},s),p.overlayStyle),h=Fe(f,l,u,`${u}-pure`,`${u}-placement-${r}`,n,p.className);return c(x.createElement("div",{className:h,style:y},x.createElement("div",{className:`${u}-arrow`}),x.createElement(ko,Object.assign({},e,{className:f,prefixCls:u,overlayInnerStyle:g}),i)))};var Mg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const Rg=x.forwardRef((e,t)=>{var n,r;const{prefixCls:i,openClassName:a,getTooltipContainer:s,color:o,overlayInnerStyle:u,children:c,afterOpenChange:f,afterVisibleChange:l,destroyTooltipOnHide:p,arrow:y=!0,title:g,overlay:h,builtinPlacements:v,arrowPointAtCenter:b=!1,autoAdjustOverflow:m=!0,motion:w,getPopupContainer:P,placement:E="top",mouseEnterDelay:L=.1,mouseLeaveDelay:C=.1,overlayStyle:j,rootClassName:T,overlayClassName:F,styles:M,classNames:k}=e,V=Mg(e,["prefixCls","openClassName","getTooltipContainer","color","overlayInnerStyle","children","afterOpenChange","afterVisibleChange","destroyTooltipOnHide","arrow","title","overlay","builtinPlacements","arrowPointAtCenter","autoAdjustOverflow","motion","getPopupContainer","placement","mouseEnterDelay","mouseLeaveDelay","overlayStyle","rootClassName","overlayClassName","styles","classNames"]),A=!!y,[,G]=cd(),{getPopupContainer:W,getPrefixCls:U,direction:J,className:S,style:z,classNames:pe,styles:ie}=fd("tooltip"),Z=ld(),_=x.useRef(null),q=()=>{var le;(le=_.current)===null||le===void 0||le.forceAlign()};x.useImperativeHandle(t,()=>{var le,Ee;return{forceAlign:q,forcePopupAlign:()=>{Z.deprecated(!1,"forcePopupAlign","forceAlign"),q()},nativeElement:(le=_.current)===null||le===void 0?void 0:le.nativeElement,popupElement:(Ee=_.current)===null||Ee===void 0?void 0:Ee.popupElement}});const[Pe,Re]=yf(!1,{value:(n=e.open)!==null&&n!==void 0?n:e.visible,defaultValue:(r=e.defaultOpen)!==null&&r!==void 0?r:e.defaultVisible}),ke=!g&&!h&&g!==0,Ie=le=>{var Ee,ve;Re(ke?!1:le),ke||((Ee=e.onOpenChange)===null||Ee===void 0||Ee.call(e,le),(ve=e.onVisibleChange)===null||ve===void 0||ve.call(e,le))},nt=x.useMemo(()=>{var le,Ee;let ve=b;return typeof y=="object"&&(ve=(Ee=(le=y.pointAtCenter)!==null&&le!==void 0?le:y.arrowPointAtCenter)!==null&&Ee!==void 0?Ee:b),v||Lg({arrowPointAtCenter:ve,autoAdjustOverflow:m,arrowWidth:A?G.sizePopupArrow:0,borderRadius:G.borderRadius,offset:G.marginXXS,visibleFirst:!0})},[b,y,v,G]),Ze=x.useMemo(()=>g===0?g:h||g||"",[h,g]),De=x.createElement(Ql,{space:!0},typeof Ze=="function"?Ze():Ze),me=U("tooltip",i),Oe=U(),Le=e["data-popover-inject"];let gt=Pe;!("open"in e)&&!("visible"in e)&&ke&&(gt=!1);const Be=x.isValidElement(c)&&!wf(c)?c:x.createElement("span",null,c),ye=Be.props,$e=!ye.className||typeof ye.className=="string"?Fe(ye.className,a||`${me}-open`):ye.className,[ht,xe,mn]=Vo(me,!Le),Q=No(me,o),Zt=Q.arrowStyle,pt=Fe(F,{[`${me}-rtl`]:J==="rtl"},Q.className,T,xe,mn,S,pe.root,k==null?void 0:k.root),we=Fe(pe.body,k==null?void 0:k.body),[rt,Xe]=gd("Tooltip",V.zIndex),yn=x.createElement(mg,Object.assign({},V,{zIndex:rt,showArrow:A,placement:E,mouseEnterDelay:L,mouseLeaveDelay:C,prefixCls:me,classNames:{root:pt,body:we},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zt),ie.root),z),j),M==null?void 0:M.root),body:Object.assign(Object.assign(Object.assign(Object.assign({},ie.body),u),M==null?void 0:M.body),Q.overlayStyle)},getTooltipContainer:P||s||W,ref:_,builtinPlacements:nt,overlay:De,visible:gt,onVisibleChange:Ie,afterVisibleChange:f??l,arrowContent:x.createElement("span",{className:`${me}-arrow-content`}),motion:{motionName:Lf(Oe,"zoom-big-fast",e.transitionName),motionDeadline:1e3},destroyTooltipOnHide:!!p}),gt?Cf(Be,{className:$e}):Be);return ht(x.createElement(hd.Provider,{value:Xe},yn))}),kg=Rg;kg._InternalPanelDoNotUseOrYouWillBeFired=jg;const Dg=O(({textLayer:e,localStore:t})=>{var n;return d.jsx("div",{className:"TextLayerView",style:{position:"absolute",left:e.left,top:e.top,width:e.width,height:e.height,transform:`rotate(${e.rotate}deg)`},children:d.jsx("div",{style:{position:"relative",height:"100%",width:"100%"},children:d.jsx("div",{style:{display:e.id===((n=t.textLayerUnderEditing)==null?void 0:n.id)?"none":"",...pd(e)},children:d.jsx("div",{children:e.textData.characters})})})})});Ao.defaultProps={style:{}};function Ao({style:e}){return d.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",...e},children:d.jsx("img",{src:"",alt:"",style:{objectFit:"cover",width:"100%",height:"100%"}})})}const Og=O(Ao);function _o({children:e,vShow:t,vIf:n,style:r,className:i}){return n===!1?null:d.jsx("div",{style:{...r,display:t?(r==null?void 0:r.display)||"":"none"},className:i,children:n?e:null})}_o.defaultProps={vShow:!0,vIf:!0,style:{},className:""};const Ut=O(_o),Bo=O(({layer:e,pointList:t,isForToolsContainer:n,onClick:r})=>{const i=a=>{let{x:s}=a,{y:o}=a;return n===!1&&(s-=e.left,o-=e.top),`${s},${o}`};return d.jsx("polygon",{points:t.map(a=>i(a)).join(" "),style:{fill:"lime",stroke:"purple",strokeWidth:1,opacity:0},onClick:r})}),xs=async e=>new Promise(t=>{if(!e){t(void 0);return}const n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=()=>{t(n)},n.src=e});function Vg({localStore:e,layer:t,canvasElement:n}){const{libra:r}=e;if(r&&t.image){const i=r.fileData.assetMap.getAsset(t.image.imageSource);if(i&&i.arrayBuffer){const a=n.getContext("2d"),s=window.URL.createObjectURL(new Blob([i.arrayBuffer])),o=new Image;o.src=s,o.onload=()=>{a==null||a.clearRect(0,0,n.width,n.height),a==null||a.drawImage(o,0,0),window.URL.revokeObjectURL(s)}}}}const $o=O(({localStore:e,layer:t})=>{var s;const n=x.useRef(null),r=Ke(()=>({index:0}));function i(o,u){if(t.image){const{naturalWidth:c,naturalHeight:f}=t.image;if(n.current){const l=n.current.getContext("2d");if(l){if(l.globalCompositeOperation="source-over",l.clearRect(0,0,c,f),u){l.beginPath();const p=md({width:u.naturalWidth,height:u.naturalHeight},{width:c,height:f});l.drawImage(u,(c-p.width)/2,(f-p.height)/2,p.width,p.height),l.globalCompositeOperation="source-in"}l.drawImage(o,0,0,c,f)}}}}function a(){const o=r.index+1;if(r.index=o,t.image){const{imageSource:u}=t.image;if(u){if(e.libra){n.current&&Vg({localStore:e,layer:t,canvasElement:n.current});return}t.nodeType==="IMAGE"&&Promise.all([Ua(u)?Promise.resolve(Ua(u)):xs(u),xs(t.extra.mattingMask.maskURL)]).then(([c,f])=>{o<r.index||c&&i(c,f)})}}}return x.useEffect(()=>{a()},[]),x.useEffect(()=>{a()},[(s=t.image)==null?void 0:s.imageSource]),t.image?d.jsx("canvas",{ref:n,id:vd(t.id),width:t.image.naturalWidth,height:t.image.naturalHeight,style:{width:t.image.width,height:t.image.height,opacity:1,userSelect:"none",display:"block",transitionDuration:e.layerImageHasTransition?"300ms":""}}):null}),Ng=O(({layer:e,localStore:t})=>e.image?d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:`rotate(${e.image.rotate}deg)`},children:d.jsx("div",{className:"layer-image-canvas-container",style:{position:"absolute",width:e.image.width,height:e.image.height,transform:`translate3d(-${e.image.width/2}px, -${e.image.height/2}px, 0)`,transitionDuration:t.layerImageHasTransition?"300ms":""},children:d.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",transform:`translate3d(${e.image.imageX}px, ${e.image.imageY}px, 0) scale(${e.image.flipH?"-1":"1"},${e.image.flipV?"-1":"1"})`,transitionDuration:t.layerImageHasTransition?"300ms":""},children:d.jsx($o,{localStore:t,layer:e})})})}):null),zo=O(({container:e,pointList:t,borderRadiusPercent:n,localStore:r})=>{var a;const i={};return e.nodeType==="IMAGE"&&e.extra.shapeMask.maskURL&&(i.WebkitMaskImage=`url(${e.extra.shapeMask.maskURL})`,i.WebkitMaskSize="contain",i.WebkitMaskRepeat="no-repeat",i.WebkitMaskPosition="center",i.border="3px solid transparent"),d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"ImageLayerContent",style:{position:"absolute",width:e.width,height:e.height,left:0,top:0,boxSizing:"border-box",overflow:"hidden",userSelect:"none",transform:"rotate(0deg)",borderRadius:`${Ks(e,n)}px`,clipPath:t&&t.length>0?`url(#${Oa(e)})`:void 0},children:[t?d.jsx("svg",{style:{position:"absolute",left:0,top:0},height:e.height,width:e.width,children:d.jsx("defs",{children:d.jsx("clipPath",{id:Oa(e),children:d.jsx(Bo,{isForToolsContainer:!1,layer:e,pointList:t})})})}):null,e.image&&e.image.imageSource?d.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",opacity:((a=e.image)==null?void 0:a.opacity)||0,...i},children:[d.jsx("div",{style:{position:"absolute",left:0,top:0,userSelect:"none"}}),d.jsx(Ng,{layer:e,localStore:r})]}):d.jsx("div",{style:{width:"100%",height:"100%"}}),d.jsx(Ut,{vIf:e.nodeType==="IMAGE"&&!e.image&&ta(e),children:d.jsx(Og,{style:{...i}})})]}),e.nodeType==="IMAGE"&&e.extra&&e.extra.sourceList?e.extra.sourceList.map(s=>d.jsx("img",{src:s.url,alt:"",style:{position:"absolute",left:s.left,top:s.top,width:s.width,height:s.height}},s.id)):""]})}),qi=O(({container:e,pointList:t,borderRadiusPercent:n,localStore:r,style:i})=>{var a;return d.jsx("div",{className:"ImageLayerView",style:{display:e.id===((a=r.layerUnderCropping)==null?void 0:a.id)?"none":"",position:"absolute",width:e.width,height:e.height,left:e.left,top:e.top,transform:`rotate(${e.rotate||0}deg)`,boxSizing:"border-box",userSelect:"none",...i},children:d.jsx(zo,{localStore:r,container:e,borderRadiusPercent:n,pointList:t})})}),Ag=O(({layer:e,localStore:t,style:n})=>d.jsx("div",{className:"SVGLayerView",style:{position:"absolute",width:e.width,height:e.height,left:e.left,top:e.top,transform:`rotate(${e.rotate||0}deg)`,boxSizing:"border-box",userSelect:"none",...n},children:d.jsxs("svg",{width:e.width,height:e.height,viewBox:`0 0 ${e.width} ${e.height}`,children:[d.jsx("defs",{children:d.jsx("marker",{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"0",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:d.jsx("path",{d:"M0,0 L0,6 L10,3 z",fill:e.stroke})})}),e.data.type==="line"?d.jsx("line",{x1:e.data.p1.x,y1:e.data.p1.y,x2:e.data.p2.x-10*e.strokeWidth,y2:e.data.p2.y,stroke:e.stroke,strokeWidth:e.strokeWidth,markerEnd:e.data.markerEnd?`url(#${e.data.markerEnd})`:""}):null,e.data.type==="rect"?d.jsx("rect",{width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill}):null]})}));var Wo={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},ga={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},_g=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Nr={CSS:{},springs:{}};function dt(e,t,n){return Math.min(Math.max(e,t),n)}function Dn(e,t){return e.indexOf(t)>-1}function Pi(e,t){return e.apply(null,t)}var N={arr:function(e){return Array.isArray(e)},obj:function(e){return Dn(Object.prototype.toString.call(e),"Object")},pth:function(e){return N.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||N.svg(e)},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},nil:function(e){return N.und(e)||e===null},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return N.hex(e)||N.rgb(e)||N.hsl(e)},key:function(e){return!Wo.hasOwnProperty(e)&&!ga.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function Uo(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(n){return parseFloat(n)}):[]}function Ho(e,t){var n=Uo(e),r=dt(N.und(n[0])?1:n[0],.1,100),i=dt(N.und(n[1])?100:n[1],.1,100),a=dt(N.und(n[2])?10:n[2],.1,100),s=dt(N.und(n[3])?0:n[3],.1,100),o=Math.sqrt(i/r),u=a/(2*Math.sqrt(i*r)),c=u<1?o*Math.sqrt(1-u*u):0,f=1,l=u<1?(u*o+-s)/c:-s+o;function p(g){var h=t?t*g/1e3:g;return u<1?h=Math.exp(-h*u*o)*(f*Math.cos(c*h)+l*Math.sin(c*h)):h=(f+l*h)*Math.exp(-h*o),g===0||g===1?g:1-h}function y(){var g=Nr.springs[e];if(g)return g;for(var h=1/6,v=0,b=0;;)if(v+=h,p(v)===1){if(b++,b>=16)break}else b=0;var m=v*h*1e3;return Nr.springs[e]=m,m}return t?p:y}function Bg(e){return e===void 0&&(e=10),function(t){return Math.ceil(dt(t,1e-6,1)*e)*(1/e)}}var $g=function(){var e=11,t=1/(e-1);function n(f,l){return 1-3*l+3*f}function r(f,l){return 3*l-6*f}function i(f){return 3*f}function a(f,l,p){return((n(l,p)*f+r(l,p))*f+i(l))*f}function s(f,l,p){return 3*n(l,p)*f*f+2*r(l,p)*f+i(l)}function o(f,l,p,y,g){var h,v,b=0;do v=l+(p-l)/2,h=a(v,y,g)-f,h>0?p=v:l=v;while(Math.abs(h)>1e-7&&++b<10);return v}function u(f,l,p,y){for(var g=0;g<4;++g){var h=s(l,p,y);if(h===0)return l;var v=a(l,p,y)-f;l-=v/h}return l}function c(f,l,p,y){if(!(0<=f&&f<=1&&0<=p&&p<=1))return;var g=new Float32Array(e);if(f!==l||p!==y)for(var h=0;h<e;++h)g[h]=a(h*t,f,p);function v(b){for(var m=0,w=1,P=e-1;w!==P&&g[w]<=b;++w)m+=t;--w;var E=(b-g[w])/(g[w+1]-g[w]),L=m+E*t,C=s(L,f,p);return C>=.001?u(b,L,f,p):C===0?L:o(b,m,m+t,f,p)}return function(b){return f===l&&p===y||b===0||b===1?b:a(v(b),l,y)}}return c}(),Go=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Expo:function(){return function(r){return r?Math.pow(2,10*r-10):0}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var i,a=4;r<((i=Math.pow(2,--a))-1)/11;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((i*3-2)/22-r,2)}},Elastic:function(r,i){r===void 0&&(r=1),i===void 0&&(i=.5);var a=dt(r,1,10),s=dt(i,.1,2);return function(o){return o===0||o===1?o:-a*Math.pow(2,10*(o-1))*Math.sin((o-1-s/(Math.PI*2)*Math.asin(1/a))*(Math.PI*2)/s)}}},n=["Quad","Cubic","Quart","Quint"];return n.forEach(function(r,i){t[r]=function(){return function(a){return Math.pow(a,i+2)}}}),Object.keys(t).forEach(function(r){var i=t[r];e["easeIn"+r]=i,e["easeOut"+r]=function(a,s){return function(o){return 1-i(a,s)(1-o)}},e["easeInOut"+r]=function(a,s){return function(o){return o<.5?i(a,s)(o*2)/2:1-i(a,s)(o*-2+2)/2}},e["easeOutIn"+r]=function(a,s){return function(o){return o<.5?(1-i(a,s)(1-o*2))/2:(i(a,s)(o*2-1)+1)/2}}}),e}();function ha(e,t){if(N.fnc(e))return e;var n=e.split("(")[0],r=Go[n],i=Uo(e);switch(n){case"spring":return Ho(e,t);case"cubicBezier":return Pi($g,i);case"steps":return Pi(Bg,i);default:return Pi(r,i)}}function qo(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function Wr(e,t){for(var n=e.length,r=arguments.length>=2?arguments[1]:void 0,i=[],a=0;a<n;a++)if(a in e){var s=e[a];t.call(r,s,a,e)&&i.push(s)}return i}function Ur(e){return e.reduce(function(t,n){return t.concat(N.arr(n)?Ur(n):n)},[])}function ws(e){return N.arr(e)?e:(N.str(e)&&(e=qo(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function pa(e,t){return e.some(function(n){return n===t})}function va(e){var t={};for(var n in e)t[n]=e[n];return t}function Yi(e,t){var n=va(e);for(var r in e)n[r]=t.hasOwnProperty(r)?t[r]:e[r];return n}function Hr(e,t){var n=va(e);for(var r in t)n[r]=N.und(e[r])?t[r]:e[r];return n}function zg(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function Wg(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n=e.replace(t,function(o,u,c,f){return u+u+c+c+f+f}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),i=parseInt(r[1],16),a=parseInt(r[2],16),s=parseInt(r[3],16);return"rgba("+i+","+a+","+s+",1)"}function Ug(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),n=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100,a=t[4]||1;function s(p,y,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?p+(y-p)*6*g:g<1/2?y:g<2/3?p+(y-p)*(2/3-g)*6:p}var o,u,c;if(r==0)o=u=c=i;else{var f=i<.5?i*(1+r):i+r-i*r,l=2*i-f;o=s(l,f,n+1/3),u=s(l,f,n),c=s(l,f,n-1/3)}return"rgba("+o*255+","+u*255+","+c*255+","+a+")"}function Hg(e){if(N.rgb(e))return zg(e);if(N.hex(e))return Wg(e);if(N.hsl(e))return Ug(e)}function wt(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function Gg(e){if(Dn(e,"translate")||e==="perspective")return"px";if(Dn(e,"rotate")||Dn(e,"skew"))return"deg"}function Ki(e,t){return N.fnc(e)?e(t.target,t.id,t.total):e}function ct(e,t){return e.getAttribute(t)}function ma(e,t,n){var r=wt(t);if(pa([n,"deg","rad","turn"],r))return t;var i=Nr.CSS[t+n];if(!N.und(i))return i;var a=100,s=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(s),s.style.position="absolute",s.style.width=a+n;var u=a/s.offsetWidth;o.removeChild(s);var c=u*parseFloat(t);return Nr.CSS[t+n]=c,c}function Yo(e,t,n){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return n?ma(e,i,n):i}}function ya(e,t){if(N.dom(e)&&!N.inp(e)&&(!N.nil(ct(e,t))||N.svg(e)&&e[t]))return"attribute";if(N.dom(e)&&pa(_g,t))return"transform";if(N.dom(e)&&t!=="transform"&&Yo(e,t))return"css";if(e[t]!=null)return"object"}function Ko(e){if(N.dom(e)){for(var t=e.style.transform||"",n=/(\w+)\(([^)]*)\)/g,r=new Map,i;i=n.exec(t);)r.set(i[1],i[2]);return r}}function qg(e,t,n,r){var i=Dn(t,"scale")?1:0+Gg(t),a=Ko(e).get(t)||i;return n&&(n.transforms.list.set(t,a),n.transforms.last=t),r?ma(e,a,r):a}function xa(e,t,n,r){switch(ya(e,t)){case"transform":return qg(e,t,r,n);case"css":return Yo(e,t,n);case"attribute":return ct(e,t);default:return e[t]||0}}function wa(e,t){var n=/^(\*=|\+=|-=)/.exec(e);if(!n)return e;var r=wt(e)||0,i=parseFloat(t),a=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return i+a+r;case"-":return i-a+r;case"*":return i*a+r}}function Zo(e,t){if(N.col(e))return Hg(e);if(/\s/g.test(e))return e;var n=wt(e),r=n?e.substr(0,e.length-n.length):e;return t?r+t:r}function ba(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Yg(e){return Math.PI*2*ct(e,"r")}function Kg(e){return ct(e,"width")*2+ct(e,"height")*2}function Zg(e){return ba({x:ct(e,"x1"),y:ct(e,"y1")},{x:ct(e,"x2"),y:ct(e,"y2")})}function Xo(e){for(var t=e.points,n=0,r,i=0;i<t.numberOfItems;i++){var a=t.getItem(i);i>0&&(n+=ba(r,a)),r=a}return n}function Xg(e){var t=e.points;return Xo(e)+ba(t.getItem(t.numberOfItems-1),t.getItem(0))}function Jo(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return Yg(e);case"rect":return Kg(e);case"line":return Zg(e);case"polyline":return Xo(e);case"polygon":return Xg(e)}}function Jg(e){var t=Jo(e);return e.setAttribute("stroke-dasharray",t),t}function Qg(e){for(var t=e.parentNode;N.svg(t)&&N.svg(t.parentNode);)t=t.parentNode;return t}function Qo(e,t){var n=t||{},r=n.el||Qg(e),i=r.getBoundingClientRect(),a=ct(r,"viewBox"),s=i.width,o=i.height,u=n.viewBox||(a?a.split(" "):[0,0,s,o]);return{el:r,viewBox:u,x:u[0]/1,y:u[1]/1,w:s,h:o,vW:u[2],vH:u[3]}}function Sg(e,t){var n=N.str(e)?qo(e)[0]:e,r=t||100;return function(i){return{property:i,el:n,svg:Qo(n),totalLength:Jo(n)*(r/100)}}}function eh(e,t,n){function r(f){f===void 0&&(f=0);var l=t+f>=1?t+f:0;return e.el.getPointAtLength(l)}var i=Qo(e.el,e.svg),a=r(),s=r(-1),o=r(1),u=n?1:i.w/i.vW,c=n?1:i.h/i.vH;switch(e.property){case"x":return(a.x-i.x)*u;case"y":return(a.y-i.y)*c;case"angle":return Math.atan2(o.y-s.y,o.x-s.x)*180/Math.PI}}function bs(e,t){var n=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Zo(N.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(n)?r.match(n).map(Number):[0],strings:N.str(e)||t?r.split(n):[]}}function Ca(e){var t=e?Ur(N.arr(e)?e.map(ws):ws(e)):[];return Wr(t,function(n,r,i){return i.indexOf(n)===r})}function So(e){var t=Ca(e);return t.map(function(n,r){return{target:n,id:r,total:t.length,transforms:{list:Ko(n)}}})}function th(e,t){var n=va(t);if(/^spring/.test(n.easing)&&(n.duration=Ho(n.easing)),N.arr(e)){var r=e.length,i=r===2&&!N.obj(e[0]);i?e={value:e}:N.fnc(t.duration)||(n.duration=t.duration/r)}var a=N.arr(e)?e:[e];return a.map(function(s,o){var u=N.obj(s)&&!N.pth(s)?s:{value:s};return N.und(u.delay)&&(u.delay=o?0:t.delay),N.und(u.endDelay)&&(u.endDelay=o===a.length-1?t.endDelay:0),u}).map(function(s){return Hr(s,n)})}function nh(e){for(var t=Wr(Ur(e.map(function(a){return Object.keys(a)})),function(a){return N.key(a)}).reduce(function(a,s){return a.indexOf(s)<0&&a.push(s),a},[]),n={},r=function(a){var s=t[a];n[s]=e.map(function(o){var u={};for(var c in o)N.key(c)?c==s&&(u.value=o[c]):u[c]=o[c];return u})},i=0;i<t.length;i++)r(i);return n}function rh(e,t){var n=[],r=t.keyframes;r&&(t=Hr(nh(r),t));for(var i in t)N.key(i)&&n.push({name:i,tweens:th(t[i],e)});return n}function ih(e,t){var n={};for(var r in e){var i=Ki(e[r],t);N.arr(i)&&(i=i.map(function(a){return Ki(a,t)}),i.length===1&&(i=i[0])),n[r]=i}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}function ah(e,t){var n;return e.tweens.map(function(r){var i=ih(r,t),a=i.value,s=N.arr(a)?a[1]:a,o=wt(s),u=xa(t.target,e.name,o,t),c=n?n.to.original:u,f=N.arr(a)?a[0]:c,l=wt(f)||wt(u),p=o||l;return N.und(s)&&(s=c),i.from=bs(f,p),i.to=bs(wa(s,f),p),i.start=n?n.end:0,i.end=i.start+i.delay+i.duration+i.endDelay,i.easing=ha(i.easing,i.duration),i.isPath=N.pth(a),i.isPathTargetInsideSVG=i.isPath&&N.svg(t.target),i.isColor=N.col(i.from.original),i.isColor&&(i.round=1),n=i,i})}var eu={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,r,i){if(r.list.set(t,n),t===r.last||i){var a="";r.list.forEach(function(s,o){a+=o+"("+s+") "}),e.style.transform=a}}};function tu(e,t){var n=So(e);n.forEach(function(r){for(var i in t){var a=Ki(t[i],r),s=r.target,o=wt(a),u=xa(s,i,o,r),c=o||wt(u),f=wa(Zo(a,c),u),l=ya(s,i);eu[l](s,i,f,r.transforms,!0)}})}function sh(e,t){var n=ya(e.target,t.name);if(n){var r=ah(t,e),i=r[r.length-1];return{type:n,property:t.name,animatable:e,tweens:r,duration:i.end,delay:r[0].delay,endDelay:i.endDelay}}}function oh(e,t){return Wr(Ur(e.map(function(n){return t.map(function(r){return sh(n,r)})})),function(n){return!N.und(n)})}function nu(e,t){var n=e.length,r=function(a){return a.timelineOffset?a.timelineOffset:0},i={};return i.duration=n?Math.max.apply(Math,e.map(function(a){return r(a)+a.duration})):t.duration,i.delay=n?Math.min.apply(Math,e.map(function(a){return r(a)+a.delay})):t.delay,i.endDelay=n?i.duration-Math.max.apply(Math,e.map(function(a){return r(a)+a.duration-a.endDelay})):t.endDelay,i}var Cs=0;function uh(e){var t=Yi(Wo,e),n=Yi(ga,e),r=rh(n,e),i=So(e.targets),a=oh(i,r),s=nu(a,n),o=Cs;return Cs++,Hr(t,{id:o,children:[],animatables:i,animations:a,duration:s.duration,delay:s.delay,endDelay:s.endDelay})}var et=[],ru=function(){var e;function t(){!e&&(!Ps()||!se.suspendWhenDocumentHidden)&&et.length>0&&(e=requestAnimationFrame(n))}function n(i){for(var a=et.length,s=0;s<a;){var o=et[s];o.paused?(et.splice(s,1),a--):(o.tick(i),s++)}e=s>0?requestAnimationFrame(n):void 0}function r(){se.suspendWhenDocumentHidden&&(Ps()?e=cancelAnimationFrame(e):(et.forEach(function(i){return i._onDocumentVisibility()}),ru()))}return typeof document<"u"&&document.addEventListener("visibilitychange",r),t}();function Ps(){return!!document&&document.hidden}function se(e){e===void 0&&(e={});var t=0,n=0,r=0,i,a=0,s=null;function o(m){var w=window.Promise&&new Promise(function(P){return s=P});return m.finished=w,w}var u=uh(e);o(u);function c(){var m=u.direction;m!=="alternate"&&(u.direction=m!=="normal"?"normal":"reverse"),u.reversed=!u.reversed,i.forEach(function(w){return w.reversed=u.reversed})}function f(m){return u.reversed?u.duration-m:m}function l(){t=0,n=f(u.currentTime)*(1/se.speed)}function p(m,w){w&&w.seek(m-w.timelineOffset)}function y(m){if(u.reversePlayback)for(var P=a;P--;)p(m,i[P]);else for(var w=0;w<a;w++)p(m,i[w])}function g(m){for(var w=0,P=u.animations,E=P.length;w<E;){var L=P[w],C=L.animatable,j=L.tweens,T=j.length-1,F=j[T];T&&(F=Wr(j,function(Pe){return m<Pe.end})[0]||F);for(var M=dt(m-F.start-F.delay,0,F.duration)/F.duration,k=isNaN(M)?1:F.easing(M),V=F.to.strings,A=F.round,G=[],W=F.to.numbers.length,U=void 0,J=0;J<W;J++){var S=void 0,z=F.to.numbers[J],pe=F.from.numbers[J]||0;F.isPath?S=eh(F.value,k*z,F.isPathTargetInsideSVG):S=pe+k*(z-pe),A&&(F.isColor&&J>2||(S=Math.round(S*A)/A)),G.push(S)}var ie=V.length;if(!ie)U=G[0];else{U=V[0];for(var Z=0;Z<ie;Z++){V[Z];var _=V[Z+1],q=G[Z];isNaN(q)||(_?U+=q+_:U+=q+" ")}}eu[L.type](C.target,L.property,U,C.transforms),L.currentValue=U,w++}}function h(m){u[m]&&!u.passThrough&&u[m](u)}function v(){u.remaining&&u.remaining!==!0&&u.remaining--}function b(m){var w=u.duration,P=u.delay,E=w-u.endDelay,L=f(m);u.progress=dt(L/w*100,0,100),u.reversePlayback=L<u.currentTime,i&&y(L),!u.began&&u.currentTime>0&&(u.began=!0,h("begin")),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,h("loopBegin")),L<=P&&u.currentTime!==0&&g(0),(L>=E&&u.currentTime!==w||!w)&&g(w),L>P&&L<E?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,h("changeBegin")),h("change"),g(L)):u.changeBegan&&(u.changeCompleted=!0,u.changeBegan=!1,h("changeComplete")),u.currentTime=dt(L,0,w),u.began&&h("update"),m>=w&&(n=0,v(),u.remaining?(t=r,h("loopComplete"),u.loopBegan=!1,u.direction==="alternate"&&c()):(u.paused=!0,u.completed||(u.completed=!0,h("loopComplete"),h("complete"),!u.passThrough&&"Promise"in window&&(s(),o(u)))))}return u.reset=function(){var m=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversePlayback=!1,u.reversed=m==="reverse",u.remaining=u.loop,i=u.children,a=i.length;for(var w=a;w--;)u.children[w].reset();(u.reversed&&u.loop!==!0||m==="alternate"&&u.loop===1)&&u.remaining++,g(u.reversed?u.duration:0)},u._onDocumentVisibility=l,u.set=function(m,w){return tu(m,w),u},u.tick=function(m){r=m,t||(t=r),b((r+(n-t))*se.speed)},u.seek=function(m){b(f(m))},u.pause=function(){u.paused=!0,l()},u.play=function(){u.paused&&(u.completed&&u.reset(),u.paused=!1,et.push(u),l(),ru())},u.reverse=function(){c(),u.completed=!u.reversed,l()},u.restart=function(){u.reset(),u.play()},u.remove=function(m){var w=Ca(m);iu(w,u)},u.reset(),u.autoplay&&u.play(),u}function Ls(e,t){for(var n=t.length;n--;)pa(e,t[n].animatable.target)&&t.splice(n,1)}function iu(e,t){var n=t.animations,r=t.children;Ls(e,n);for(var i=r.length;i--;){var a=r[i],s=a.animations;Ls(e,s),!s.length&&!a.children.length&&r.splice(i,1)}!n.length&&!r.length&&t.pause()}function dh(e){for(var t=Ca(e),n=et.length;n--;){var r=et[n];iu(t,r)}}function ch(e,t){t===void 0&&(t={});var n=t.direction||"normal",r=t.easing?ha(t.easing):null,i=t.grid,a=t.axis,s=t.from||0,o=s==="first",u=s==="center",c=s==="last",f=N.arr(e),l=parseFloat(f?e[0]:e),p=f?parseFloat(e[1]):0,y=wt(f?e[1]:e)||0,g=t.start||0+(f?l:0),h=[],v=0;return function(b,m,w){if(o&&(s=0),u&&(s=(w-1)/2),c&&(s=w-1),!h.length){for(var P=0;P<w;P++){if(!i)h.push(Math.abs(s-P));else{var E=u?(i[0]-1)/2:s%i[0],L=u?(i[1]-1)/2:Math.floor(s/i[0]),C=P%i[0],j=Math.floor(P/i[0]),T=E-C,F=L-j,M=Math.sqrt(T*T+F*F);a==="x"&&(M=-T),a==="y"&&(M=-F),h.push(M)}v=Math.max.apply(Math,h)}r&&(h=h.map(function(V){return r(V/v)*v})),n==="reverse"&&(h=h.map(function(V){return a?V<0?V*-1:-V:Math.abs(v-V)}))}var k=f?(p-l)/v:l;return g+k*(Math.round(h[m]*100)/100)+y}}function fh(e){e===void 0&&(e={});var t=se(e);return t.duration=0,t.add=function(n,r){var i=et.indexOf(t),a=t.children;i>-1&&et.splice(i,1);function s(p){p.passThrough=!0}for(var o=0;o<a.length;o++)s(a[o]);var u=Hr(n,Yi(ga,e));u.targets=u.targets||e.targets;var c=t.duration;u.autoplay=!1,u.direction=t.direction,u.timelineOffset=N.und(r)?c:wa(r,c),s(t),t.seek(u.timelineOffset);var f=se(u);s(f),a.push(f);var l=nu(a,e);return t.delay=l.delay,t.endDelay=l.endDelay,t.duration=l.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}se.version="3.2.1";se.speed=1;se.suspendWhenDocumentHidden=!0;se.running=et;se.remove=dh;se.get=xa;se.set=tu;se.convertPx=ma;se.path=Sg;se.setDashoffset=Jg;se.stagger=ch;se.timeline=fh;se.easing=ha;se.penner=Go;se.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};const yr=O(({layer:e,localStore:t,children:n})=>{const r=x.useRef(null),i=Ke(()=>({dirty:!1,getTl:()=>null,updateAnimations(){if(e.timeline&&r.current){const a=e.timeline.end-e.timeline.start,s=se.timeline({direction:"normal",duration:a,autoplay:!1,easing:"linear",update(o){}});if(e.timeline.entrance&&s.add({targets:r.current,keyframes:yd(e),duration:Math.min(a,500)}),e.timeline.exit){const o=Math.min(a,500);s.add({targets:r.current,keyframes:xd(e),delay:a-o,duration:o})}i.getTl=()=>s}else i.getTl=()=>null}}));return x.useEffect(()=>{var a;i.updateAnimations(),(a=i.getTl())==null||a.seek(0)},[]),x.useEffect(()=>{i.dirty=!0},[e.width,e.height]),x.useEffect(()=>{var a;if(e.timeline&&(i.dirty&&(i.updateAnimations(),i.dirty=!1),t.currentTime>=e.timeline.start&&t.currentTime<=e.timeline.end)){const s=t.currentTime-e.timeline.start;s>0&&((a=i.getTl())==null||a.seek(s))}},[t.currentTime]),d.jsx("div",{style:{position:"absolute",left:0,top:0,display:Zs(t,e)?"":"none",transformOrigin:`${e.left+e.width/2}px ${e.top+e.height/2}px`},ref:r,children:n})}),lh=O(({layer:e,localStore:t,style:n})=>{const r=x.useRef(null);return x.useEffect(()=>{if(e.timeline&&r.current){const i=t.currentTime-e.timeline.start;i>=0&&i<=e.timeline.end-e.timeline.start?(Math.abs(i-r.current.currentTime*1e3)>200&&(console.log("sync"),r.current.currentTime=i/1e3),t.currentStatus==="playingTimeline"?r.current.paused&&r.current.play():r.current.paused===!1&&r.current.pause()):r.current.paused===!1&&r.current.pause()}},[t.currentTime,t.currentStatus]),d.jsx("div",{className:"VideoLayerView",style:{position:"absolute",width:e.width,height:e.height,left:e.left,top:e.top,transform:`rotate(${e.rotate||0}deg)`,boxSizing:"border-box",userSelect:"none",...n},children:d.jsx("video",{src:e.video.url,ref:r,preload:"",style:{width:e.video.width,height:e.video.height,objectFit:"cover"},children:d.jsx("track",{kind:"captions"})})})}),gh=O(({layer:e,localStore:t,pointList:n,style:r})=>e.nodeType==="TEXT"?d.jsx(yr,{localStore:t,layer:e,children:d.jsx(Dg,{localStore:t,textLayer:e},e.id)},e.id):e.nodeType==="IMAGE"?d.jsx(yr,{localStore:t,layer:e,children:d.jsx(qi,{localStore:t,container:e,borderRadiusPercent:0,pointList:n,style:{...r}},e.id)},e.id):e.nodeType==="svg"?d.jsx(yr,{localStore:t,layer:e,children:d.jsx(Ag,{layer:e,localStore:t})},e.id):e.nodeType==="video"?d.jsx(yr,{localStore:t,layer:e,children:d.jsx(lh,{layer:e,localStore:t})},e.id):null);function au({onPointerDown:e,onPointerMove:t,onPointerUp:n,className:r,style:i,children:a}){const[s]=x.useState(()=>typeof window<"u"&&window.ontouchstart!==void 0);return d.jsx("div",{className:r,style:i,onTouchStart:s&&e?o=>{e(Rn(o))}:void 0,onPointerDown:!s&&e?o=>{e(o)}:void 0,onTouchMove:s&&t?o=>{t(Rn(o))}:void 0,onPointerMove:!s&&t?o=>{t(o)}:void 0,onTouchEnd:s&&n?o=>{n(Rn(o))}:void 0,onPointerUp:!s&&n?o=>{n(o)}:void 0,children:a})}au.defaultProps={onPointerDown:void 0,onPointerMove:void 0,onPointerUp:void 0,className:void 0,style:void 0,children:void 0};const Pa=O(au),Cp=O(({localStore:e,className:t,isMainWorkspace:n,children:r})=>{const i=e.getPageScale(),a=x.useRef(null);return x.useEffect(()=>(a.current&&(a.current.onwheel=s=>{s.ctrlKey?(s.preventDefault(),Xs(e,s)):(s.preventDefault(),e.workspaceState.positionLeft-=s.deltaX,e.workspaceState.positionTop-=s.deltaY,a.current&&js(e,a.current))},e.workspaceElement=a.current),()=>{e.workspaceElement=null}),[]),d.jsx("div",{className:`WorkspaceWithoutBounds ${t}`,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},ref:a,children:d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%"},children:d.jsx("div",{className:"page-container-2000",style:{width:e.props.getPageSize().width*i,height:e.props.getPageSize().height*i,transform:"translate(-50%, -50%)",position:"absolute",left:e.workspaceState.positionLeft,top:e.workspaceState.positionTop},children:r})})})}),su=O(({localStore:e,children:t,onDropFilesToWorkspace:n})=>d.jsx("div",{className:"WorkspaceEvents",style:{position:"relative",width:"100%",height:"100%"},onContextMenu:r=>{r.preventDefault()},onPointerDown:r=>{Ic(e,r)},onPointerMove:()=>{},onPointerUp:r=>{e.currentStatus==="draggingLeftImageToPage"?n({source:"webpage",fileList:[]}):e.currentStatus==="pointerDownOnWorkspace"&&Fi(e,r)&&ce(e,{type:"clear"})},onDragEnter:()=>{e.currentStatus="draggingWindowImageToPage",ce(e,{type:"clear"})},onDragLeave:()=>{},onDragOver:r=>{r.preventDefault()},onDrop:r=>{r.preventDefault(),n({source:"system",fileList:r.dataTransfer.files})},children:t}));function Es(){return"WorkspaceViewScrollContainer"}const Pp=O(({localStore:e,hasDefaultPageController:t,pageController:n,navigator:r,children:i,onDropFilesToWorkspace:a})=>{const{workspaceState:s}=e,{current:o}=x.useRef({isLocked:!1}),u=x.useRef(null),c=x.useRef(null),f=Ke(()=>({workspaceWidth:0,workspaceHeight:0,getPageWidth(){return e.props.getPageSize().width},getPageHeight(){return e.props.getPageSize().height},getPageScale(){return e.getPageScale()},getPreviewPageWidth(){return f.getPageWidth()/this.getScale()},getPreviewPageHeight(){return f.getPageHeight()/this.getScale()},getPreviewPageScale(){return 1/f.getPageScale()/this.getScale()},getScale(){return po(e)},getViewportLeft(){return(s.workspaceScrollLeft-e.options.safePadding>0?s.workspaceScrollLeft-e.options.safePadding:0)/this.getPageScale()/this.getScale()},getViewportTop(){return(s.workspaceScrollTop-e.options.safePadding>0?s.workspaceScrollTop-e.options.safePadding:0)/this.getPageScale()/this.getScale()},getViewportWidth(){let g=f.workspaceWidth/this.getPageScale()/this.getScale();return g>this.getPageWidth()/this.getScale()&&(g=this.getPageWidth()/this.getScale()),g},getViewportHeight(){let g=f.workspaceHeight/this.getPageScale()/this.getScale();return g>this.getPageHeight()/this.getScale()&&(g=this.getPageHeight()/this.getScale()),g}}));function l(){const g=u.current,h=c.current;g&&h&&(f.workspaceWidth=Js(g),f.workspaceHeight=Qs(g),s.workspaceScrollLeft=h.scrollLeft,s.workspaceScrollTop=h.scrollTop,document.querySelectorAll(`.${Es()}`).forEach(v=>{v.scrollLeft=h==null?void 0:h.scrollLeft,v.scrollTop=h==null?void 0:h.scrollTop}))}function p(){c.current&&(c.current.onwheel=g=>{if(e.options.canScalePage===!1){g.preventDefault();return}if(g.ctrlKey){const h=g.currentTarget,v=bd(h),b=Cd(h),{safePadding:m}=e.options;g.preventDefault();const w=g.pageX-v,P=g.pageY-b,E=f.getPageScale(),L=Pd(e,g.deltaY,E),C=m+(h.scrollLeft-m+w)/E*L-w,j=m+(h.scrollTop-m+P)/E*L-P;s.pageScale=L,h.scrollLeft=C,h.scrollTop=j,l()}},l())}x.useEffect(()=>{p()},[]),x.useEffect(()=>{l()},[f.getPageWidth(),f.getPageHeight()]),x.useEffect(()=>{setTimeout(()=>{p()},0)},[e.workspaceExists]);function y(){e.options.canScalePage&&Ld({localStore:e,workspaceState:s})}return x.useEffect(()=>{y()},[f.getPageWidth(),f.getPageHeight()]),x.useEffect(()=>(window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),[]),d.jsx("div",{className:wd,ref:u,style:{position:"relative",width:"100%",height:"100%",cursor:e.currentCursor,overflow:"hidden"},children:d.jsxs(su,{localStore:e,onDropFilesToWorkspace:a,children:[d.jsx("div",{ref:c,className:Es(),style:{width:"100%",height:"100%",overflow:"auto"},onClick:()=>{o.isLocked=!o.isLocked},onScroll:()=>{l()},children:d.jsx("div",{style:{display:"table",width:"100%",height:"100%",overflow:"hidden"},children:d.jsx("div",{className:"the-content-table-cell",style:{display:"table-cell",width:"100%",height:"100%",verticalAlign:"middle",position:"relative",overflow:"hidden"},children:d.jsx("div",{style:{background:"",display:"table",margin:"auto",padding:e.options.safePadding,boxSizing:"border-box"},children:i})})})}),t?d.jsxs("div",{style:{position:"absolute",right:60,bottom:16,zIndex:10},children:[d.jsx("div",{style:{position:"relative",height:28,borderRadius:14},children:n}),d.jsx("div",{className:"pageNavigator",style:{position:"absolute",display:s.navigatorShow?"":"none",right:0,bottom:36,width:138,height:104,borderRadius:4,overflow:"hidden",boxSizing:"border-box",border:"1px solid var(--_base--opacity_white_25)"},onPointerDown:g=>{g.stopPropagation()},children:d.jsx("div",{style:{display:"table",width:"100%",height:"100%"},children:d.jsx("div",{style:{display:"table-cell",width:"100%",height:"100%",verticalAlign:"middle"},children:d.jsxs("div",{style:{position:"relative",width:f.getPreviewPageWidth(),height:f.getPreviewPageHeight(),margin:"auto"},children:[d.jsx("div",{style:{transform:`scale(${f.getPreviewPageScale()})`,transformOrigin:"0 0"},children:r}),d.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",left:0,top:0},onPointerMove:g=>{e.currentStatus==="draggingThumbnail"&&c.current&&Uc(e,g,c.current)},children:d.jsx("div",{style:{position:"absolute",left:f.getViewportLeft(),top:f.getViewportTop(),width:f.getViewportWidth(),height:f.getViewportHeight(),boxSizing:"border-box",border:"2px solid var(--stroke--scale-editor)",boxShadow:"0 0 0 10000px rgba(0,0,0,.25)",cursor:"pointer"},onPointerDown:g=>{Fc(e,g)}})})]})})})})]}):null]})})});O(({localStore:e,className:t,isMainWorkspace:n,children:r})=>{const i=Ke(()=>({id:void 0,containerWidth:0,containerHeight:0,get padding(){return e.options.safePadding},get extraPaddingLeft(){const c=i.containerWidth-i.padding*2-e.props.getPageSize().width*e.getPageScale();return c>0?c/2:0},get extraPaddingTop(){const c=i.containerHeight-i.padding*2-e.props.getPageSize().height*e.getPageScale();return c>0?c/2:0}})),a=e.getPageScale(),s=e.props.getPageSize().width*a,o=e.props.getPageSize().height*a,u=x.useRef(null);return x.useEffect(()=>(u.current&&(i.id=setInterval(()=>{if(u.current){const c=Js(u.current);c!==i.containerWidth&&(i.containerWidth=c);const f=Qs(u.current);f!==i.containerHeight&&(i.containerHeight=f)}},10),u.current.onwheel=c=>{c.ctrlKey&&(c.preventDefault(),Ed(e,c,i.padding))},e.workspaceElement=u.current),()=>{e.workspaceElement=null,typeof i.id=="number"&&clearInterval(i.id)}),[]),d.jsx("div",{className:`WorkspaceV2 ${t}`,style:{position:"relative",width:"100%",height:"100%",overflow:"scroll"},ref:u,children:d.jsx("div",{style:{position:"relative",width:s+i.padding*2+i.extraPaddingLeft*2,height:o+i.padding*2+i.extraPaddingTop*2,overflow:"hidden"},children:d.jsx("div",{style:{position:"relative",left:i.padding+i.extraPaddingLeft,top:i.padding+i.extraPaddingTop,width:s,height:o},children:r})})})});const Lp=O(({localStore:e,className:t,children:n})=>{const r=e.getPageScale(),i=x.useRef(null);return x.useEffect(()=>(i.current&&(e.isMobile===!1&&(i.current.onwheel=a=>{a.ctrlKey?(a.preventDefault(),Xs(e,a),i.current&&zs({localStore:e,workspace:i.current})):(a.preventDefault(),Fr({localStore:e,deltaX:a.deltaX,deltaY:a.deltaY}))}),e.workspaceElement=i.current),()=>{e.workspaceElement=null}),[]),d.jsxs("div",{className:`WorkspaceV3 ${t}`,style:{position:"relative",width:"100%",height:"100%"},ref:i,children:[d.jsx(su,{localStore:e,onDropFilesToWorkspace:()=>{},children:d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%"},children:d.jsx("div",{className:"page-container-2000",style:{position:"absolute",left:e.workspaceState.positionLeft-e.props.getPageSize().width*r/2,top:e.workspaceState.positionTop-e.props.getPageSize().height*r/2,width:e.props.getPageSize().width*r,height:e.props.getPageSize().height*r},children:n})})}),d.jsx(hh,{localStore:e})]})}),hh=O(({localStore:e})=>{const t=Ke(()=>({x:{status:"",pageX:0,show:!1},y:{status:"",pageY:0,show:!1},hasTimeout:!1,willHide(){this.hasTimeout||(this.hasTimeout=!0,setTimeout(()=>{this.x.status===""&&(this.x.show=!1),this.y.status===""&&(this.y.show=!1),this.hasTimeout=!1},1500))},pointermove(n){if(t.x.status==="dragging"){const r=n.pageX-t.x.pageX;t.x.pageX=n.pageX,Fr({localStore:e,deltaX:r*e.getPageScale(),deltaY:0})}if(t.y.status==="dragging"){const r=n.pageY-t.y.pageY;t.y.pageY=n.pageY,Fr({localStore:e,deltaX:0,deltaY:r*e.getPageScale()})}},pointerup(){t.x.status="",t.y.status="",this.willHide()}}));return x.useEffect(()=>(window.addEventListener("pointermove",t.pointermove),window.addEventListener("pointerup",t.pointerup),window.addEventListener("pointercancel",t.pointerup),()=>{window.removeEventListener("pointermove",t.pointermove),window.removeEventListener("pointerup",t.pointerup),window.removeEventListener("pointercancel",t.pointerup)}),[]),x.useEffect(()=>{t.x.show=!0,t.willHide()},[e.workspaceState.scroll.x.barStart]),x.useEffect(()=>{t.y.show=!0,t.willHide()},[e.workspaceState.scroll.y.barStart]),x.useEffect(()=>{t.x.show=!0,t.y.show=!0,t.willHide()},[e.getPageScale()]),d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{display:e.workspaceState.scroll.x.barLength>=e.workspaceState.scroll.x.viewportLength?"none":"",position:"absolute",left:0,bottom:0,width:"100%",height:8,cursor:"pointer",zIndex:1e5},onPointerEnter:()=>{t.x.show=!0},onPointerDown:n=>{t.x.status="dragging",t.x.pageX=n.pageX},onPointerLeave:()=>{t.willHide()},children:d.jsx("div",{style:{position:"absolute",left:e.workspaceState.scroll.x.barStart,bottom:0,width:e.workspaceState.scroll.x.barLength,height:8,borderRadius:4,background:"lightgray",opacity:t.x.show?1:0,transition:"opacity 300ms"}})}),d.jsx("div",{style:{display:e.workspaceState.scroll.y.barLength>=e.workspaceState.scroll.y.viewportLength?"none":"",position:"absolute",top:0,right:0,height:"100%",width:8,cursor:"pointer",zIndex:1e5},onPointerEnter:()=>{t.y.show=!0},onPointerDown:n=>{t.y.status="dragging",t.y.pageY=n.pageY},onPointerLeave:()=>{t.willHide()},children:d.jsx("div",{style:{position:"absolute",top:e.workspaceState.scroll.y.barStart,right:0,height:e.workspaceState.scroll.y.barLength,width:8,borderRadius:4,background:"lightgray",opacity:t.y.show?1:0,transition:"opacity 300ms"}})})]})}),ph=O(({localStore:e,stepStore:t,polygonStore:n})=>{const r=Ke(()=>({isMobile:typeof window<"u"&&window.ontouchstart!==void 0,onPointerMove:de.throttle(s=>{Vc(e,n,Rn(s))},10),onPointerUp(s){setTimeout(()=>{_c(e,t,Rn(s))},20)}}));function i(s){hc(e,s,t)}function a(s){pc(e,s)}return x.useEffect(()=>(r.isMobile?(window.addEventListener("touchmove",r.onPointerMove),window.addEventListener("touchend",r.onPointerUp)):(window.addEventListener("pointermove",r.onPointerMove),window.addEventListener("pointerup",r.onPointerUp)),window.addEventListener("keydown",i),window.addEventListener("keyup",a),()=>{window.removeEventListener("touchmove",r.onPointerMove),window.removeEventListener("touchend",r.onPointerUp),window.removeEventListener("pointermove",r.onPointerMove),window.removeEventListener("pointerup",r.onPointerUp),window.removeEventListener("keydown",i),window.removeEventListener("keyup",a)}),[]),null}),Ep=O(({localStore:e,stepStore:t,polygonStore:n,style:r,children:i})=>d.jsxs("div",{className:"PowerWorld",style:r,children:[d.jsx(ph,{localStore:e,stepStore:t,polygonStore:n}),i]})),vh=O(({localStore:e})=>null),Tp=O(({toolsContainer:e,localStore:t,watermarkView:n})=>{const r=t.props.getPageSize(),i=t.getPageScale(),a=t.props.getBackgroundLayer();return d.jsxs("div",{className:"PowerPageView",style:{position:"relative",width:r.width*i,height:r.height*i},children:[t.options.renderer==="konva"?d.jsx(vh,{localStore:t}):d.jsxs("div",{className:"PowerPageViewContent",style:{position:"relative",overflow:"hidden",transform:`scale(${i})`,transformOrigin:"0 0",width:r.width,height:r.height},onPointerDown:s=>{s.button===2&&s.stopPropagation()},children:[d.jsxs("div",{style:{position:"relative",width:r.width,height:r.height,boxSizing:"border-box"},children:[d.jsx("div",{style:{position:"relative",width:r.width,height:r.height},children:a?d.jsx(qi,{localStore:t,container:a,borderRadiusPercent:0}):null}),t.props.getPanelList().map(s=>{var o;return d.jsx(qi,{container:s,localStore:t,borderRadiusPercent:((o=t.props.panels)==null?void 0:o.getPanelBorderRadiusPercent())||0},s.id)}),d.jsx("div",{className:"PowerNormalLayerListView",style:{position:"absolute",left:0,top:0},children:t.leafNormalLayerList.map(s=>d.jsx(gh,{layer:s,localStore:t},s.id))})]}),n]}),e]})}),Fp=O(({localStore:e,overlay:t,frameList:n})=>null);function mh(){return d.jsx("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",style:{width:"100%",height:"100%"},children:d.jsx("path",{d:"M1024 512q0 14.848-10.825143 25.746286l-146.285714 146.285714q-10.825143 10.825143-25.746286 10.825143t-25.746286-10.825143-10.825143-25.746286l0-73.142857-219.428571 0 0 219.428571 73.142857 0q14.848 0 25.746286 10.825143t10.825143 25.746286-10.825143 25.746286l-146.285714 146.285714q-10.825143 10.825143-25.746286 10.825143t-25.746286-10.825143l-146.285714-146.285714q-10.825143-10.825143-10.825143-25.746286t10.825143-25.746286 25.746286-10.825143l73.142857 0 0-219.428571-219.428571 0 0 73.142857q0 14.848-10.825143 25.746286t-25.746286 10.825143-25.746286-10.825143l-146.285714-146.285714q-10.825143-10.825143-10.825143-25.746286t10.825143-25.746286l146.285714-146.285714q10.825143-10.825143 25.746286-10.825143t25.746286 10.825143 10.825143 25.746286l0 73.142857 219.428571 0 0-219.428571-73.142857 0q-14.848 0-25.746286-10.825143t-10.825143-25.746286 10.825143-25.746286l146.285714-146.285714q10.825143-10.825143 25.746286-10.825143t25.746286 10.825143l146.285714 146.285714q10.825143 10.825143 10.825143 25.746286t-10.825143 25.746286-25.746286 10.825143l-73.142857 0 0 219.428571 219.428571 0 0-73.142857q0-14.848 10.825143-25.746286t25.746286-10.825143 25.746286 10.825143l146.285714 146.285714q10.825143 10.825143 10.825143 25.746286z",fill:"white"})})}const yh=O(({localStore:e,layer:t})=>{var n;return d.jsx("div",{className:"rotatorBar",style:{position:"absolute",top:"50%",left:"50%",width:0,height:0,transform:`rotate(${((n=t.image)==null?void 0:n.rotate)||0}deg)`},children:d.jsx("div",{className:"pullRod",style:{position:"absolute",top:"-1px",left:"25px",width:"50px",height:"2px",backgroundColor:"#fff",boxShadow:"var(--_base--shadow-dropdownlist-dark)",display:e.currentStatus==="draggingImageControllerScaler"?"none":""},onPointerDown:r=>{r.stopPropagation(),e.currentStatus="draggingImageControllerRotator",fe(e,r)},children:d.jsx("div",{className:"pull-rod-icon",style:{position:"absolute",top:"50%",right:0,width:16,height:16,backgroundColor:e.currentStatus==="draggingImageControllerRotator"?"blue":"#fff",borderRadius:"50%",boxShadow:"var(--_base--shadow-dropdownlist-dark)",transform:"translate(100%, -50%)",cursor:"pointer"}})})})}),La=O(({localStore:e,layer:t})=>{function n(){let i=24;return e.currentStatus==="draggingImageControllerScaler"&&(e.pointerRayLengthInWindow>47?i=47:e.pointerRayLengthInWindow<10?i=10:i=e.pointerRayLengthInWindow),i}function r(){return!(e.currentStatus==="draggingImageControllerMover"||!t.image||t.image.imageScaleMode!=="FILL"||t.width<100||t.height<100)}return d.jsx("div",{className:"ImageController",style:{position:"absolute",top:"50%",left:"50%",display:r()?"":"none",opacity:e.isUpdatingLayer?0:1,transitionDuration:Pt},children:d.jsxs("div",{style:{position:"relative"},children:[d.jsx(yh,{localStore:e,layer:t}),d.jsx("div",{className:"movableCircle",style:{position:"absolute",top:"50%",left:"50%",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.3)",border:"2px solid #6c8ee5",borderRadius:"1000px",transform:"translate(-50%, -50%)",width:n()*2,height:n()*2},children:d.jsxs("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%"},children:[d.jsx("div",{style:{position:"absolute",left:4,top:4,width:40,height:40,borderRadius:1e5}}),d.jsx("div",{style:{display:e.currentStatus==="draggingImageControllerRotator"||e.currentStatus==="draggingImageControllerScaler"?"none":"",position:"absolute",left:"50%",top:"50%",width:23,height:23,transform:"translate3d(-50%, -50%, 0)",cursor:"pointer",userSelect:"none"},draggable:"false",onPointerDown:i=>{i.stopPropagation(),e.currentStatus="draggingImageControllerMover",fe(e,i)},children:mh()}),d.jsx("div",{style:{display:e.currentStatus==="draggingImageControllerRotator"||e.currentStatus==="draggingImageControllerScaler"?"":"none",position:"absolute",left:"50%",top:"50%",width:6,height:6,background:"white",borderRadius:1e3,transform:"translate3d(-50%, -50%, 0)"},className:"centerCircle"})]})}),d.jsx("div",{style:{position:"absolute",left:0,top:0,transformOrigin:"0 0",transform:`rotate(${-t.rotate}deg)`},children:d.jsx("div",{className:"blueDot",style:{position:"absolute",top:0,left:n(),width:0,height:0},onPointerDown:i=>{Lc(e,i)},children:d.jsx("div",{style:{width:12,height:12,backgroundColor:"#5b77ec",border:"2px solid #fff",borderRadius:"50%",transform:"translate(-50%, -50%)",cursor:"ew-resize",boxSizing:"border-box"}})})})]})})}),Ts={},Gr=O(({containerId:e,style:t})=>(x.useEffect(()=>{if(!Ts[e]){Ts[e]=!0;const n=document.createElement("style");n.setAttribute("id",e),n.innerHTML=t,document.body.appendChild(n)}},[]),null)),xh=O(({localStore:e,layer:t})=>t.image?d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:`rotate(${t.image.rotate}deg) scale(${e.getPageScale()})`},children:d.jsx("div",{style:{position:"absolute",width:t.image.width,height:t.image.height,transform:`translate3d(-${t.image.width/2}px, -${t.image.height/2}px, 0)`,transitionDuration:e.layerImageHasTransition?"300ms":""},children:d.jsx("div",{style:{width:"100%",height:"100%",display:"block",position:"absolute",left:0,top:0,transform:`translate3d(${t.image.imageX}px, ${t.image.imageY}px, 0) scale(${t.image.flipH?"-1":"1"},${t.image.flipV?"-1":"1"})`,transitionDuration:e.layerImageHasTransition?"300ms":"",opacity:.5,cursor:"move"},onPointerDown:n=>{n.stopPropagation(),e.currentStatus="draggingImageControllerMover",fe(e,n)},children:d.jsx($o,{localStore:e,layer:t})})})}):null),wh=O(({localStore:e,boxWidth:t,boxHeight:n})=>d.jsxs("div",{className:"dotBox",style:{position:"relative",width:"100%",height:"100%"},children:[d.jsxs("div",{className:"guidesBox",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[d.jsx("div",{className:"guides",style:{position:"absolute",left:"33.333%",width:"1px",height:"100%",background:"white"}}),d.jsx("div",{className:"guides",style:{position:"absolute",left:"66.666%",width:"1px",height:"100%",background:"white"}})]}),d.jsxs("div",{className:"guidesBox2",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[d.jsx("div",{className:"guides",style:{position:"absolute",top:"33.333%",width:"100%",height:"1px",background:"white"}}),d.jsx("div",{className:"guides",style:{position:"absolute",top:"66.666%",width:"100%",height:"1px",background:"white"}})]}),d.jsx("div",{className:"border",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"2px solid blue",cursor:"move",boxSizing:"border-box"},onPointerDown:r=>{r.stopPropagation(),e.currentStatus="draggingImageControllerMover",fe(e,r)}}),e.isCroppingBackground?null:d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"dot",style:{position:"absolute",top:-4,left:-6},width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{hr(e,"rightBottom",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148500)",children:d.jsx("path",{d:"M22 5C22 3.34315 20.6569 2 19 2H7.2C6.0799 2 5.51984 2 5.09202 2.21799C4.71569 2.40973 4.40973 2.71569 4.21799 3.09202C4 3.51984 4 4.07989 4 5.2V17C4 18.6569 5.34315 20 7 20V20C8.65685 20 10 18.6569 10 17V8.8C10 8.51997 10 8.37996 10.0545 8.273C10.1024 8.17892 10.1789 8.10243 10.273 8.0545C10.38 8 10.52 8 10.8 8H19C20.6569 8 22 6.65685 22 5V5Z",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148500",x:"0",y:"0",width:"26",height:"26",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148500"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148500",result:"effect2_dropShadow_6601_148500"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148500",result:"shape"})]})})]}),d.jsxs("svg",{className:"dot",style:{position:"absolute",top:-4,left:-20+t,cursor:"pointer"},width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{hr(e,"leftBottom",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148502)",children:d.jsx("path",{d:"M4 5C4 3.34315 5.34315 2 7 2H18.8C19.9201 2 20.4802 2 20.908 2.21799C21.2843 2.40973 21.5903 2.71569 21.782 3.09202C22 3.51984 22 4.0799 22 5.2V17C22 18.6569 20.6569 20 19 20C17.3431 20 16 18.6569 16 17V8.8C16 8.51997 16 8.37996 15.9455 8.273C15.8976 8.17892 15.8211 8.10243 15.727 8.0545C15.62 8 15.48 8 15.2 8H7C5.34315 8 4 6.65685 4 5Z",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148502",x:"0",y:"0",width:"26",height:"26",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148502"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148502",result:"effect2_dropShadow_6601_148502"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148502",result:"shape"})]})})]}),d.jsxs("svg",{className:"dot",style:{position:"absolute",top:-18+n,left:-6},width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{hr(e,"rightTop",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148501)",children:d.jsx("path",{d:"M22 17C22 18.6569 20.6569 20 19 20H7.2C6.0799 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4 18.4802 4 17.9201 4 16.8V5C4 3.34315 5.34315 2 7 2C8.65685 2 10 3.34315 10 5V13.2C10 13.48 10 13.62 10.0545 13.727C10.1024 13.8211 10.1789 13.8976 10.273 13.9455C10.38 14 10.52 14 10.8 14H19C20.6569 14 22 15.3431 22 17Z",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148501",x:"0",y:"0",width:"26",height:"26",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148501"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148501",result:"effect2_dropShadow_6601_148501"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148501",result:"shape"})]})})]}),d.jsxs("svg",{className:"dot",style:{position:"absolute",top:-18+n,left:-20+t},width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{hr(e,"leftTop",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148503)",children:d.jsx("path",{d:"M4 17C4 18.6569 5.34315 20 7 20H18.8C19.9201 20 20.4802 20 20.908 19.782C21.2843 19.5903 21.5903 19.2843 21.782 18.908C22 18.4802 22 17.9201 22 16.8V5C22 3.34315 20.6569 2 19 2C17.3431 2 16 3.34315 16 5V13.2C16 13.48 16 13.62 15.9455 13.727C15.8976 13.8211 15.8211 13.8976 15.727 13.9455C15.62 14 15.48 14 15.2 14H7C5.34315 14 4 15.3431 4 17Z",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148503",x:"0",y:"0",width:"26",height:"26",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148503"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148503",result:"effect2_dropShadow_6601_148503"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148503",result:"shape"})]})})]}),d.jsxs("svg",{className:"stripe",style:{position:"absolute",top:-4,left:t/2-16},width:"32",height:"14",viewBox:"0 0 32 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{pr(e,"bottom",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148504)",children:d.jsx("rect",{x:"4",y:"2",width:"24",height:"6",rx:"3",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148504",x:"0",y:"0",width:"32",height:"14",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148504"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148504",result:"effect2_dropShadow_6601_148504"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148504",result:"shape"})]})})]}),d.jsxs("svg",{className:"stripe",style:{position:"absolute",top:-6+n,left:t/2-16},width:"32",height:"14",viewBox:"0 0 32 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{pr(e,"top",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148504)",children:d.jsx("rect",{x:"4",y:"2",width:"24",height:"6",rx:"3",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148504",x:"0",y:"0",width:"32",height:"14",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148504"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148504",result:"effect2_dropShadow_6601_148504"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148504",result:"shape"})]})})]}),d.jsxs("svg",{className:"stripe",style:{position:"absolute",top:n/2-14,left:-6},width:"14",height:"32",viewBox:"0 0 14 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{pr(e,"right",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148507)",children:d.jsx("rect",{x:"4",y:"2",width:"6",height:"24",rx:"3",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148507",x:"0",y:"0",width:"14",height:"32",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148507"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148507",result:"effect2_dropShadow_6601_148507"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148507",result:"shape"})]})})]}),d.jsxs("svg",{className:"stripe",style:{position:"absolute",top:n/2-14,left:t-8},width:"14",height:"32",viewBox:"0 0 14 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",onPointerDown:r=>{pr(e,"left",r)},children:[d.jsx("g",{filter:"url(#filter0_dd_6601_148507)",children:d.jsx("rect",{x:"4",y:"2",width:"6",height:"24",rx:"3",fill:"white"})}),d.jsx("defs",{children:d.jsxs("filter",{id:"filter0_dd_6601_148507",x:"0",y:"0",width:"14",height:"32",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[d.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{}),d.jsx("feGaussianBlur",{stdDeviation:"0.5"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"}),d.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_6601_148507"}),d.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),d.jsx("feOffset",{dy:"2"}),d.jsx("feGaussianBlur",{stdDeviation:"2"}),d.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),d.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_6601_148507",result:"effect2_dropShadow_6601_148507"}),d.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_6601_148507",result:"shape"})]})})]})]})]})),bh=O(({localStore:e,stepStore:t})=>d.jsx("div",{onClick:n=>{n.stopPropagation()},onPointerDown:n=>{n.stopPropagation()},onPointerUp:n=>n.stopPropagation(),style:{position:"fixed",left:"50%",transform:"translateX(-50%)",top:76},children:d.jsxs("div",{className:"croppActionBar",style:{display:"flex",width:300,alignItems:"center",padding:"8px 16px",color:"black",background:"white",borderRadius:"8px",boxShadow:""},children:[d.jsx("div",{className:"-title",style:{marginRight:"16px",fontWeight:500,fontSize:"14px",lineHeight:"20px",cursor:"pointer"},children:"缩放"}),d.jsx("div",{className:"-sliderBox",style:{flex:1}}),d.jsx("div",{className:"-line",style:{width:"1px",height:"24px",marginLeft:"16px",color:"black",cursor:"pointer"}}),d.jsx("div",{className:"croppingModalButton",style:{marginLeft:"16px",fontWeight:400,fontSize:"12px",lineHeight:"16px",cursor:"pointer"},onClick:()=>{ec(e)},children:"重置"}),d.jsx("div",{className:"croppingModalButton",style:{marginLeft:"16px",fontWeight:400,fontSize:"12px",lineHeight:"16px",cursor:"pointer"},onClick:()=>{Sd(e)},children:"取消"}),d.jsx("div",{className:"-done",style:{marginLeft:"16px",fontWeight:600,fontSize:"12px",lineHeight:"16px",cursor:"pointer"},onClick:()=>{var n,r;(r=(n=e.props).onConfirmCroppingModal)==null||r.call(n),tc(e),t.record("layerTextStyleUpdated")},children:"完成"})]})})),Ch=O(({localStore:e,stepStore:t})=>{const n=e.layerUnderCropping;if(!n||n.nodeType!=="IMAGE"&&n.nodeType!=="ROUNDED_RECTANGLE"||!n.image)return null;const r=n.left*e.getPageScale(),i=n.top*e.getPageScale(),a=n.width*e.getPageScale(),s=n.height*e.getPageScale();return d.jsxs("div",{className:"LayerImageCroppingModal",style:{position:"absolute",top:0,left:0,zIndex:1e3},children:[d.jsx(Gr,{containerId:"#croppingModalActionButtonStyle",style:`
          .croppingModalButton:hover {
          }
        `}),d.jsx("div",{style:{position:"fixed",left:0,top:0,width:"100%",height:"100%",background:"black",opacity:.5,cursor:"not-allowed"},onPointerDown:o=>{o.stopPropagation()},onClick:o=>{o.stopPropagation()}}),d.jsx("div",{style:{position:"absolute",left:-2e4,top:-2e4,width:4e4,height:4e4},onPointerDown:o=>{o.stopPropagation()}}),d.jsxs("div",{className:"contentBox",style:{position:"relative"},onPointerDown:o=>{o.stopPropagation()},children:[d.jsx("div",{className:"contentBoxBg",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"",boxSizing:"border-box"}}),d.jsxs("div",{className:"frame",style:{position:"absolute",width:a,height:s,left:r,top:i,transform:`rotate(${n.rotate}deg)`},children:[d.jsx(xh,{localStore:e,layer:n}),d.jsx("div",{className:"layer-content-container",style:{position:"absolute",left:0,top:0,transformOrigin:"0 0",transform:`scale(${e.getPageScale()})`},children:d.jsx(zo,{localStore:e,container:n,pointList:[],borderRadiusPercent:0})}),d.jsx(wh,{localStore:e,boxWidth:a,boxHeight:s}),d.jsx(La,{localStore:e,layer:n})]})]}),d.jsx(bh,{localStore:e,stepStore:t})]})}),Zi="#0d99ff",Ph=O(({textLayer:e,pageScale:t,localStore:n,stepStore:r})=>{const i=x.useRef(null),a=x.useRef(null),s=Ke(()=>({initialized:!1,isChange:!1}));x.useEffect(()=>{var u;if(a.current){const c=Vt(n),f=(u=a.current)==null?void 0:u.getEditor();f.root.setAttribute("spellcheck","false"),Td(a.current),f.setText(e.textData.characters),f.setSelection(0,f.getLength()),Br(n,e,[],c),o(),s.initialized=!0}return()=>{s.isChange&&(r.record("layerTextTextUpdated"),Ce(n))}},[]);const o=()=>{As(e)};return d.jsxs("div",{className:"TextLayerEditor",ref:i,style:{position:"absolute",left:0,top:0,width:e.width,height:e.height,transformOrigin:"0 0",transform:`scale(${t})`},onPointerDown:u=>{u.stopPropagation()},onPointerUp:u=>{u.stopPropagation()},children:[d.jsx(Gr,{containerId:"#textLayerEditorStyle",style:`
        .ql-container {
          border: none !important;
        }
        .ql-editor {
          padding: 0 !important;
          overflow: visible !important;
        }
      `}),d.jsx(Fd.ReactQuill,{className:e.id||"",ref:a,theme:"snow",style:{width:"100%",height:"100%",padding:0},onFocus:()=>{},onChange:(u,c,f,l)=>{if(s.initialized&&e.textData.characters!==l.getText()){const p=X(n);Od({localStore:n,layer:e,text:l.getText(),step:p,instanceChain:[]}),o(),s.isChange=!0}},onBlur:()=>{},modules:{toolbar:!1}})]})});function Lh(){return d.jsx("svg",{style:{position:"absolute",width:15,height:15,left:6,top:7},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",children:d.jsx("path",{d:"M928 704h-192c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h136.533333c-76.8 100.266667-196.266667 160-326.4 160-228.266667 0-413.866667-185.6-413.866666-416 0-17.066667-14.933333-32-32-32s-32 14.933333-32 32c0 264.533333 213.333333 480 477.866666 480 134.4 0 260.266667-57.6 349.866667-153.6v89.6c0 17.066667 14.933333 32 32 32s32-14.933333 32-32v-192c0-17.066667-14.933333-32-32-32zM546.133333 32C407.466667 32 281.6 91.733333 192 189.866667V96C192 78.933333 177.066667 64 160 64S128 78.933333 128 96v192c0 17.066667 14.933333 32 32 32h192c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32h-132.266667c76.8-100.266667 196.266667-160 326.4-160C774.4 96 960 281.6 960 512c0 17.066667 14.933333 32 32 32S1024 529.066667 1024 512C1024 247.466667 810.666667 32 546.133333 32z",fill:"#212121"})})}const xr=O(({localStore:e,left:t,top:n,right:r,bottom:i,cursor:a,getPageScale:s,originPointName:o})=>{const u=Ke(()=>({pointerDownOnMe:!1}));x.useEffect(()=>{e.currentStatus!=="resizingLayersByCorner"&&(u.pointerDownOnMe=!1)},[e.currentStatus]);function c(){return e.isUpdatingLayer&&e.currentStatus!=="resizingLayersByCorner"||e.isUpdatingLayer&&e.currentStatus==="resizingLayersByCorner"&&u.pointerDownOnMe===!1?0:1}return d.jsxs("div",{className:"AnchorPoint",style:{position:"absolute",left:t,top:n,right:r,bottom:i,cursor:a,userSelect:"none",transitionDuration:Pt,opacity:c()},onPointerDown:f=>{u.pointerDownOnMe=!0,ho(e,f,o)},onTouchStart:f=>{f.stopPropagation(),f.preventDefault()},children:[d.jsx("div",{style:{position:"absolute",left:-12,top:-12,width:24,height:24,borderRadius:"100px"}}),d.jsx("div",{style:{position:"absolute",left:-4,top:-4,width:8,height:8,background:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1), 0px 0px 1px rgba(0, 0, 0, 0.5)",borderRadius:"100px"}})]})}),Eh=O(({localStore:e,getLayer:t})=>d.jsx("div",{style:{position:"absolute",left:"50%",bottom:0},children:d.jsx(Pa,{style:{position:"absolute",left:-15,top:10,width:28,height:28,background:"white",borderRadius:14,cursor:"grab",opacity:e.isUpdatingLayer&&e.currentStatus!=="rotatingLayers"?0:1,transitionDuration:Pt},onPointerDown:n=>{go(e,n)},children:d.jsx(Lh,{})})})),Th=O(({localStore:e})=>e.computed.hasLeftRightBar===!1?null:d.jsx("div",{style:{position:"absolute",left:0,top:"50%",cursor:"ew-resize",transition:Pt,opacity:e.isUpdatingLayer&&e.currentStatus!=="resizingLayersByBorder"?0:1},onPointerDown:t=>{Hn(e,t,"right")},children:d.jsx("div",{style:{position:"absolute",left:-2,top:-8,width:6,height:16,background:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1), 0px 0px 1px rgba(0, 0, 0, 0.5)",borderRadius:3}})})),Fh=O(({localStore:e})=>e.computed.hasLeftRightBar===!1?null:d.jsx("div",{style:{position:"absolute",right:0,top:"50%",cursor:"ew-resize",transition:Pt,opacity:e.isUpdatingLayer&&e.currentStatus!=="resizingLayersByBorder"?0:1},onPointerDown:t=>{Hn(e,t,"left")},children:d.jsx("div",{style:{position:"absolute",left:-4,top:-8,width:6,height:16,background:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1), 0px 0px 1px rgba(0, 0, 0, 0.5)",borderRadius:3}})})),Ih=O(({localStore:e})=>e.computed.hasTopBottomBar===!1?null:d.jsx("div",{style:{position:"absolute",left:"50%",top:0,cursor:"ns-resize",transition:Pt,opacity:e.isUpdatingLayer&&e.currentStatus!=="resizingLayersByBorder"?0:1},onPointerDown:t=>{Hn(e,t,"bottom")},children:d.jsx("div",{style:{position:"absolute",left:-8,top:-2,width:16,height:6,background:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1), 0px 0px 1px rgba(0, 0, 0, 0.5)",borderRadius:3}})})),jh=O(({localStore:e})=>e.computed.hasTopBottomBar===!1?null:d.jsx("div",{style:{position:"absolute",left:"50%",bottom:0,cursor:"ns-resize",transition:Pt,opacity:e.isUpdatingLayer&&e.currentStatus!=="resizingLayersByBorder"?0:1},onPointerDown:t=>{Hn(e,t,"top")},children:d.jsx("div",{style:{position:"absolute",left:-8,top:-2,width:16,height:6,background:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1), 0px 0px 1px rgba(0, 0, 0, 0.5)",borderRadius:3}})})),Mh=O(({localStore:e})=>d.jsxs("div",{style:{position:"absolute",left:-12,top:-12,borderRadius:1e3,width:24,height:24,background:"white",boxShadow:"var(--handle_shadow)",cursor:"pointer",display:"none",alignItems:"center",justifyContent:"center"},onClick:t=>{t.stopPropagation(),Id(e)},onPointerDown:t=>t.stopPropagation(),onPointerUp:t=>t.stopPropagation(),children:[d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[d.jsxs("g",{clipPath:"url(#clip0_20307_4052)",children:[d.jsx("path",{d:"M0 0L0.005 0L0.005 0.005L0 0.005L0 0Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M-4.18969e-08 19.995L0.00499996 19.995L0.00499996 20L-4.19074e-08 20L-4.18969e-08 19.995Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M19.995 4.18969e-08L20 4.19074e-08L20 0.00500004L19.995 0.00500004L19.995 4.18969e-08Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M19.995 19.995L20 19.995L20 20L19.995 20L19.995 19.995Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M10.6187 5.13865C11.7903 3.96708 13.6898 3.96708 14.8614 5.13865C16.0329 6.31023 16.0329 8.20972 14.8614 9.38129L13.0936 11.1491C12.8983 11.3443 12.5817 11.3443 12.3865 11.1491C12.1912 10.9538 12.1912 10.6372 12.3865 10.442L14.1542 8.67419C14.9353 7.89314 14.9353 6.62681 14.1542 5.84576C13.3732 5.06471 12.1069 5.06471 11.3258 5.84576L9.55806 7.61353C9.36279 7.80879 9.04621 7.80879 8.85095 7.61353C8.65569 7.41827 8.65569 7.10168 8.85095 6.90642L10.6187 5.13865Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M5.13864 10.6187C3.96707 11.7903 3.96707 13.6898 5.13864 14.8614C6.31021 16.0329 8.20971 16.0329 9.38128 14.8614L11.149 13.0936C11.3443 12.8983 11.3443 12.5818 11.149 12.3865C10.9538 12.1912 10.6372 12.1912 10.4419 12.3865L8.67417 14.1543C7.89312 14.9353 6.62679 14.9353 5.84575 14.1543C5.0647 13.3732 5.0647 12.1069 5.84575 11.3258L7.61351 9.55807C7.80877 9.36281 7.80877 9.04623 7.61351 8.85096C7.41825 8.6557 7.10167 8.6557 6.90641 8.85096L5.13864 10.6187Z",fill:"#0F0F0F"}),d.jsx("path",{d:"M11.7678 8.23228C11.5725 8.03701 11.2559 8.03701 11.0607 8.23228L8.23223 11.0607C8.03697 11.256 8.03697 11.5725 8.23223 11.7678C8.4275 11.9631 8.74408 11.9631 8.93934 11.7678L11.7678 8.93938C11.963 8.74412 11.963 8.42754 11.7678 8.23228Z",fill:"#0F0F0F"})]}),d.jsx("defs",{children:d.jsx("clipPath",{id:"clip0_20307_4052",children:d.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),d.jsx("div",{style:{position:"absolute",left:-38,top:"120%",width:100,fontSize:12,lineHeight:"24px",textAlign:"center",color:"white",background:"rgba(0,0,0,0.6)",borderRadius:4},children:"解锁组内移动"})]})),Rh=O(({show:e,layer:t,getLayer:n,getPageScale:r,localStore:i})=>{var s;function a(){return null}return d.jsxs("div",{className:"LayerResizer",style:{display:(i.selectedNormalLayerList.length>0||i.selectedSingleLayer)&&e?"":"none"},"data-active-id":t.id,children:[d.jsx(Pa,{style:{position:"absolute",left:0,top:0,width:t.width*r(),height:t.height*r(),cursor:"move",boxSizing:"border-box"},onPointerDown:o=>{ca(i,o)},onPointerUp:o=>{}}),a()?d.jsx(La,{localStore:i,layer:a()}):null,i.computed.hasAnchorPoints?d.jsxs(d.Fragment,{children:[d.jsx(xr,{originPointName:"rightBottom",localStore:i,getPageScale:r,left:0,top:0,cursor:"nwse-resize"}),d.jsx(xr,{originPointName:"leftBottom",localStore:i,getPageScale:r,right:0,top:0,cursor:"nesw-resize"}),d.jsx(xr,{originPointName:"rightTop",localStore:i,getPageScale:r,left:0,bottom:0,cursor:"nesw-resize"}),d.jsx(xr,{originPointName:"leftTop",localStore:i,getPageScale:r,right:0,bottom:0,cursor:"nwse-resize"})]}):null,i.getSelectedLayerIdList().length>1||((s=i.selectedSingleLayer)==null?void 0:s.nodeType)==="GROUP"||i.options.hasLayerShortBars===!1?null:d.jsxs(d.Fragment,{children:[d.jsx(Th,{localStore:i}),d.jsx(Fh,{localStore:i}),d.jsx(Ih,{localStore:i}),d.jsx(jh,{localStore:i})]}),i.options.hasLayerRotator?d.jsx(Eh,{localStore:i,getLayer:n}):null,d.jsx("div",{style:{display:i.selectedSingleLayer&&i.selectedSingleLayer.nodeType==="GROUP"?"":"none",position:"absolute",right:-20,top:"50%",opacity:i.isUpdatingLayer?0:1,transitionDuration:Pt},children:d.jsx(Mh,{localStore:i})})]})}),kh=O(({localStore:e})=>{if(!(e.selectedSingleLayer&&e.selectedSingleLayer.nodeType==="GROUP"))return null;const t=e.normalLayerFlatMap[e.activeLayerInGroupId];return t?d.jsxs("div",{className:"SelectedLayerInGroup",style:{display:"none",position:"absolute",left:t.left*e.getPageScale(),top:t.top*e.getPageScale()},children:[d.jsx("div",{style:{position:"absolute",left:0,top:0,width:t.width*e.getPageScale(),height:t.height*e.getPageScale(),transform:`rotate(${t.rotate}deg)`,pointerEvents:"none",border:"2px solid #80A3FF",boxSizing:"border-box"}}),d.jsx("div",{style:{position:"absolute",left:t.width*e.getPageScale()/2,top:t.height*e.getPageScale()/2,transform:`rotate(${t.rotate}deg)`},children:t.nodeType==="IMAGE"?d.jsx(La,{localStore:e,layer:t}):null})]}):null}),Dh=O(({localStore:e,stepStore:t})=>d.jsxs("div",{children:[d.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",border:"2px solid #FD5D7D",boxSizing:"border-box"},onPointerDown:n=>{n.stopPropagation(),e.currentStatus=""}}),d.jsx("div",{style:{position:"absolute",right:0,bottom:0,width:24,height:24,borderRadius:1e3,background:"#FD3960",boxShadow:"var(--handle_shadow)",transform:"translate3d(50%, 50%, 0)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},onPointerDown:n=>{n.stopPropagation()},onClick:n=>{var r,i;if(n.stopPropagation(),e.selectedSingleLayer){const a=Vt(e);nc({layer:e.selectedSingleLayer,step:a}),(i=(r=e.props).doAction)==null||i.call(r,a.getNewAction()),Ce(e),t.record("UnlockedLayers")}},children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:d.jsx("path",{d:"M10 3.5C8.20507 3.5 6.75 4.95507 6.75 6.75C6.75 8.42009 6.75 8.52391 6.75 8.52391C6.51982 8.54539 6.34582 8.58614 6.19401 8.66349C5.91177 8.8073 5.6823 9.03677 5.53849 9.31901C5.375 9.63988 5.375 10.0599 5.375 10.9V13.35C5.375 14.1901 5.375 14.6101 5.53849 14.931C5.6823 15.2132 5.91177 15.4427 6.19401 15.5865C6.51488 15.75 6.93492 15.75 7.775 15.75H12.225C13.0651 15.75 13.4851 15.75 13.806 15.5865C14.0882 15.4427 14.3177 15.2132 14.4615 14.931C14.625 14.6101 14.625 14.1901 14.625 13.35V10.9C14.625 10.0599 14.625 9.63988 14.4615 9.31901C14.3177 9.03677 14.0882 8.8073 13.806 8.66349C13.6542 8.58614 13.4802 8.54539 13.25 8.52391V6.75C13.25 4.95507 11.7949 3.5 10 3.5ZM11.75 8.5H8.25V6.75C8.25 5.7835 9.0335 5 10 5C10.9665 5 11.75 5.7835 11.75 6.75V8.5Z",fill:"white"})})})]})),Oh=O(({localStore:e,stepStore:t,children:n})=>{var o;x.useEffect(()=>{},[e.renderCount]);function r(){const u=Zi;return e.selectedSingleLayer?e.selectedSingleLayer.nodeType==="GROUP"?`1px dashed ${u}`:`1px solid ${u}`:`1px dashed ${u}`}const i=Ke(()=>({get pos(){let u=1/0,c=1/0;return na(e.bunchRectangle).forEach(l=>{l.x<u&&(u=l.x),l.y<c&&(c=l.y)}),{left:u,top:c}}})),a=e.getLayer(((o=e.selectedSingleLayer)==null?void 0:o.parentId)||""),s=e.getPageScale();return d.jsxs("div",{className:"ActiveOverlay",style:{display:(e.selectedNormalLayerList.length>0||e.selectedSingleLayer)&&e.layerUnderCropping===null?"":"none",opacity:e.currentTool==="HandTool"?.5:1,pointerEvents:e.currentTool==="HandTool"?"none":"auto"},children:[a&&a.nodeType==="GROUP"?d.jsx("div",{className:"ParentGroup",style:{position:"absolute",left:a.left*s,top:a.top*s,width:a.width*s,height:a.height*s,boxSizing:"border-box",border:`1px ${Zi} dashed`,transform:`rotate(${a.rotate}deg)`},onPointerDown:u=>{u.stopPropagation(),Ec({localStore:e,e:u})}}):null,d.jsxs("div",{className:"active-overlay-content",style:{position:"absolute",...jd(e)},children:[d.jsx("div",{className:"active-overlay-outline",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",border:r(),boxSizing:"border-box",opacity:e.isUpdatingLayer?.2:1,transitionDuration:Pt}}),e.selectedSingleLayer&&e.selectedSingleLayer.isLocked?d.jsx(Dh,{localStore:e,stepStore:t}):d.jsx(Rh,{show:!0,layer:e.bunchRectangle,getLayer:()=>e.bunchRectangle,getPageScale:()=>e.getPageScale(),localStore:e}),e.selectedSingleLayer&&e.selectedSingleLayer.nodeType==="TEXT"&&e.editingText&&e.options.useTextEditor==="QUILL_EDITOR"?d.jsx(Ph,{localStore:e,textLayer:e.selectedSingleLayer,onFocus:()=>{},pageScale:e.getPageScale(),stepStore:t}):null,n]}),d.jsx(kh,{localStore:e}),d.jsx("div",{style:{position:"absolute",left:i.pos.left*e.getPageScale(),top:i.pos.top*e.getPageScale()-34,background:"white",borderRadius:4,padding:2,cursor:"pointer"},children:d.jsx("div",{onTouchStart:u=>{u.stopPropagation()},onTouchEnd:u=>{u.stopPropagation()},onPointerDown:u=>{u.stopPropagation()},onPointerUp:u=>{u.stopPropagation()},onClick:u=>{u.stopPropagation(),Vd({localStore:e,e:u})},children:"..."})})]})});function Ea({onDrop:e,onPaste:t,onPointerUp:n,style:r,children:i}){const a=x.useRef({onPaste:void 0});a.current.onPaste=t;async function s(u,c){return new Promise((f,l)=>{if(u==="text/plain"&&c.getAsString(async p=>{try{const y=await oc(p);if(y){const g=sc(y,"name");f(g)}else l()}catch(y){throw console.log(y),y}}),u==="Files"&&c){const p=c.getAsFile();p&&f(p)}})}async function o(u){if(a.current.onPaste&&u.clipboardData){const c=u.clipboardData.types,f=[];for(let l=0;l<c.length;l+=1){const p=u.clipboardData.items[l],y=c[l];try{const g=await s(y,p);if(g)f.push(g);else throw new Error("url转base64失败，图片加载失败")}catch(g){throw console.log(g),g}}f.length>0&&a.current.onPaste(f,c)}}return x.useEffect(()=>(window.addEventListener("paste",o),()=>{window.removeEventListener("paste",o)}),[]),d.jsx("div",{className:"DropArea",style:r,onDragOver:u=>{u.preventDefault()},onDrop:u=>{u.preventDefault(),e==null||e(u.dataTransfer.files,u)},children:i})}Ea.defaultProps={onDrop(){},onPointerUp(){},onPaste(){},style:{}};function Fs(e,t,n){if(t.nodeType==="GROUP"){const r=$s(e,n,[t]);if(r){const i=e.getLayer(r);if(i)return i}}return t}const Vh=O(({localStore:e,border:t,layer:n,stepStore:r,show:i})=>d.jsx("div",{style:{display:i?"":"none",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:e.currentStatus==="draggingWindowImageToPage"||e.currentStatus==="draggingLeftImageToPage"?"auto":"none",border:t,boxSizing:"border-box"},children:d.jsx(Ut,{style:{width:"100%",height:"100%"},vIf:!n.isLocked,vShow:ta(n)||n.nodeType==="GROUP",children:d.jsx(Ea,{style:{width:"100%",height:"100%"},onDrop:(a,s)=>{var o,u;if(e.currentStatus==="draggingWindowImageToPage"){s.stopPropagation();const c=Fs(e,n,s);c&&((u=(o=e.props).onDropImageOnLayer)==null||u.call(o,{fileList:a,layer:c}))}},children:d.jsx("div",{style:{width:"100%",height:"100%"},onPointerUp:a=>{var s,o;if(e.currentStatus==="draggingLeftImageToPage"){const u=Fs(e,n,a);u&&((o=(s=e.props).onDropImageOnLayer)==null||o.call(s,{layer:u}))}}})})})})),Nh=O(({layer:e,localStore:t,stepStore:n})=>{const r=Ke(()=>({pointerHovered:!1}));function i(){return t.overlappedLayerIdMap[e.id]}function a(){return!!(t.selectedSingleLayer&&e.id===t.selectedSingleLayer.id&&e.isLocked)}function s(){const o=`1px solid ${Zi}`;return r.pointerHovered||i()||Md(t,e)&&t.getSelectedLayerIdList().length>1?e.isLocked?"2px solid #fd5d7d":o:""}return d.jsx("div",{className:"LayerFrame",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",boxSizing:"border-box"},children:d.jsx("div",{onPointerEnter:()=>{r.pointerHovered=!0},onPointerLeave:()=>{r.pointerHovered=!1},onPointerDown:o=>{},style:{position:"relative",width:"100%",height:"100%"},children:d.jsx(Vh,{show:!a(),localStore:t,border:s(),stepStore:n,layer:e})})},e.id)}),ou=O(({localStore:e,stepStore:t,layer:n})=>{const r=e.getPageScale();return d.jsxs("div",{className:"LayerOverlay",style:{display:e.isUpdatingLayer||e.layerUnderCropping||Zs(e,n)===!1?"none":"",position:"absolute",left:0,top:0,transform:`translate3d(${n.left*r}px, ${n.top*r}px, 0) rotate(${n.rotate||0}deg)`,width:n.width*r,height:n.height*r,boxSizing:"border-box"},children:[d.jsx(Gr,{containerId:"#layerOverlayStyle",style:`
        @keyframes layersShimmering {
          0% {
            opacity: 0;
          }
          50% {
            opacity: 0.3;
          }
          100% {
            opacity: 0;
          }
        }
        `}),d.jsx(Nh,{layer:n,localStore:e,stepStore:t}),e.layersShimmering&&n.shimmerAtApearance?d.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",background:"black",pointerEvents:"none",animation:"layersShimmering 1s infinite"}}):null]},n.id)}),wr=20,br="#80A3FF",Cr=.5,Ah=O(({localStore:e,stepStore:t})=>{const n=e.activeGroupLayer;if(!n)return null;const r=Rd(n);return d.jsxs("div",{className:"GroupLayerEditor",children:[d.jsxs("div",{style:{position:"absolute",left:n.left*e.getPageScale(),top:n.top*e.getPageScale(),width:n.width*e.getPageScale(),height:n.height*e.getPageScale(),transform:`rotate(${n.rotate}deg)`},children:[d.jsx("div",{style:{position:"absolute",left:0,top:-20,height:wr,width:"100%",background:br,opacity:Cr}}),d.jsx("div",{style:{position:"absolute",left:-20,top:0,width:wr,height:"100%",background:br,opacity:Cr}}),d.jsx("div",{style:{position:"absolute",left:0,bottom:-20,height:wr,width:"100%",background:br,opacity:Cr}}),d.jsx("div",{style:{position:"absolute",right:-20,top:0,height:"100%",width:wr,background:br,opacity:Cr}})]}),r.map(i=>d.jsx(ou,{stepStore:t,localStore:e,layer:i},i.id))]})}),_h=O(({localStore:e})=>{const t=e.getPageScale(),{width:n,height:r}=e.props.getPageSize(),i=Ke(()=>({pointerInBound:!1})),a=e.selectedSingleImageLayer;x.useEffect(()=>{i.pointerInBound=!1},[e.getPageScale()]);function s(){return e.currentStatus==="drawingEraserPath"||e.currentStatus==="drawingMattingStrokePath"?!0:i.pointerInBound}return d.jsxs("div",{className:"EraserOverlay",style:{position:"absolute",left:0,top:0},children:[d.jsx("div",{style:{position:"absolute",left:-100*1e4,top:-100*1e4,width:200*1e4,height:200*1e4},onPointerDown:o=>{o.stopPropagation(),e.currentTool==="EraserTool"&&a&&Tc(e,a,o)},children:d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:n*t,height:r*t},onPointerMove:o=>{i.pointerInBound=!0,ue(e,o)},onPointerLeave:o=>{i.pointerInBound=!1},children:a!=null&&a.image?d.jsx("div",{style:{position:"absolute",left:a.left*t,top:a.top*t,width:a.width*t,height:a.height*t,transform:`rotate(${a.rotate}deg)`,overflow:e.options.strokePathOverflow},children:d.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:`rotate(${a.image.rotate}deg)`},children:d.jsx("div",{style:{position:"absolute",left:-(a.image.width*t)/2,top:-(a.image.height*t)/2,width:a.image.width*t,height:a.image.height*t,transform:`translate3d(${a.image.imageX*t}px, ${a.image.imageY*t}px, 0)`},children:d.jsx("canvas",{ref:o=>{e.eraserPathCanvas=o},style:{position:"absolute",left:0,top:0,transform:`scale(${a.image.flipH?"-1":"1"}, ${a.image.flipV?"-1":"1"}`,width:"100%",height:"100%",opacity:.7},width:a.image.naturalWidth,height:a.image.naturalHeight})})})}):null})}),d.jsx("div",{style:{position:"absolute",display:s()?"":"none",left:e.pointerCurrentPositionInPage.x*t,top:e.pointerCurrentPositionInPage.y*t,width:e.state.eraserVisualDiam,height:e.state.eraserVisualDiam,background:"rgba(255,255,255,0.4)",borderRadius:1e4,pointerEvents:"none",transform:"translate(-50%, -50%)",boxSizing:"border-box",border:"3px solid white"}})]})}),Pr=O(({localStore:e,layer:t,left:n,right:r,bottom:i,top:a,width:s,height:o})=>d.jsx("div",{style:{position:"absolute",right:r,top:a,left:n,bottom:i,height:o,width:s,cursor:"grab"},draggable:"false",onDragStart:u=>{u.preventDefault(),u.stopPropagation()},onPointerDown:u=>{u.stopPropagation(),e.currentStatus="draggingPanelImageOut",e.layerUnderDraggingId=t.id,e.pointerX=u.pageX,e.pointerY=u.pageY}})),Bh=O(({layer:e,stepStore:t,localStore:n,visualBorderRadius:r})=>{const i=Ke(()=>({deleteBtnHovered:!1})),a=n.getPageScale(),s=o=>n.getSelectedLayerIdList().indexOf(o.id)>-1;return d.jsxs("div",{className:"LayerImageClipper",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%"},onPointerUp:o=>{var u,c;if(n.currentStatus==="draggingPanelImageOut"){const f=n.getLayer(n.layerUnderDraggingId),l=e;f&&f.nodeType==="IMAGE"&&l&&l.nodeType==="IMAGE"&&((u=n.props.panels)==null||u.onDropPanelImageIntoAnother(f,l),ce(n,{type:"replace",idList:[l.id]}))}if(n.currentStatus==="draggingLeftImageToPage"){const f=e;(c=n.props.panels)==null||c.onDropImageIntoPanel(f)}},onPointerOut:o=>{n.currentStatus==="draggingImageInLayer"&&(n.currentStatus="draggingPanelImageOut",n.layerUnderDraggingId=e.id,n.pointerX=o.pageX,n.pointerY=o.pageY)},children:[d.jsx("div",{className:"crossShape",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none",width:`${a<=.3?"20px":"40px"}`,height:`${a<=.3?"20px":"40px"}`,display:n.props.grid&&e.nodeType==="IMAGE"&&!e.image&&!e.extra.backgroundColor?"block":"none"},children:d.jsx("svg",{className:"add-btn",style:{width:"100%",height:"100%"},viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:d.jsx("path",{d:"M19 29.75C19 30.3023 19.4477 30.75 20 30.75C20.5523 30.75 21 30.3023 21 29.75V21H29.75C30.3023 21 30.75 20.5523 30.75 20C30.75 19.4477 30.3023 19 29.75 19H21V10.25C21 9.69772 20.5523 9.25 20 9.25C19.4477 9.25 19 9.69772 19 10.25V19H10.25C9.69772 19 9.25 19.4477 9.25 20C9.25 20.5523 9.69772 21 10.25 21H19V29.75Z",fill:""})})}),d.jsx("div",{className:["layerFrame",n.props.grid?"":"noBorderLayer",s(e)?"activeLayerFrame":""].join(" "),style:{width:"100%",height:"100%",borderRadius:`${r}px`,cursor:e.nodeType==="IMAGE"&&e.image?"move":"",boxSizing:"border-box"},onPointerUp:o=>{},onPointerDown:o=>{n.pointerMoved=!1,e.nodeType==="IMAGE"&&(ce(n,{type:"replace",idList:[e.id]}),e.image?(o.stopPropagation(),n.currentStatus="draggingImageInLayer",n.pointerX=o.pageX,n.pointerY=o.pageY):(n.currentStatus="pointerDownOnEmptyPanel",ua(n,e,o),o.stopPropagation()))}}),e.nodeType==="IMAGE"&&(e.extra.backgroundColor||e.image)?d.jsxs(d.Fragment,{children:[d.jsx(Pr,{left:"0",top:"0",right:"",bottom:"",width:"10%",height:"100%",localStore:n,layer:e}),d.jsx(Pr,{left:"",top:"0",right:"0",bottom:"",width:"10%",height:"100%",localStore:n,layer:e}),d.jsx(Pr,{left:"0",top:"0",right:"",bottom:"",width:"100%",height:"10%",localStore:n,layer:e}),d.jsx(Pr,{left:"0",top:"",right:"",bottom:"0",width:"100%",height:"10%",localStore:n,layer:e})]}):null,d.jsx("div",{className:"delete-btn",style:{position:"absolute",right:8,top:8,cursor:"pointer",display:s(e)?"block":"none"},onPointerDown:o=>{var u;o.stopPropagation(),(u=n.props.panels)==null||u.onPointerDownOnDeleteButton()},onMouseEnter:()=>{i.deleteBtnHovered=!0},onMouseLeave:()=>{i.deleteBtnHovered=!1},children:d.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[d.jsx("path",{d:"M0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8Z",fill:"white",fillOpacity:i.deleteBtnHovered?"0.5":"0.25"}),d.jsx("path",{d:"M5.22446 4.37691C4.99014 4.14259 4.61025 4.14259 4.37593 4.37691C4.14162 4.61122 4.14162 4.99112 4.37593 5.22544L7.15167 8.00117L4.37593 10.7769C4.14162 11.0112 4.14162 11.3911 4.37593 11.6254C4.61025 11.8598 4.99015 11.8598 5.22446 11.6254L8.0002 8.8497L10.7759 11.6254C11.0102 11.8598 11.3901 11.8598 11.6245 11.6254C11.8588 11.3911 11.8588 11.0112 11.6245 10.7769L8.84872 8.00117L11.6245 5.22544C11.8588 4.99112 11.8588 4.61122 11.6245 4.37691C11.3901 4.14259 11.0102 4.14259 10.7759 4.37691L8.0002 7.15264L5.22446 4.37691Z",fill:"black",fillOpacity:i.deleteBtnHovered?"0.5":"0.25"})]})})]})}),$h=O(({localStore:e,panelLayerList:t,stepStore:n})=>{const r=e.getPageScale(),i=a=>{var s,o;return a.nodeType==="IMAGE"&&((o=(s=e.props).getPanelOffset)==null?void 0:o.call(s))||0};return d.jsx(d.Fragment,{children:t.map(a=>{var s,o;return d.jsx("div",{className:"layerTransformBox",style:{position:"absolute",left:i(a),top:i(a),transform:`translate3d(${a.left*r}px, ${a.top*r}px, 0) rotate(${a.rotate||0}deg)`,width:a.width*r,height:a.height*r,boxSizing:"border-box",pointerEvents:(s=e.props.grid)!=null&&s.getCurrentActiveLine()?"none":"auto"},onDragEnter:()=>{e.currentStatus="draggingWindowImageToPage"},onDragLeave:()=>{},onDrop:u=>{u.preventDefault(),u.stopPropagation(),e.currentStatus=""},children:a.nodeType==="IMAGE"?d.jsxs(d.Fragment,{children:[d.jsx(Bh,{layer:a,stepStore:n,localStore:e,visualBorderRadius:Ks(a,((o=e.props.panels)==null?void 0:o.getPanelBorderRadiusPercent())||0)*r}),d.jsx("div",{style:{position:"absolute",left:"0",top:"0",height:"100%",width:e.currentStatus==="draggingWindowImageToPage"?"100%":"0"},children:d.jsx(Ea,{style:{width:"100%",height:"100%"},onDrop:u=>{var c;(c=e.props.panels)==null||c.onDropWindowFilesIntoPanel(u,a)},children:d.jsx("span",{})})})]}):null},a.id)})})}),zh=O(({localStore:e})=>{if(!e.showFrameSelector)return null;const t=e.selectedSingleLayer;if(!t)return null;const n=e.getPageScale();function r(){if(t)return e.getLayer(t.parentId)}const i=r()||e.props.getCurrentPage();let a=[];return t&&(a=i.children.filter(s=>s.nodeType==="FRAME"&&s.id!==t.id)),d.jsxs("div",{style:{position:"absolute",left:0,top:0,zIndex:1e6},className:"FrameSelectorOverlay",onTouchStart:s=>{s.stopPropagation()},onTouchEnd:s=>{s.stopPropagation()},onPointerDown:s=>{s.stopPropagation()},onPointerUp:s=>{s.stopPropagation()},onClick:s=>{s.stopPropagation()},children:[d.jsx("div",{style:{position:"fixed",left:0,top:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.2)"},onClick:()=>{e.showFrameSelector=!1}}),a.map(s=>{const o=tt(e);if(!o)return null;const u=cn(o.fileData,{type:"layer",layerId:s.id}),c=Bs(u.absoluteTransform,{x:0,y:0});return d.jsx("div",{style:{position:"absolute",left:c.x*n,top:c.y*n,width:s.width*n,height:s.height*n,transform:`rotate(${u.rotate}deg)`,transformOrigin:"0 0",boxSizing:"border-box",border:"2px dashed blue",cursor:"pointer"},onClick:f=>{var l,p;if(f.stopPropagation(),o&&t){const y=Vt(e);kd({fileData:o.fileData,room:i,nextRoom:s,singleLayer:t,step:y}),y.update({layer:t,data:{left:0,top:0}}),Kt({localStore:e,layer:t,instanceChain:[],step:y}),(p=(l=e.props).doAction)==null||p.call(l,y.getNewAction()),Ce(e)}e.showFrameSelector=!1},children:d.jsx("div",{style:{width:"100%",height:"100%"}})},s.id)}),d.jsx("div",{style:{position:"absolute",color:"white",padding:20,display:"none"},children:"点击选择要移入的画框"})]})}),Wh=O(({localStore:e,stepStore:t})=>e.getSelectedLayerIdList().length>1&&(e.currentStatus==="movingLayers"||e.currentStatus==="rotatingLayers"||e.currentStatus==="resizingLayersByCorner")?null:d.jsx(d.Fragment,{children:e.getNormalLayerList().map(n=>d.jsx(ou,{localStore:e,stepStore:t,layer:n},n.id))})),Uh=O(({localStore:e})=>{var n,r,i,a,s;function t(){if(e.layerUnderDraggingId){const o=e.getLayer(e.layerUnderDraggingId);if(o&&o.nodeType==="IMAGE")return o}}return d.jsxs("div",{style:{position:"fixed",left:e.pointerX-75,top:e.pointerY-10,width:150,height:100,display:e.currentStatus==="draggingPanelImageOut"?"":"none",pointerEvents:"none"},children:[t()&&((n=t())!=null&&n.image)?d.jsx("img",{style:{width:"100%",opacity:.5},alt:"",src:((i=(r=t())==null?void 0:r.image)==null?void 0:i.imageSource)||""}):null,t()&&((a=t())!=null&&a.extra.backgroundColor)?d.jsx("div",{style:{width:"100%",height:"100%",opacity:.5,background:(s=t())==null?void 0:s.extra.backgroundColor}}):null]})}),Hh=O(({localStore:e})=>{const t=e.layerUnderCropping||e.selectedSingleLayer||e.bunchRectangle,n={display:"inline-block",padding:"4px",background:"rgba(0, 0, 0, 0.7)",borderRadius:"4px"};return d.jsxs("div",{style:{width:"100%",height:0,position:"absolute",pointerEvents:"none",fontSize:10,color:"#fff",left:e.pointerCurrentPositionInPage.x*e.getPageScale(),top:e.pointerCurrentPositionInPage.y*e.getPageScale()},children:[d.jsxs(Ut,{vShow:e.currentStatus==="movingLayers",className:"tipBox",style:n,children:[d.jsx("div",{children:`x：${t.left.toFixed(0)}`}),d.jsx("div",{children:`y：${t.top.toFixed(0)}`})]}),d.jsx(Ut,{vShow:e.currentStatus==="resizingLayersByCorner",className:"tipBox",style:n,children:e.layersCanBeScaled?d.jsxs("div",{children:[d.jsx("div",{children:`宽度：${t.width.toFixed(0)}`}),d.jsx("div",{children:`高度：${t.height.toFixed(0)}`})]}):d.jsx("div",{children:"已到达最小值"})}),d.jsxs(Ut,{vShow:e.currentStatus==="resizingLayersByBorder",className:"tipBox",style:n,children:[d.jsx("div",{children:`宽度：${t.width.toFixed(0)}`}),d.jsx("div",{children:`高度：${t.height.toFixed(0)}`})]}),d.jsx(Ut,{vShow:e.currentStatus==="rotatingLayers",className:"tipBox",style:n,children:d.jsx("div",{children:`角度：${Math.round(t.rotate||0)}°`})}),d.jsx(Ut,{vShow:e.currentStatus==="draggingImageControllerScaler"&&!!(t.nodeType==="IMAGE"&&t.image),className:"tipBox",style:n,children:d.jsxs("div",{children:[t.nodeType==="IMAGE"&&e.scalePercentDisplayed||"","%"]})})]})}),Gh=O(({localStore:e})=>{const t=e.getPageScale();return d.jsx("div",{className:"selectionRect",style:{boxSizing:"border-box",position:"absolute",display:e.selectionRectExists?"":"none",left:e.selectionRectangle.left*t,top:e.selectionRectangle.top*t,width:e.selectionRectangle.width*t,height:e.selectionRectangle.height*t,border:"1px solid #80A3FF"},children:d.jsx("div",{style:{width:"100%",height:"100%",background:"#80A3FF",opacity:.4}})})}),qh=O(({localStore:e})=>{const t=gn(e);function n(){const r=tt(e);if(r&&t){const i=cn(r.fileData,{type:"layer",layerId:t.id}),{left:a,top:s,rotate:o}=Dd({width:t.width,height:t.height,t:i.absoluteTransform});return`translate(${a*e.getPageScale()}px, ${s*e.getPageScale()}px) rotate(${o}deg)`}}return d.jsxs("div",{style:{position:"absolute",left:0,top:0,width:((t==null?void 0:t.width)||0)*e.getPageScale(),height:((t==null?void 0:t.height)||0)*e.getPageScale(),pointerEvents:"none",transform:n()},children:[d.jsx(Yh,{localStore:e}),d.jsx(Kh,{localStore:e})]})}),Yh=O(({localStore:e})=>d.jsx("div",{className:"helper-lines-container",style:{position:"absolute",left:0,top:0,pointerEvents:"none"},children:e.helperLineList.map(t=>d.jsx("div",{style:{position:"absolute",left:t.x,top:t.y,width:t.width,height:t.height,background:e.options.helperLineColor}},`${t.x}_${t.y}_${t.width}_${t.height}`))})),Kh=O(({localStore:e})=>{const t=e.getPageScale(),{helperLineColor:n}=e.options;return d.jsx(d.Fragment,{children:e.helperRectList.map((r,i)=>d.jsxs("div",{className:"helper-rect-entity",style:{position:"absolute",left:r.rect.left*t,top:r.rect.top*t,width:r.rect.width*t,height:r.rect.height*t,pointerEvents:"none"},children:[d.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",background:e.options.helperRectColor,opacity:.3}}),r.dimension==="x"?d.jsxs("div",{style:{position:"absolute",left:0,top:"50%",width:r.rect.width*t,height:1,background:n},children:[d.jsx("div",{style:{position:"absolute",left:0,top:-3,height:6,width:1,background:n}}),d.jsx("div",{style:{position:"absolute",right:0,top:-3,height:6,width:1,background:n}})]}):d.jsxs("div",{style:{position:"absolute",left:"50%",top:0,width:1,height:r.rect.height*t,background:n},children:[d.jsx("div",{style:{position:"absolute",left:-3,top:0,height:1,width:6,background:n}}),d.jsx("div",{style:{position:"absolute",left:-3,bottom:0,height:1,width:6,background:n}})]})]},`${r.rect.top}${i}`))})}),Zh=O(({localStore:e,polygonStore:t})=>{const n=e.getPageScale();return e.props.grid&&t&&t.isActive===!0?d.jsxs("div",{className:"polygonsCollageOverlay",style:{width:"100%",height:0,position:"absolute",left:0,top:0},children:[d.jsx("svg",{style:{position:"absolute",left:0,top:0,transform:`scale(${n})`,transformOrigin:"0 0"},width:t.getPage().width,height:t.getPage().height,children:t.getPage().imageLayerList.map(r=>d.jsx(Bo,{isForToolsContainer:!0,layer:r,pointList:t.getPointList(r),onClick:()=>{ce(e,{type:"replace",idList:[r.id]})}}))}),Object.keys(t.pointMap).map(r=>{const i=t.pointMap[r];return d.jsx("div",{style:{position:"absolute",left:i.x*n,top:i.y*n,width:20*n,height:20*n},children:d.jsx("div",{style:{position:"absolute",left:"-50%",top:"-50%",width:20*n,height:20*n,background:"red",borderRadius:1e3*n,cursor:"pointer"},onPointerDown:a=>{a.stopPropagation(),e.currentStatus="draggingPolygonDot",t.activePointDotKey=r}})},r)})]}):null});function Xh({stepStore:e,localStore:t,polygonStore:n,customOverlays:r,menu:i},a){function s(){return!!(t.selectedNormalLayerList.length>0||t.selectedLeafLayerId)}const o=x.useRef(null);return x.useEffect(()=>{o.current&&t.setCurrentToolsContainer(o.current)},[]),t.options.showOverlays===!1?null:d.jsxs("div",{className:"PowerOverlay",style:{position:"absolute",width:1e6*t.getPageScale(),left:0,top:0},ref:o,children:[d.jsx(Gr,{containerId:"#toolsContainerStyle",style:`
        .ToolsContainer .ant-popover .ant-popover-content .ant-popover-inner {
          border-radius: 4px !important;
          box-shadow: var(--base_shadow_raised) !important;
        }
        .ToolsContainer .ant-popover .ant-popover-content .ant-popover-inner .ant-popover-inner-content {
          padding: 6px 0 !important;
        }
        .ToolsContainer .ant-popover.leftMenu .ant-popover-content .ant-popover-arrow {
          display: block !important;
        }
        .layerTransformBox .add-btn path {
          fill: var(--_base--opacity_black_15);
        }
        .layerTransformBox:hover .add-btn path {
          fill: var(--_base--opacity_black_25);
        }
        .layerTransformBox .layerFrame {
          border: 2px solid var(--_base--opacity_black_15);
        }
        .layerTransformBox .layerFrame.noBorderLayer {
          border: 0;
        }
        .layerTransformBox .layerFrame:hover {
          border: 2px solid var(--_base--opacity_black_25);
        }
        .layerTransformBox .layerFrame.activeLayerFrame {
          border: 2px solid var(--stroke--selected);
        }
      `}),d.jsxs(Pa,{style:{position:"absolute",left:0,top:0,width:"100%"},onPointerDown:()=>{o.current&&t.setCurrentToolsContainer(o.current)},onPointerMove:()=>{t.currentStatus===""&&o.current&&t.setCurrentToolsContainer(o.current)},children:[t.options.hasBasicOverlays?d.jsxs(d.Fragment,{children:[t.options.hasGridPanels?d.jsx($h,{localStore:t,panelLayerList:t.props.getPanelList(),stepStore:e}):null,d.jsx(Zh,{localStore:t,polygonStore:n}),d.jsx(Wh,{localStore:t,stepStore:e}),d.jsx(Ah,{localStore:t,stepStore:e}),t.options.hasActiveOverlay&&s()?d.jsx(Oh,{localStore:t,stepStore:e}):null,d.jsx(qh,{localStore:t}),d.jsx(Gh,{localStore:t}),d.jsx(Ch,{localStore:t,stepStore:e}),d.jsx(zh,{localStore:t}),d.jsx(Uh,{localStore:t}),i,d.jsx(Hh,{localStore:t})]}):null,t.currentTool==="EraserTool"?d.jsx(_h,{localStore:t}):null,r||null]})]})}const Ip=O(Xh),jp=O(({style:e,onPointerDown:t,children:n})=>d.jsx("div",{className:"OverlayWrapper",style:{position:"absolute",left:-100*1e4,top:-100*1e4,width:200*1e4,height:200*1e4,...e},onPointerDown:t,children:n}));function uu({children:e,vShow:t,vIf:n,style:r,className:i,hover:a}){const[s,o]=x.useState(()=>!1);return n===!1?null:d.jsx("div",{style:{...r,...s?a:{},display:t?(r==null?void 0:r.display)||"":"none"},className:i,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:n?e:null})}uu.defaultProps={vShow:!0,vIf:!0,style:{},hover:{},className:""};const Mp=O(uu);export{Yh as $,dc as A,Lp as B,Mp as C,gg as D,ph as E,Ef as F,yf as G,_n as H,qi as I,Cf as J,kg as K,gh as L,yp as M,wg as N,jp as O,Lo as P,Oo as Q,yg as R,Lg as S,Ip as T,Mf as U,wp as V,Cp as W,xp as X,wc as Y,uo as Z,Gh as _,$d as a,Kh as a0,Pc as a1,Mc as a2,mc as a3,mp as a4,Aa as a5,vp as a6,Ep as a7,cp as a8,cs as a9,Tf as aa,nc as ab,op as ac,sp as ad,Qd as ae,fc as af,pp as ag,fa as ah,Sl as ai,wf as aj,Or as ak,bp as al,Tp as am,Fp as an,fp as ao,Pp as ap,ko as aq,tp as b,Ua as c,eo as d,np as e,ip as f,Bd as g,gp as h,to as i,bf as j,Vf as k,Yf as l,Yt as m,Ql as n,Lf as o,hp as p,dp as q,un as r,lp as s,Ss as t,Eo as u,rp as v,Jd as w,ap as x,up as y,Ha as z};
