import{r as l,j as c}from"./index-BpkY95s5.js";import{j as R,bU as N,bV as A,bW as _,k as G,bX as U,aY as Y,aZ as B,bY as M,bZ as z,w as H,b as V,L as X,a as T,p as K,bS as Z}from"./index-B3ckdOIJ.js";import{D as $,a as q}from"./indexedDB-DrmwFJ47.js";import{d as O,m as F,o as j,a as J}from"./index-CsSXPTiX.js";/* empty css              */function I(){return"WorkspaceViewScrollContainer"}const Q=O(({workspaceState:e,children:r,safePadding:a,getPageScale:s,getPageWidth:n,getPageHeight:g,navigator:u,shuffleImg:ne,localStore:o,addOrReplacePanelImageToPage:oe,hiddenDragImageUpload:ae})=>{const{current:b}=l.useRef({isLocked:!1}),L=l.useRef(null),h=l.useRef(null),y=R(()=>({viewportWidth:0,viewportHeight:0,dragging:!1,prevX:0,prevY:0}));function f(){const t=L.current,i=h.current;t&&i&&(y.viewportWidth=Y(t),y.viewportHeight=B(t),e.workspaceScrollLeft=i.scrollLeft,e.workspaceScrollTop=i.scrollTop,document.querySelectorAll(`.${I()}`).forEach(w=>{w.scrollLeft=i==null?void 0:i.scrollLeft,w.scrollTop=i==null?void 0:i.scrollTop}))}l.useEffect(()=>{function t(){y.dragging=!1}return window.addEventListener("pointerup",t),()=>{window.removeEventListener("pointerup",t)}},[]);function E(){h.current&&(h.current.onwheel=t=>{if(o.options.canScalePage===!1){t.preventDefault();return}if(t.ctrlKey){const i=t.currentTarget,w=M(i),k=z(i);t.preventDefault();const D=t.pageX-w,x=t.pageY-k,v=s();let d=1;t.deltaY>0?(d=v*.9,d<.15&&(d=.15)):t.deltaY<0&&(d=v*1.1,d>4&&(d=4));const C=a+(i.scrollLeft-a+D)/v*d-D,W=a+(i.scrollTop-a+x)/v*d-x;e.pageScale=d,i.scrollLeft=C,i.scrollTop=W,f()}},f())}l.useEffect(()=>{E()},[]),l.useEffect(()=>{f()},[n(),g()]),l.useEffect(()=>{setTimeout(()=>{E()},0)},[o.workspaceExists]);function S(){o.options.canScalePage&&H({localStore:o,workspaceState:e})}return l.useEffect(()=>{S()},[n(),g()]),l.useEffect(()=>(window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[]),o.workspaceExists===!1?null:c.jsx("div",{className:N,ref:L,style:{position:"relative",width:"100%",height:"100%",cursor:o.currentCursor,overflow:"hidden"},onContextMenu:t=>{t.preventDefault()},onPointerDown:t=>{t.button===2?(o.currentStatus="rightPointDownOnWorkspace",t.stopPropagation()):(o.currentStatus="pointerDownOnWorkspace",G(o,t),o.getNormalLayerList().length>0&&U(o,t))},onPointerMove:()=>{},onPointerUp:t=>{o.currentStatus==="rightPointDownOnWorkspace"?(t.stopPropagation(),t.preventDefault(),A(o,null,t)):o.currentStatus==="pointerDownOnWorkspace"&&_(o,t)},onDragEnter:()=>{o.currentStatus="draggingWindowImageToPage"},onDragLeave:()=>{},onDrop:t=>{t.preventDefault(),o.currentStatus=""},children:c.jsx("div",{ref:h,className:I(),style:{width:"100%",height:"100%",overflow:"auto"},onClick:()=>{b.isLocked=!b.isLocked},onScroll:()=>{f()},children:c.jsx("div",{style:{display:"table",width:"100%",height:"100%",overflow:"hidden"},children:c.jsx("div",{className:"the-content-table-cell",style:{display:"table-cell",width:"100%",height:"100%",verticalAlign:"middle",position:"relative",overflow:"hidden"},children:c.jsx("div",{style:{position:"relative",background:"",display:"table",margin:"auto",padding:a},children:r})})})})})});var ee=Object.defineProperty,te=Object.getOwnPropertyDescriptor,P=(e,r,a,s)=>{for(var n=s>1?void 0:s?te(r,a):r,g=e.length-1,u;g>=0;g--)(u=e[g])&&(n=(s?u(r,a,n):u(n))||n);return s&&n&&ee(r,a,n),n};class m{constructor(){this.database=new $({name:"DesignDatabase"}),this.document={id:"document",nodeType:"DOCUMENT",name:"Document",phase:"CREATED",editInfo:{userId:"",createdAt:0,lastEditedAt:0},children:[q({children:[]})]},this.selectionInfo=V(),F(this);const r=this,a=new X({getNormalLayerList(){return r.page.children},props:{getDocumentNode(){return r.document},getCurrentPage(){return r.page},getPageSize(){return{width:r.page.width,height:r.page.height}},getBackgroundLayer(){return null},getPanelList(){return[]},getRootStore(){return null},getSelectionInfo(){return r.selectionInfo}}});this.localStore=a}get page(){return this.document.children[0]}}P([j],m.prototype,"document",2);P([J],m.prototype,"page",1);P([j],m.prototype,"selectionInfo",2);function p(e,r){if(r===!1)throw new Error(e);console.log(e)}function re(e){const{localStore:r}=e,a=T(e.localStore);a.width=100,a.height=100,e.page.children.push(a);const s=T(e.localStore);s.left=30,s.top=40,s.width=100,s.height=100,e.page.children.push(s),K(r,{type:"replace",idList:[a.id,s.id]}),Z(r),p("Page children length to be 1",e.page.children.length===1);const n=e.page.children[0];p("Group layer is created",n.nodeType==="GROUP"),p("Group layer width is correct",n.width===130),p("Group layer height is correct",n.height===140),p("Group layer children are correct",n.children.length===2),p("Layer 1 has right parent",n.children[0].parentId===n.id),p("Layer 2 has right parent",n.children[1].parentId===n.id),r.history.undo(),p("Page has two children",e.page.children.length===2),p("Parent is page",e.page.children[0].parentId===e.page.id),p("Parent is page",e.page.children[1].parentId===e.page.id),r.history.redo()}const de=O(()=>{const[e]=l.useState(()=>new m);return l.useEffect(()=>{},[]),c.jsx(Q,{localStore:e.localStore,safePadding:60,workspaceState:e.localStore.workspaceState,getPageWidth:()=>e.page.width,getPageHeight:()=>e.page.height,getPageScale:()=>e.localStore.getPageScale(),navigator:c.jsx("div",{}),shuffleImg:()=>{},addOrReplacePanelImageToPage:()=>{},children:c.jsx("div",{style:{position:"relative",width:1e3*e.localStore.getPageScale(),height:1e3*e.localStore.getPageScale()},onClick:async()=>{re(e),await e.database.initDB()},children:c.jsx("div",{style:{position:"absolute",left:0,top:0,width:1e3,height:1e3,transform:`scale(${e.localStore.getPageScale()})`,transformOrigin:"0 0",overflow:"hidden"},children:c.jsx("div",{style:{position:"relative"},children:c.jsx("div",{style:{position:"absolute",left:0,top:0,width:300,height:300}})})})})})});export{de as default};
