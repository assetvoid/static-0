import{r as m,j as e}from"./index-BpkY95s5.js";import{d as h}from"./index-CsSXPTiX.js";import{d as b,i as x,s as f,cH as C,j as y,cI as k,bw as T,p as l,cJ as w,cK as I,bU as P,bH as E,aA as H,cL as z,cM as M,cN as N}from"./index-CBOOmi6w.js";import{a as V}from"./index-CNBp_hX0.js";import{w as A,aa as B,C as p,al as O}from"./CommonWrapper-CI9A_lEX.js";async function W({localStore:i,url:t}){const s={id:b(),guid:i.generateGUID(),parentId:"",left:0,top:0,width:0,height:0,rotate:0,isLocked:!1,visible:!0,shimmerAtApearance:!1,children:[],name:"",nodeType:"video",video:{url:t,width:0,height:0,videoWidth:0,videoHeight:0},editInfo:{userId:"",createdAt:new Date().getTime(),lastEditedAt:new Date().getTime()}};return await new Promise((c,o)=>{const d=document.createElement("video");d.onloadeddata=a=>{s.width=d.videoWidth,s.height=d.videoHeight,s.video.width=d.videoWidth,s.video.height=d.videoHeight,s.video.videoWidth=d.videoWidth,s.video.videoHeight=d.videoHeight,c(a)},d.onerror=()=>{o()},d.src=t}),s}function ne(i,t,s){if(i.selectedTemplatePaneRestCount){let c=0;i.imageLayerList.forEach(o=>{o.image||(o.image=s[c],c+=1,x(o),f(t,o))})}else{let c=0;i.imageLayerList.forEach(o=>{o.image=s[c],c+=1,x(o),f(t,o)})}i.stepStore.record("FilledGridPanelsWithImage")}async function F(i,t){}function R(){return[]}async function X(i){}const Y="data:image/svg+xml,%3csvg%20class='svg'%20xmlns='http://www.w3.org/2000/svg'%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%3e%3cpath%20fill='%23cdcdcd'%20fill-opacity='1'%20fill-rule='evenodd'%20stroke='none'%20d='M4%20.5V3h4V.5h1V3h2.5v1H9v4h2.5v1H9v2.5H8V9H4v2.5H3V9H.5V8H3V4H.5V3H3V.5h1zM8%208V4H4v4h4z'%3e%3c/path%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20class='svg'%20xmlns='http://www.w3.org/2000/svg'%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%3e%3cpath%20fill='%23cdcdcd'%20fill-opacity='.9'%20fill-rule='evenodd'%20stroke='none'%20d='M.5%200C.224%200%200%20.224%200%20.5v11c0%20.276.224.5.5.5h11c.276%200%20.5-.224.5-.5V.5c0-.276-.224-.5-.5-.5H.5zM6%201H1v3h5V1zM1%205h5.5c.276%200%20.5-.224.5-.5V1h4v10H1V5z'%3e%3c/path%3e%3c/svg%3e",D="data:image/svg+xml,%3csvg%20t='1716882239822'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4197'%20width='200'%20height='200'%3e%3cpath%20d='M192%20384l320%20384%20320-384z'%20p-id='4198'%20fill='%23cdcdcd'%3e%3c/path%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20class='svg'%20xmlns='http://www.w3.org/2000/svg'%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%3e%3cpath%20fill='%238638E5'%20fill-opacity='1'%20fill-rule='nonzero'%20stroke='none'%20d='M3.743%202.748%206%20.5l2.257%202.248L6%204.996%203.743%202.748zm-.995%205.51L.5%206l2.248-2.257L4.996%206%202.748%208.257zm5.51.994L6%2011.5%203.743%209.252%206%207.004l2.257%202.248zM11.5%206%209.252%203.743%207.004%206l2.248%202.257L11.5%206z'%3e%3c/path%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20class='svg'%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='14'%20viewBox='0%200%2014%2014'%3e%3cpath%20fill='%238638E5'%20fill-opacity='1'%20fill-rule='evenodd'%20stroke='none'%20d='M.828%207%207%20.828%2013.172%207%207%2013.172.828%207zM7%2011.828%2011.828%207%207%202.172%202.172%207%207%2011.828z'%3e%3c/path%3e%3c/svg%3e",J="data:image/svg+xml,%3csvg%20t='1733378702695'%20class='icon'%20viewBox='0%200%201025%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1497'%20width='12'%20height='12'%3e%3cpath%20d='M928.01024%20416.01024c-28.42624%200-53.9648%2012.36992-71.53664%2032.01024l-189.952%200%20134.30784-134.30784c26.3168%201.45408%2053.10464-7.84384%2073.216-27.9552%2037.49888-37.49888%2037.49888-98.28352%200-135.76192s-98.28352-37.49888-135.76192%200c-20.11136%2020.11136-29.40928%2046.8992-27.9552%2073.216l-134.30784%20134.30784%200-189.952c19.64032-17.57184%2032.01024-43.1104%2032.01024-71.53664%200-53.02272-42.98752-96.01024-96.01024-96.01024s-96.01024%2042.98752-96.01024%2096.01024c0%2028.42624%2012.36992%2053.9648%2032.01024%2071.53664l0%20189.952-134.30784-134.30784c1.45408-26.3168-7.86432-53.10464-27.9552-73.216-37.49888-37.49888-98.28352-37.49888-135.76192%200s-37.49888%2098.28352%200%20135.76192c20.11136%2020.11136%2046.8992%2029.40928%2073.216%2027.9552l134.32832%20134.30784-189.952%200c-17.57184-19.64032-43.1104-32.01024-71.53664-32.01024-53.02272%200-96.01024%2042.98752-96.01024%2096.01024s42.98752%2096.01024%2096.01024%2096.01024c28.42624%200%2053.9648-12.36992%2071.53664-32.01024l189.952%200-134.30784%20134.30784c-26.3168-1.45408-53.10464%207.84384-73.216%2027.9552-37.49888%2037.49888-37.49888%2098.28352%200%20135.76192s98.28352%2037.49888%20135.76192%200c20.11136-20.11136%2029.40928-46.8992%2027.9552-73.216l134.30784-134.32832%200%20189.952c-19.64032%2017.57184-32.01024%2043.1104-32.01024%2071.53664%200%2053.02272%2042.98752%2096.01024%2096.01024%2096.01024s96.01024-42.98752%2096.01024-96.01024c0-28.42624-12.36992-53.9648-32.01024-71.53664l0-189.952%20134.30784%20134.30784c-1.45408%2026.3168%207.84384%2053.10464%2027.9552%2073.216%2037.49888%2037.49888%2098.28352%2037.49888%20135.76192%200s37.49888-98.28352%200-135.76192c-20.11136-20.11136-46.8992-29.40928-73.216-27.9552l-134.32832-134.30784%20189.952%200c17.57184%2019.64032%2043.1104%2032.01024%2071.53664%2032.01024%2053.02272%200%2096.01024-42.98752%2096.01024-96.01024s-42.98752-96.01024-96.01024-96.01024z'%20p-id='1498'%3e%3c/path%3e%3c/svg%3e",K="data:image/svg+xml,%3csvg%20t='1733379416191'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5169'%20width='12'%20height='12'%3e%3cpath%20d='M853.333333%20138.666667H170.666667c-17.066667%200-32%2014.933333-32%2032v128c0%2017.066667%2014.933333%2032%2032%2032s32-14.933333%2032-32V202.666667h277.333333v618.666666H384c-17.066667%200-32%2014.933333-32%2032s14.933333%2032%2032%2032h256c17.066667%200%2032-14.933333%2032-32s-14.933333-32-32-32h-96v-618.666666h277.333333V298.666667c0%2017.066667%2014.933333%2032%2032%2032s32-14.933333%2032-32V170.666667c0-17.066667-14.933333-32-32-32z'%20p-id='5170'%3e%3c/path%3e%3c/svg%3e";function j(i){return i.nodeType==="FRAME"?Y:i.nodeType==="SECTION"?G:i.nodeType==="SYMBOL"?U:i.nodeType==="INSTANCE"?$:i.nodeType==="vector"?J:i.nodeType==="TEXT"?K:""}const q=h(({level:i,localStore:t,layer:s,isActive:c,instanceChain:o,layerDesc:d})=>{var g;const a=y(()=>({collapse:!0}));m.useEffect(()=>{c?a.collapse=!1:a.collapse=!0},[c]),m.useEffect(()=>{},[t.renderCount]);const n=t.getFigma();if(!n)return null;const r=k(n.context.fileData,s),v=T({localStore:t,layer:s,instanceChain:o});return e.jsxs("div",{style:{background:"white"},children:[e.jsx("div",{style:{lineHeight:"28px",fontSize:12,padding:"3px 6px",cursor:"pointer",color:d.isPurple?"#8638E5":"",fill:d.isPurple?"#8638E5":"",fontWeight:s.nodeType==="SYMBOL"?"bold":""},onClick:u=>{u.stopPropagation(),d.isPhantom?l(t,{type:"$target",target:{type:"phantom",id:s.id,completeChain:d.completeChain}}):l(t,{type:"replace",idList:[s.id]})},children:e.jsx("div",{style:{paddingLeft:12+20*i,background:c&&s.id===((g=d.selectedTarget)==null?void 0:g.id)?"#daebf7":"",borderRadius:6},children:e.jsxs("div",{style:{opacity:v.visible?1:.4},children:[e.jsx("div",{style:{display:"inline-block",width:12,height:12,marginRight:4},children:r.length>0?e.jsx("img",{onClick:u=>{u.stopPropagation(),a.collapse=!a.collapse},src:D,alt:"",style:{display:"inline-block",width:12,height:12}}):null}),j(s)?e.jsx("img",{src:j(s),style:{display:"inline-block",marginRight:6},alt:""}):null,s.name?e.jsx("span",{style:{fontWeight:i===0?"bold":""},children:s.name}):e.jsx("span",{children:s.id.substr(0,8)}),s.isLocked?"🔐":""]})})}),a.collapse?null:e.jsx("div",{style:{},children:r.length>0?e.jsx(L,{level:i+1,localStore:t,layerList:r,instanceChain:o,layerDesc:{...d,isPhantom:d.isPhantom||s.nodeType==="INSTANCE"}}):null})]},s.id)}),L=h(({localStore:i,layerList:t,level:s,instanceChain:c,layerDesc:o})=>{var a;m.useEffect(()=>{},[i.renderCount]);const d=((a=o.selectedTarget)==null?void 0:a.completeChain.map(n=>n.id))||[];return e.jsx("div",{children:t.map(n=>{const r=o.completeChain.concat([{id:n.id,nodeType:n.nodeType}]),v=r.map(g=>g.id).join("--")===d.slice(0,r.length).join("--");return e.jsx("div",{children:e.jsx(q,{level:s,localStore:i,layer:n,isActive:v,instanceChain:C(c,n),layerDesc:{...o,completeChain:r,isPurple:o.isPurple||n.nodeType==="SYMBOL"||n.nodeType==="INSTANCE"}})},n.id)})})}),Q=h(({localStore:i})=>e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{z(i)},children:"播放"}),e.jsx("button",{onClick:()=>{M(i)},children:"停止"}),e.jsx("div",{children:i.currentTime}),e.jsxs("div",{style:{position:"relative",width:"100%"},children:[i.getNormalLayerList().map(t=>t.timeline?e.jsx("div",{style:{position:"relative",width:"100%",height:40},onClick:()=>{l(i,{type:"replace",idList:[t.id]}),t.timeline&&(i.currentTime=t.timeline.start)},children:e.jsx("div",{style:{position:"absolute",left:t.timeline.start/1e3*20,top:0,width:(t.timeline.end-t.timeline.start)/1e3*20,height:"100%",background:"red"}})},t.id):null),e.jsx("div",{style:{position:"absolute",left:i.currentTime/1e3*20,top:0,width:"10px",height:"100%",background:"black",cursor:"pointer"},onPointerDown:t=>{N(i,t)}})]})]})),se=h(({localStore:i,stepStore:t,collageInfo:s})=>{var o,d,a;const c=y(()=>({show:!1,panel:"",templateList:R(),count:0}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{width:300,position:"fixed",left:0,top:0,background:"white",padding:10},children:[e.jsxs("div",{children:[e.jsxs("div",{children:["测试面板",e.jsx("button",{onClick:async()=>{c.show=!c.show},children:"显示/隐藏"})]}),e.jsx("div",{children:i.currentStatus||"--"})]}),e.jsxs("div",{style:{display:c.show?"":"none",height:"100vh",overflow:"scroll"},children:[e.jsxs("div",{children:[e.jsx("button",{onClick:async()=>{i.setOptions({showOverlays:!i.options.showOverlays})},children:"toggle"}),e.jsx("button",{onClick:()=>{},children:"成为vip"}),e.jsx("button",{onClick:async()=>{c.panel="add"},children:"新增"}),e.jsx("button",{onClick:async()=>{},children:"NewFrame"}),e.jsx("button",{onClick:async()=>{const n=i.selectedSingleLayer;n&&n.nodeType},children:"NewFrameText"}),e.jsx("button",{onClick:()=>{X()},children:"Populate"})]}),c.panel==="add"?e.jsx("div",{children:c.templateList.map(n=>e.jsx("div",{onClick:async()=>{await F(i,n.id)},children:e.jsx("img",{alt:"",style:{width:100},src:n.cover})},n.id))}):null,e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("button",{onClick:async()=>{l(i,{type:"clear"}),t.record("AppliedPolygonTemplate")},children:"多边形拼图"}),e.jsx("button",{onClick:async()=>{},children:"应用模板"}),e.jsx("button",{onClick:()=>{const n=w({localStore:i,type:"line"});n.data.type==="line"&&(n.data.markerEnd="arrow"),i.getNormalLayerList().push(n)},children:"line"}),e.jsx("button",{onClick:()=>{const n=w({localStore:i,type:"rect"});i.getNormalLayerList().push(n)},children:"rect"}),e.jsx("button",{onClick:async()=>{const n=await W({localStore:i,url:"http://vjs.zencdn.net/v/oceans.mp4"});i.getNormalLayerList().push(n)},children:"添加视频"}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{i.currentTool="MoveTool"},children:"选择"}),e.jsx("button",{onClick:()=>{i.currentTool="EraserTool"},children:"消除笔"})]}),e.jsx("button",{onClick:()=>{A(i)},children:"裁剪"}),e.jsx("button",{onClick:()=>{B(i)},children:"裁剪背景"}),e.jsx("button",{onClick:()=>{},children:"复制"}),e.jsx("button",{onClick:()=>{V(i),t.record("DeletedLayers")},children:"删除图层"}),e.jsx("button",{onClick:()=>{t.record("LockedLayers")},children:"锁定图层"}),e.jsx("button",{onClick:()=>{I(i)},children:"解锁组内编辑"})]}),i.selectionStatus||"画布",e.jsx(p,{vIf:i.selectionStatus==="multipleLayers",children:e.jsx("button",{onClick:()=>{P(i)},children:"成组"})}),e.jsx(p,{vIf:i.selectionStatus==="singleGroupLayer",children:e.jsx("button",{onClick:()=>{},children:"解组"})}),e.jsx(p,{vIf:((o=i.selectedSingleLayer)==null?void 0:o.nodeType)==="svg",children:e.jsx("div",{children:e.jsx("input",{onBlur:n=>{var r;((r=i.selectedSingleLayer)==null?void 0:r.nodeType)==="svg"&&O(i,i.selectedSingleLayer,Number(n.target.value))}})})}),e.jsx(p,{vIf:i.selectionStatus==="singleTextLayer",children:e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{i.selectedSingleLayer&&i.selectedSingleLayer.nodeType},children:"导出"}),e.jsx("button",{onClick:()=>{i.selectedSingleLayer&&i.selectedSingleLayer.nodeType},children:"加粗"}),e.jsx("button",{onClick:()=>{},children:"斜体"}),e.jsx("button",{onClick:()=>{},children:"字号"}),e.jsx("button",{onClick:()=>{},children:"阴影"}),e.jsx("button",{onClick:()=>{},children:"描边"})]})}),e.jsx("div",{style:{padding:10,marginBottom:15,height:500,overflow:"scroll"},children:e.jsx(L,{level:0,localStore:i,layerList:((d=i.figma)==null?void 0:d.topLevelLayerList)||[],instanceChain:[],layerDesc:{isPurple:!1,selectedTarget:E({localStore:i}),completeChain:[],isPhantom:!1}})})]})]})]}),e.jsxs("div",{style:{position:"fixed",left:0,bottom:0,display:c.show?"":"none"},children:[e.jsx("div",{style:{width:100,height:100,background:"red"},onPointerDown:n=>{i.currentStatus="pointerDownOnLeftImage",l(i,{type:"clear"});const r=H();r.naturalWidth=100,r.naturalHeight=100,r.imageSource="",s.leftAddImageInfo.dragImageInfo=r,s.leftAddImageInfo.dragImageId="1",i.pointerX=n.pageX,i.pointerY=n.pageY}}),e.jsx("div",{style:{display:"flex"},children:(a=i.figma)==null?void 0:a.topLevelLayerList.map((n,r)=>e.jsx("div",{style:{width:60,height:100,border:"4px solid black",margin:20},onClick:()=>{i.getFigma()},children:r}))}),e.jsx(Q,{localStore:i}),e.jsx(Z,{localStore:i,collageInfo:s})]})]})}),Z=h(({localStore:i,collageInfo:t})=>i.currentStatus!=="draggingLeftImageToPage"?null:e.jsx("div",{className:"ImagePreview",style:{position:"fixed",zIndex:1e5,pointerEvents:"none",left:`${i.pointerX-75}px`,top:`${i.pointerY-50}px`,opacity:"0.5",width:150,height:100},children:e.jsx("img",{style:{width:"100%",height:"100%",objectFit:"cover"},src:t.leftAddImageInfo.dragImageInfo?t.leftAddImageInfo.dragImageInfo.imageSource:"",alt:""})}));export{L,se as R,ne as a};
